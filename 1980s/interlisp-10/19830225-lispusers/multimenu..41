(FILECREATED " 9-NOV-82 08:48:18" {SDR2020}PS:<DOLPHIN.LISPUSERS>MULTIMENU.;41 32641        changes to:  (FNS HELPTITLEFN MENUANDTITLEFN)      previous date: " 8-NOV-82 09:16:47" {SDR2020}PS:<DOLPHIN.LISPUSERS>MULTIMENU.;40)(PRETTYCOMPRINT MULTIMENUCOMS)(RPAQQ MULTIMENUCOMS ((FNS * MULTIMENUFNS)		      (RECORDS MENULSTENTRY)		      (VARS * MULTIMENUVARS)		      (DECLARE: DONTEVAL@LOAD DOEVAL@COMPILE DONTCOPY COMPILERVARS				(ADDVARS (NLAMA)					 (NLAML)					 (LAMA)))))(RPAQQ MULTIMENUFNS (ADDMULTIMENU CHANGEMULTIMENU CREATEWINDOWFROMBOX DELETEALLMENUS 				  DELMULTIMENU GET-WINDOW-OF-MENU GRAYEDMENUSELECTEDFN 				  GRAYMENU HELPTITLEFN MAKEMENUS MAKETTYWINDOW 				  MENUANDTITLEFN MENUEXISTS MULTIWINDOWREAD 				  SETUP-MENU-FOR-HELP UNGRAYMENU WINDOWDOFUN 				  \ADDMULTIMENU1 \FIND-MENUCOLUMN-HEIGHT \FIND-MENUHEIGHT 				  \FIND-MENUWIDTH \FIND-WIDEST-MENU \FIND-WIDEST-WINDOW 				  \MAKEMENU \MAKEMENU1 \MAKEMENUID \MAKEMENUWINDOW 				  \MAKESCROLLINGMENUP \MENUCLOSEFN \MENUMOVEFN 				  \UPDATEMINMENU))(DEFINEQ(ADDMULTIMENU  (LAMBDA (MAINW NEWMENULSTENTRY WHERE)               (* ejs: " 4-OCT-82 09:08")          (* * This function adds a new menu to the menucolumn on MAINW. MENULSTENTRY is in the usual format.	  WHERE is a list of form (FIRST LAST BEFORE AFTER <A MENUID>); if not supplied, the new menu is 	  added at the end (bottom))    (COND      ((NULL (WINDOWPROP MAINW (QUOTE ITEMMENU)))	(WINDOWPROP MAINW (QUOTE MINMENUHEIGHT)		    (fetch (REGION HEIGHT) of (WINDOWPROP MAINW (QUOTE REGION))))	(\MAKEMENU MAINW NEWMENULSTENTRY (\FIND-MENUWIDTH NEWMENULSTENTRY))	(WINDOWPROP MAINW (QUOTE MOVEFN)		    (QUOTE \MENUMOVEFN))	(WINDOWPROP MAINW (QUOTE CLOSEFN)		    (QUOTE \MENUCLOSEFN))	(WINDOWPROP MAINW (QUOTE RESHAPEFN)		    (QUOTE DON'T))))    (OR WHERE (SETQ WHERE (LIST (QUOTE LAST))))    (SELECTQ (COND	       ((LISTP WHERE)		 (CAR WHERE))	       (T WHERE))	     (LAST (\MAKEMENU MAINW NEWMENULSTENTRY (\FIND-WIDEST-WINDOW MAINW)))	     (FIRST (\ADDMULTIMENU1 MAINW NEWMENULSTENTRY				    (LIST (QUOTE BEFORE)					  (CAAR (WINDOWPROP MAINW (QUOTE ITEMMENU))))))	     ((AFTER BEFORE)	       (\ADDMULTIMENU1 MAINW NEWMENULSTENTRY WHERE))	     (ERROR 	   "Menu location relation must be one of FIRST, LAST, BEFORE, AFTER, or NIL"))    (\UPDATEMINMENU MAINW)))(CHANGEMULTIMENU  (LAMBDA (MAINW OLDMENUID NEWMENU)                   (* ejs: " 5-OCT-82 15:14")          (* * Replaces OLDMENU with NEWMENU, suitably adjusting the menu column)    (PROG ((MLST (WINDOWPROP MAINW (QUOTE ITEMMENU)))	   MLSTTAIL DELMENU RELPOS W)          (COND	    ((NOT (SETQ DELMENU (SASSOC OLDMENUID MLST)))	      (\MAKEMENU MAINW NEWMENU (\FIND-WIDEST-WINDOW MAINW))	      (RETURN)))          (SETQ MLSTTAIL (for M on MLST until (EQUAL (CAAR M)						     OLDMENUID)			    finally (RETURN (CDR M))))          (COND	    ((AND (NULL MLSTTAIL)		  NEWMENU)	      (DELMULTIMENU MAINW (CAAR (FLAST (WINDOWPROP MAINW (QUOTE ITEMMENU)))))	      (\MAKEMENU MAINW NEWMENU (\FIND-WIDEST-WINDOW MAINW))	      (RETURN)))          (CLOSEW (CDR DELMENU))          (SETQ RELPOS (COND	      (NEWMENU (create POSITION			       XCOORD _ 0			       YCOORD _(IDIFFERENCE (fetch (REGION HEIGHT)						       of (WINDOWPROP (CDR DELMENU)								      (QUOTE REGION)))						    (COND						      ((\MAKESCROLLINGMENUP NEWMENU)							(fetch (MENULSTENTRY 									MENUSCROLLFLG)							   of NEWMENU))						      (T (\FIND-MENUHEIGHT NEWMENU))))))	      (T (create POSITION			 XCOORD _ 0			 YCOORD _(fetch (REGION HEIGHT) of (WINDOWPROP (CDR DELMENU)								       (QUOTE REGION))))))	    )          (for M in (COND		      ((ILESSP (fetch YCOORD of RELPOS)			       0)			(REVERSE MLSTTAIL))		      (T MLSTTAIL))	     do (RELMOVEW (CDR M)			  RELPOS))          (COND	    (NEWMENU	      (WINDOWPROP		MAINW		(QUOTE ITEMMENU)		(SUBST (CONS (\MAKEMENUID NEWMENU)			     (\MAKEMENU1 MAINW NEWMENU					 (create POSITION						 XCOORD _(IDIFFERENCE						   (fetch (REGION LEFT)						      of (WINDOWPROP MAINW (QUOTE REGION))							  )						   (COND						     ((OR (LISTP NEWMENU)							  (LISTP (EVAL NEWMENU)))						       (IPLUS (\FIND-WIDEST-WINDOW MAINW)							      2))						     (T (\FIND-MENUWIDTH NEWMENU))))						 YCOORD _(IPLUS						   (fetch (REGION BOTTOM)						      of (WINDOWPROP (CDAR MLSTTAIL)								     (QUOTE REGION)))						   (fetch (REGION HEIGHT)						      of (WINDOWPROP (CDAR MLSTTAIL)								     (QUOTE REGION)))))))		       DELMENU MLST)))	    (T (WINDOWPROP MAINW (QUOTE ITEMMENU)			   (REMOVE DELMENU MLST))))          (\UPDATEMINMENU MAINW))))(CREATEWINDOWFROMBOX  (LAMBDA (WIDTH HEIGHT TITLE POSITION)               (* ejs: "15-OCT-82 09:20")          (* * This function creates a window, WIDTH by HEIGHT, at POS. If POSITION is NIL, prompts for a 	  region using GETBOXPOSITION. Gives window title TITLE.)    (PROG ((POS (OR POSITION (GETBOXPOSITION WIDTH HEIGHT))))          (RETURN (CREATEW (create REGION				   LEFT _(fetch XCOORD of POS)				   BOTTOM _(fetch YCOORD of POS)				   WIDTH _ WIDTH				   HEIGHT _ HEIGHT)			   TITLE)))))(DELETEALLMENUS  (LAMBDA (WINDOW)                                    (* edited: "22-SEP-82 16:30")    (for M in (WINDOWPROP WINDOW (QUOTE ITEMMENU)			  NIL)       do (CLOSEW (CDR M)))    (WINDOWPROP WINDOW (QUOTE MINMENUHEIGHT)		(fetch (REGION HEIGHT) of (WINDOWPROP WINDOW (QUOTE REGION))))))(DELMULTIMENU  (LAMBDA (MAINW MENUID)                              (* ejs: "31-AUG-82 09:09")    (CHANGEMULTIMENU MAINW MENUID)))(GET-WINDOW-OF-MENU  (LAMBDA (PARENTWINDOW MENUID)                       (* TONY: " 5-NOV-82 10:14")          (* PARENTWINDOW is the window to which the menu window is attached. MENUID is the TITLE string of 	  the menu window. GET-WINDOW-OF-MENU returns the pointer to the window corresponding to the menu.	  *)    (CDR (SASSOC MENUID (WINDOWPROP PARENTWINDOW (QUOTE ITEMMENU))))))(GRAYEDMENUSELECTEDFN  (LAMBDA (ITEM MENU MOUSE)                           (* edited: "22-SEP-82 18:16")    (PROG ((ITEMS (LDIFFERENCE (fetch (MENU ITEMS) of MENU)			       (NLEFT (fetch (MENU ITEMS) of MENU)				      (WINDOWPROP (fetch (MENU IMAGE) of MENU)						  (QUOTE GRAYEDITEMS))))))          (COND	    ((FMEMB ITEM ITEMS)	      (APPLY (WINDOWPROP (fetch (MENU IMAGE) of MENU)				 (QUOTE SELECTEDFN))		     (LIST ITEM MENU MOUSE)))))))(GRAYMENU  (LAMBDA (MAINW MENU #ITEMSTOGRAY NEWBUTTONFN)       (* rgs: " 5-OCT-82 10:20")    (PROG (MI CPX CPY MNU (W (CDR (COND				    ((LISTP MAINW)				      MAINW)				    (T (SASSOC MENU (WINDOWPROP MAINW (QUOTE ITEMMENU)))))				  )))          (COND	    ((NOT (WINDOWP W))	      (RETURN)))          (COND	    ((EQ #ITEMSTOGRAY 0)	      (UNGRAYMENU MAINW MENU)	      (RETURN NIL)))          (SETQ CPX (fetch (REGION LEFT) of (DSPCLIPPINGREGION NIL (WINDOWPROP								 W								 (QUOTE DSP)))))          (SETQ CPY (fetch (REGION BOTTOM) of (DSPCLIPPINGREGION NIL (WINDOWPROP								   W								   (QUOTE DSP)))))          (COND	    ((EQUAL (fetch (MENU WHENSELECTEDFN) of (CAR (WINDOWPROP W (QUOTE MENU))))		    (QUOTE GRAYEDMENUSELECTEDFN))	      (UNGRAYMENU MAINW MENU)))          (COND	    ((NOT (WINDOWPROP W (QUOTE GRAYED)))	      (COND		((NOT (WINDOWPROP W (QUOTE MENUIMAGE)))		  (WINDOWPROP W (QUOTE MENUIMAGE)			      (BITMAPCREATE (fetch (REGION WIDTH)					       of (WINDOWPROP W (QUOTE REGION)))					    (fetch (REGION HEIGHT)					       of (WINDOWPROP W (QUOTE REGION)))))))	      (BITBLT W CPX CPY (WINDOWPROP W (QUOTE MENUIMAGE))		      0 0 NIL NIL (QUOTE INPUT)		      (QUOTE REPLACE))	      (COND		((AND (WINDOWPROP W (QUOTE MENU))		      (NOT (WINDOWPROP W (QUOTE SCROLLFN))))		  (BITBLT W NIL NIL W 2 2 (IPLUS (WINDOWPROP W (QUOTE WIDTH))						 -4)			  (COND			    (#ITEMSTOGRAY (ITIMES #ITEMSTOGRAY						  (fetch (MENU ITEMHEIGHT)						     of (CAR (WINDOWPROP W (QUOTE MENU))))						  ))			    (T (IPLUS (WINDOWPROP W (QUOTE HEIGHT))				      (DSPLINEFEED NIL WindowTitleDisplayStream)				      -4)))			  (QUOTE TEXTURE)			  (QUOTE REPLACE)			  HIGHLIGHTSHADE)		  (COND		    (#ITEMSTOGRAY		      (COND			((OR (MINUSP #ITEMSTOGRAY)			     (IGREATERP #ITEMSTOGRAY					(LENGTH (fetch (MENU ITEMS)						   of (CAR (WINDOWPROP W (QUOTE MENU))))))			     )			  (ERROR "GRAYMENU: #ITEMSTOGRAY argument is 0 or too big")))		      (WINDOWPROP (fetch (MENU IMAGE)				     of (SETQ MNU (CAR (WINDOWPROP W (QUOTE MENU)))))				  (QUOTE GRAYEDITEMS)				  #ITEMSTOGRAY)		      (WINDOWPROP (fetch (MENU IMAGE) of MNU)				  (QUOTE SELECTEDFN)				  (fetch (MENU WHENSELECTEDFN) of MNU))		      (replace (MENU WHENSELECTEDFN) of MNU with (QUOTE 								 GRAYEDMENUSELECTEDFN))		      (WINDOWPROP W (QUOTE SAVEDBUTTONFN)				  NIL))		    (T (WINDOWPROP W (QUOTE SAVEDBUTTONFN)				   (WINDOWPROP W (QUOTE BUTTONEVENTFN)					       NEWBUTTONFN)))))		(T (BITBLT W NIL NIL W CPX CPY (IPLUS (fetch (REGION WIDTH)							 of (WINDOWPROP W (QUOTE REGION)))						      (IMINUS (WINDOWPROP W (QUOTE BORDER)									  )))			   (fetch (REGION HEIGHT) of (WINDOWPROP W (QUOTE REGION)))			   (QUOTE TEXTURE)			   (QUOTE REPLACE)			   HIGHLIGHTSHADE)		   (WINDOWPROP W (QUOTE SAVEDBUTTONFN)			       (WINDOWPROP W (QUOTE BUTTONEVENTFN)					   NEWBUTTONFN))))	      (WINDOWPROP W (QUOTE GRAYED)			  T)	      (WINDOWPROP W (QUOTE SAVEDSCROLLFN)			  (WINDOWPROP W (QUOTE SCROLLFN)				      NIL)))))))(HELPTITLEFN  (LAMBDA (WINDOW)                                    (* TONY: " 9-NOV-82 08:39")    (COND      ((NOT (BOUNDP (QUOTE *HELPTITLEFLG*)))	(SETQ *HELPTITLEFLG* T))      (T (SETQ *HELPTITLEFLG* (NOT *HELPTITLEFLG*))))    (AND *HELPTITLEFLG* (PROMPTPRINT (CAR (WINDOWPROP WINDOW (QUOTE MENUHELPSTRING)))))))(MAKEMENUS  (LAMBDA (WINDOW MENULST WIDTH)                      (* edited: " 1-NOV-82 08:52")          (* * This function creates a set of menus placed along the left side of WINDOW, from top to bottom.	  MENULST is a list of MENULSTENTRY's. WINDOW gets 2 new properties: MINMENUHEIGHT, used to determine	  the placement of the next window relative to the others, and ITEMMENU, a list of 	  (MENUTITLE . WINDOW-CONTAINING-THE-MENU). Menus so created can be deactivated 	  (and grayed-out) by called GRAYMENU with the proper entry from ITEMMENU; UNGRAYMENU with the proper	  argument ungrays the menu and reactivates it)          (* * DRB: 1.NOV. added MAINWINDOW property to windows for MENULST)    (PROG ((MW (OR WIDTH (\FIND-WIDEST-MENU MENULST))))          (COND	    ((NULL (WINDOWPROP WINDOW (QUOTE ITEMMENU)))	      (WINDOWPROP WINDOW (QUOTE MINMENUHEIGHT)			  (fetch (REGION HEIGHT) of (WINDOWPROP WINDOW (QUOTE REGION))))))          (for MENU in MENULST do (\MAKEMENU WINDOW MENU MW))          (WINDOWPROP WINDOW (QUOTE CLOSEFN)		      (QUOTE \MENUCLOSEFN))          (WINDOWPROP WINDOW (QUOTE RESHAPEFN)		      (QUOTE DON'T))          (WINDOWPROP WINDOW (QUOTE MOVEFN)		      (QUOTE \MENUMOVEFN))          (RETURN (WINDOWPROP WINDOW (QUOTE ITEMMENU))))))(MAKETTYWINDOW  (LAMBDA (MAINW TTYWIDTH TTYHEIGHT)                  (* rgs: "14-OCT-82 10:46")          (* * This function makes an ephemeral TTY window beneath the main window, the same width as the 	  main window and menu column combined, and TTY high (defaults to \TTYHEIGHT))    (PROG ((TTYW (WINDOWPROP MAINW (QUOTE TTYWINDOW)))	   BOTTOM LEFT WIDTH (MAINWR (WINDOWPROP MAINW (QUOTE REGION))))          (COND	    ((AND TTYW (NOT TTYWIDTH))	      (RETURN TTYW))	    (T (SETQ BOTTOM (IMAX 0 (IPLUS (IDIFFERENCE					     (IMIN (fetch (REGION BOTTOM) of MAINWR)						   (IPLUS (fetch (REGION BOTTOM)							     of MAINWR)							  (COND							    ((WINDOWPROP MAINW									 (QUOTE 									MINMENUHEIGHT)))							    (T 0))))					     (OR TTYHEIGHT \TTYHEIGHT))					   (LRSH (WINDOWPROP MAINW (QUOTE BORDER))						 1))))	       (SETQ LEFT (fetch (REGION LEFT) of MAINWR))	       (SETQ WIDTH (OR TTYWIDTH (fetch (REGION WIDTH) of MAINWR)))	       (SETQ TTYW		 (CREATEW (create REGION				  LEFT _ LEFT				  BOTTOM _ BOTTOM				  WIDTH _ WIDTH				  HEIGHT _(OR TTYHEIGHT \TTYHEIGHT))))	       (DSPSCROLL (QUOTE ON)			  TTYW)	       (WINDOWPROP MAINW (QUOTE TTYWINDOW)			   TTYW)	       (RETURN TTYW))))))(MENUANDTITLEFN  (LAMBDA (WINDOW)                                    (* TONY: " 9-NOV-82 08:41")    (CLRPROMPT)    (COND      ((WINDOWPROP WINDOW (QUOTE SCROLLFN))	(COND	  ((INSIDEP (DSPCLIPPINGREGION NIL WINDOW)		    (LASTMOUSEX WINDOW)		    (LASTMOUSEY WINDOW))	    (SETQ *HELPTITLEFLG* NIL)	    (MENUBUTTONFN WINDOW))	  (T (HELPTITLEFN WINDOW))))      (T (COND	   ((GEQ (GRIDYCOORD (LASTMOUSEY WINDOW)			     (fetch (MENU MENUGRID) of (CAR (WINDOWPROP WINDOW									(QUOTE MENU)))))		 (LENGTH (fetch (MENU ITEMS) of (CAR (WINDOWPROP WINDOW (QUOTE MENU))))))	     (HELPTITLEFN WINDOW))	   (T (SETQ *HELPTITLEFLG* NIL)	      (MENUBUTTONFN WINDOW)))))    WINDOW))(MENUEXISTS  (LAMBDA (MAINW MENUID)                              (* ejs: "25-SEP-82 15:27")    (COND      ((SASSOC MENUID (WINDOWPROP MAINW (QUOTE ITEMMENU)))	MENUID)      (T NIL))))(MULTIWINDOWREAD  (LAMBDA (WINDOW PROMPT STAYOPENFLG)                 (* ejs: " 6-OCT-82 17:12")    (PROG (TMP (TTYW (MAKETTYWINDOW WINDOW)))          (COND	    ((THIS.PROCESS)	      (PREEMPT.KEYBOARD (RESETLST (RESETSAVE (TTYDISPLAYSTREAM TTYW))					  (SETQ TMP (TTYIN PROMPT NIL PROMPT)))))	    (T (RESETLST (RESETSAVE (TTYDISPLAYSTREAM TTYW))			 (SETQ TMP (TTYIN PROMPT NIL PROMPT)))))          (COND	    ((NOT STAYOPENFLG)	      (CLEARW TTYW)	      (CLOSEW TTYW)))          (RETURN TMP))))(SETUP-MENU-FOR-HELP  (LAMBDA (PARENTWINDOW CURRENT-MENULSTENTRY HELP-STRING)                                                      (* TONY: " 5-NOV-82 14:53")    (PROG ((DEFAULT-HELP-MESSAGE "No help message available...")	   (MENUWINDOW (GET-WINDOW-OF-MENU PARENTWINDOW (fetch (MENULSTENTRY MENUTITLE)							   of CURRENT-MENULSTENTRY))))          (WINDOWADDPROP MENUWINDOW (QUOTE MENUHELPSTRING)			 (OR HELP-STRING DEFAULT-HELP-MESSAGE))          (WINDOWPROP MENUWINDOW (QUOTE BUTTONEVENTFN)		      (QUOTE MENUANDTITLEFN))          (RETURN MENUWINDOW))))(UNGRAYMENU  (LAMBDA (MAINW MENU)                                (* rgs: " 5-OCT-82 10:23")    (PROG (CPX CPY (W (CDR (COND			     ((LISTP MAINW)			       MAINW)			     (T (SASSOC MENU (WINDOWPROP MAINW (QUOTE ITEMMENU))))))))          (COND	    ((NOT (WINDOWP W))	      (RETURN)))          (SETQ CPX (fetch (REGION LEFT) of (DSPCLIPPINGREGION NIL W)))          (SETQ CPY (fetch (REGION BOTTOM) of (DSPCLIPPINGREGION NIL W)))          (COND	    ((WINDOWPROP W (QUOTE GRAYED))	      (BITBLT (WINDOWPROP W (QUOTE MENUIMAGE))		      0 0 (WINDOWPROP W (QUOTE DSP))		      CPX CPY NIL NIL (QUOTE INPUT)		      (QUOTE REPLACE))	      (WINDOWPROP W (QUOTE GRAYED)			  NIL)	      (COND		((WINDOWPROP (fetch (MENU IMAGE) of (CAR (WINDOWPROP W (QUOTE MENU))))			     (QUOTE GRAYEDITEMS)			     NIL)		  (replace (MENU WHENSELECTEDFN) of (CAR (WINDOWPROP W (QUOTE MENU)))		     with (WINDOWPROP (fetch (MENU IMAGE)					 of (CAR (WINDOWPROP W (QUOTE MENU))))				      (QUOTE SELECTEDFN))))		(T (COND		     ((WINDOWPROP W (QUOTE SAVEDBUTTONFN))		       (WINDOWPROP W (QUOTE BUTTONEVENTFN)				   (WINDOWPROP W (QUOTE SAVEDBUTTONFN)))))))	      (WINDOWPROP W (QUOTE SCROLLFN)			  (WINDOWPROP W (QUOTE SAVEDSCROLLFN)))	      (INVERTW W)	      (INVERTW W))))))(WINDOWDOFUN  (LAMBDA (WINDOW FN STAYOPENFLG WIDTH)               (* rgs: "14-OCT-82 10:49")          (* * Function to evaluate an arbitrary function with the TTYDISPLAYSTREAM reset to the TTYWINDOW.	  If STAYOPENFLG is NIL the TTYWINDOW is closed after evaluating FN. If WIDTH is supplied, the 	  TTYWINDOW is made WIDTH pixels wide.)    (PROG (TMP (TTYW (MAKETTYWINDOW WINDOW WIDTH)))          (COND	    ((THIS.PROCESS)	      (PREEMPT.KEYBOARD (RESETLST (RESETSAVE (TTYDISPLAYSTREAM TTYW))					  (SETQ TMP (EVAL FN)))))	    (T (RESETLST (RESETSAVE (TTYDISPLAYSTREAM TTYW))			 (SETQ TMP (EVAL FN)))))          (COND	    ((NOT STAYOPENFLG)	      (CLOSEW TTYW)	      (WINDOWPROP WINDOW (QUOTE TTYWINDOW)			  NIL)))          (RETURN TMP))))(\ADDMULTIMENU1  (LAMBDA (MAINW NEWMENULSTENTRY WHERE)               (* ejs: " 5-OCT-82 15:12")          (* * This function does the real work of ADDMULTIMENU -- WHERE must be either a BEFORE or AFTER 	  dotted pair here)    (PROG (RELPOS NEWPOS REG W OMENUS OMENUS1 (DY (COND						    ((\MAKESCROLLINGMENUP NEWMENULSTENTRY)						      (fetch (MENULSTENTRY MENUSCROLLFLG)							 of NEWMENULSTENTRY))						    (T (\FIND-MENUHEIGHT NEWMENULSTENTRY))						    )))          (COND	    ((\MAKESCROLLINGMENUP NEWMENULSTENTRY)	      (SETQ DY (fetch (MENULSTENTRY MENUSCROLLFLG) of NEWMENULSTENTRY))))          (SETQ OMENUS1 (for M on (WINDOWPROP MAINW (QUOTE ITEMMENU))			   until (EQUAL (CADR WHERE)					(CAAR M))			   collect (CAR M)			   finally (SELECTQ (CAR WHERE)					    (BEFORE (SETQ OMENUS M))					    (AFTER (SETQ OMENUS (CDR M))						   (SETQ $$VAL						     (APPEND $$VAL (LIST (CAR M)))))					    (ERROR "Relation must be BEFORE or AFTER"))))          (COND	    ((NULL OMENUS)	      (\MAKEMENU MAINW NEWMENULSTENTRY (\FIND-WIDEST-WINDOW MAINW))	      (RETURN)))          (SETQ RELPOS (create POSITION			       XCOORD _ 0			       YCOORD _(IMINUS DY)))          (for M in (REVERSE OMENUS) do (RELMOVEW (CDR M)						  RELPOS))          (SETQ REG (WINDOWPROP (CDAR OMENUS)				(QUOTE REGION)))          (SETQ NEWPOS (create POSITION			       XCOORD _(IDIFFERENCE (fetch (REGION LEFT)						       of (WINDOWPROP MAINW (QUOTE REGION)								      ))						    (COND						      ((OR (LISTP NEWMENULSTENTRY)							   (LISTP (EVAL NEWMENULSTENTRY)))							(IPLUS (\FIND-WIDEST-WINDOW								 MAINW)							       2))						      (T (\FIND-MENUWIDTH NEWMENULSTENTRY)							 )))			       YCOORD _(IPLUS (fetch (REGION BOTTOM) of REG)					      (fetch (REGION HEIGHT) of REG))))          (SETQ W (\MAKEMENU1 MAINW NEWMENULSTENTRY NEWPOS))          (WINDOWPROP MAINW (QUOTE ITEMMENU)		      (APPEND OMENUS1 (CONS (CONS (\MAKEMENUID NEWMENULSTENTRY)						  W)					    OMENUS))))))(\FIND-MENUCOLUMN-HEIGHT  (LAMBDA (MENULST)                                   (* ejs: "30-AUG-82 11:59")          (* * This function accepts a MENULST and returns what it thinks will be the height of the column of	  menus created by MAKEMENUS)    (PROG NIL          (RETURN (for M in MENULST sum (\FIND-MENUHEIGHT M))))))(\FIND-MENUHEIGHT  (LAMBDA (MENULSTENTRY)                              (* ejs: "21-SEP-82 16:09")          (* * This function accepts a single MENULSTENTRY and returns its height)    (PROG ((MT (COND		 ((EQUAL (TYPENAME (fetch (MENULSTENTRY MENUITEMS) of MENULSTENTRY))			 (QUOTE LITATOM))		   (TYPENAME (replace (MENULSTENTRY MENUITEMS) of MENULSTENTRY				with (EVAL (fetch (MENULSTENTRY MENUITEMS) of 									 MENULSTENTRY)))))		 (T (TYPENAME (fetch (MENULSTENTRY MENUITEMS) of MENULSTENTRY))))))          (RETURN (SELECTQ MT			   (LISTP (IPLUS (IMINUS (DSPLINEFEED NIL 							     WindowTitleDisplayStream))					 (ITIMES (LENGTH (fetch (MENULSTENTRY MENUITEMS)							    of MENULSTENTRY))						 (FONTPROP (QUOTE (HELVETICA 10))							   (QUOTE HEIGHT)))					 4))			   (WINDOW (fetch (REGION HEIGHT) of (WINDOWPROP MENULSTENTRY									 (QUOTE REGION))))			   (MENU (fetch (MENU IMAGEHEIGHT) of MENULSTENTRY))			   0)))))(\FIND-MENUWIDTH  (LAMBDA (MENULSTENTRY)                              (* PS: "28-OCT-82 11:14")          (* * This function returns the width of a single MENULSTENTRY)    (PROG ((MT (COND		 ((EQUAL (TYPENAME (fetch (MENULSTENTRY MENUITEMS) of MENULSTENTRY))			 (QUOTE LITATOM))		   (TYPENAME (SETQ MENULSTENTRY (EVAL (fetch (MENULSTENTRY MENUITEMS)							 of MENULSTENTRY)))))		 (T (TYPENAME (fetch (MENULSTENTRY MENUITEMS) of MENULSTENTRY))))))          (RETURN	    (SELECTQ MT		     (LISTP (IMAX (IPLUS (STRINGWIDTH (fetch (MENULSTENTRY MENUTITLE)							 of MENULSTENTRY)						      (DSPFONT NIL 							     WindowTitleDisplayStream))					 6)				  (IPLUS (for W					    in (MAPCAR (fetch (MENULSTENTRY MENUITEMS)							  of MENULSTENTRY)						       (FUNCTION (LAMBDA (I)							   (STRINGWIDTH							     (COND							       ((LISTP I)								 (CAR I))							       (T I))							     (QUOTE (HELVETICA 10))))))					    maximizing W)					 4)))		     (WINDOW (IDIFFERENCE (fetch (REGION WIDTH)					     of (WINDOWPROP (fetch (MENULSTENTRY 									    MENUITEMS)							       of MENULSTENTRY)							    (QUOTE REGION)))					  4))		     (MENU (fetch (MENU IMAGEWIDTH) of (fetch (MENULSTENTRY MENUITEMS)							  of MENULSTENTRY)))		     0)))))(\FIND-WIDEST-MENU  (LAMBDA (MENULST)                                   (* ejs: "30-AUG-82 11:54")          (* * This function accepts a list of MENULSTENTRY's, and returns the width of the widest menu in 	  the list, allowing a set of menus to be stacked on top of one another (in Y, not Z), each the same 	  width)    (PROG ((MAXW 0)	   MT)          (RETURN (for M in MENULST do (SETQ MAXW (IMAX MAXW (\FIND-MENUWIDTH M)))		     finally (RETURN MAXW))))))(\FIND-WIDEST-WINDOW  (LAMBDA (MAINW)                                     (* edited: "22-SEP-82 18:25")    (PROG ((MAXW 0))          (for W in (WINDOWPROP MAINW (QUOTE ITEMMENU))	     do (SETQ MAXW (IMAX MAXW (fetch (REGION WIDTH) of (WINDOWPROP (CDR W)									   (QUOTE REGION))					     ))))          (RETURN (IDIFFERENCE MAXW 4)))))(\MAKEMENU  (LAMBDA (WINDOW MENULSTENTRY WIDTH)                 (* edited: " 1-NOV-82 10:07")          (* * This function puts up the correct menu based on the type of item selected)    (PROG (M W ENTRY (WREGION (WINDOWPROP WINDOW (QUOTE REGION)))	     (MTYPE (SELECTQ (TYPENAME (fetch (MENULSTENTRY MENUITEMS) of MENULSTENTRY))			     (LISTP (QUOTE LISTP))			     (MENU (QUOTE MENU))			     (WINDOW (QUOTE WINDOW))			     (LITATOM (TYPENAME (replace (MENULSTENTRY MENUITEMS)						   of MENULSTENTRY						   with (EVAL (fetch (MENULSTENTRY 									    MENUITEMS)								 of MENULSTENTRY)))))			     (ERROR "MENULSTENTRY must be MENULSTENTRY, WINDOW, or MENU"))		    ))          (OR (fetch (MENULSTENTRY MENUID) of MENULSTENTRY)	      (SELECTQ MTYPE		       (MENU (replace (MENULSTENTRY MENUID) of MENULSTENTRY				with (fetch (MENU TITLE) of (fetch (MENULSTENTRY 									    MENUITEMS)							       of MENULSTENTRY))))		       (WINDOW (replace (MENULSTENTRY MENUID) of MENULSTENTRY				  with (WINDOWPROP (fetch (MENULSTENTRY MENUITEMS)						      of MENULSTENTRY)						   (QUOTE TITLE))))		       NIL))          (SETQ ENTRY (FASSOC (fetch (MENULSTENTRY MENUID) of MENULSTENTRY)			      (WINDOWPROP WINDOW (QUOTE ITEMMENU))))          (COND	    ((NOT ENTRY)	      (SETQ M (SELECTQ MTYPE			       (LISTP (PROG ((TMPMENU (create MENU							      ITEMS _(fetch (MENULSTENTRY									      MENUITEMS)									of MENULSTENTRY)							      CENTERFLG _ T							      MENUOUTLINESIZE _ 2							      TITLE _(COND								((NOT (\MAKESCROLLINGMENUP									MENULSTENTRY))								  (fetch (MENULSTENTRY									   MENUTITLE)								     of MENULSTENTRY))								(T NIL))							      ITEMWIDTH _ WIDTH))					     (SELFN (fetch (MENULSTENTRY SELECTEDFN)						       of MENULSTENTRY)))					    (COND					      (SELFN (replace (MENU WHENSELECTEDFN)							of TMPMENU with SELFN)))					    (RETURN TMPMENU)))			       ((MENU WINDOW)				 (fetch (MENULSTENTRY MENUITEMS) of MENULSTENTRY))			       (ERROR 				 "MENULSTENTRY must be MENULSTENTRY, WINDOW, or MENU")))	      (SETQ W		(SELECTQ		  MTYPE		  ((LISTP MENU)		    (PROG ((TPOS (create POSITION					 XCOORD _(IPLUS (IDIFFERENCE (fetch (REGION									      LEFT)									of WREGION)								     (fetch (MENU 									   IMAGEWIDTH)									of M))							2)					 YCOORD _(IDIFFERENCE					   (IPLUS (fetch (REGION BOTTOM) of WREGION)						  (WINDOWPROP WINDOW (QUOTE MINMENUHEIGHT)							      ))					   (COND					     ((AND (\MAKESCROLLINGMENUP MENULSTENTRY)						   (NUMBERP (fetch (MENULSTENTRY 									MENUSCROLLFLG)							       of MENULSTENTRY))))					     (T (fetch (MENU IMAGEHEIGHT) of M))))))			   TW)		          (RETURN (PROG1 (ADDMENU M (SETQ TW (\MAKEMENUWINDOW						      MENULSTENTRY TPOS						      (fetch (MENU IMAGEWIDTH)							 of M)))						  (COND						    (TW (create POSITION								XCOORD _ -4								YCOORD _ 0))						    (T TPOS))						  (\MAKESCROLLINGMENUP MENULSTENTRY))					 (COND					   ((\MAKESCROLLINGMENUP MENULSTENTRY)					     (SCROLLBYREPAINTFN TW .5 0.0)))))))		  (WINDOW (PROGN (MOVEW M					(create POSITION						XCOORD _(IPLUS						  (IDIFFERENCE						    (fetch (REGION LEFT) of WREGION)						    (fetch (REGION WIDTH)						       of (WINDOWPROP M (QUOTE REGION))))						  (LRSH (WINDOWPROP M (QUOTE BORDER))							1))						YCOORD _(IDIFFERENCE						  (IPLUS (fetch (REGION BOTTOM)							    of WREGION)							 (WINDOWPROP WINDOW (QUOTE 									MINMENUHEIGHT)))						  (fetch (REGION HEIGHT)						     of (WINDOWPROP M (QUOTE REGION))))))				 (TOTOPW M)				 M))		  (ERROR "MENULSTENTRY must be MENULSTENTRY, WINDOW, or MENU")))	      (WINDOWPROP WINDOW (QUOTE MINMENUHEIGHT)			  (IDIFFERENCE (WINDOWPROP WINDOW (QUOTE MINMENUHEIGHT))				       (fetch (REGION HEIGHT) of (WINDOWPROP								   W								   (QUOTE REGION)))))	      (WINDOWADDPROP WINDOW (QUOTE ITEMMENU)			     (CONS (\MAKEMENUID MENULSTENTRY)				   W))          (* * DRB: MAINWINDOW provides pointer from menu's window to main window)	      (WINDOWPROP W (QUOTE MAINWINDOW)			  WINDOW))	    (T (OPENW (CDR ENTRY)))))))(\MAKEMENU1  (LAMBDA (WINDOW MENULSTENTRY NEWPOS)                (* ejs: "22-SEP-82 09:47")          (* * This function puts up the correct menu based on the type of item selected)    (PROG (M W W1 (MTYPE (SELECTQ (TYPENAME (fetch (MENULSTENTRY MENUITEMS) of 									 MENULSTENTRY))				  (LISTP (QUOTE LISTP))				  (MENU (QUOTE MENU))				  (WINDOW (QUOTE WINDOW))				  (LITATOM (TYPENAME (replace (MENULSTENTRY MENUITEMS)							of MENULSTENTRY							with (EVAL (fetch (MENULSTENTRY									    MENUITEMS)								      of MENULSTENTRY)))))				  (ERROR 				 "MENULSTENTRY must be MENULSTENTRY, WINDOW, or MENU"))))          (RETURN	    (SELECTQ	      MTYPE	      ((LISTP MENU)		(PROG ((TW (ADDMENU (COND				      ((EQUAL MTYPE (QUOTE LISTP))					(PROG ((TMPMENU (create MENU								ITEMS _(fetch								  (MENULSTENTRY MENUITEMS)									  of MENULSTENTRY)								CENTERFLG _ T								MENUOUTLINESIZE _ 2								TITLE _(COND								  ((NOT (\MAKESCROLLINGMENUP MENULSTENTRY))								    (fetch (MENULSTENTRY									     MENUTITLE)								       of MENULSTENTRY))								  (T NIL))								ITEMWIDTH _(								  \FIND-WIDEST-WINDOW								  WINDOW)))					       (SELFN (fetch (MENULSTENTRY SELECTEDFN)							 of MENULSTENTRY)))					      (COND						(SELFN (replace (MENU WHENSELECTEDFN)							  of TMPMENU with SELFN)))					      (RETURN TMPMENU)))				      (T (fetch (MENULSTENTRY MENUITEMS) of MENULSTENTRY))				      )				    (SETQ W1 (\MAKEMENUWINDOW MENULSTENTRY NEWPOS							      (IPLUS (\FIND-WIDEST-WINDOW								       WINDOW)								     4)))				    (COND				      (W1 (create POSITION						  XCOORD _ 0						  YCOORD _ 0))				      (T NEWPOS))				    (\MAKESCROLLINGMENUP MENULSTENTRY))))		      (COND			((\MAKESCROLLINGMENUP MENULSTENTRY)			  (SCROLLBYREPAINTFN TW .5 0.0)))		      (RETURN TW)))	      (WINDOW (PROG ((W (fetch (MENULSTENTRY MENUITEMS) of MENULSTENTRY)))			    (MOVEW W NEWPOS)			    (TOTOPW W)			    (RETURN W)))	      (ERROR "MENULSTENTRY must be MENULSTENTRY, WINDOW, or MENU"))))))(\MAKEMENUID  (LAMBDA (MENULSTENTRY)                              (* ejs: "30-AUG-82 11:48")    (OR (fetch (MENULSTENTRY MENUID) of MENULSTENTRY)	(replace (MENULSTENTRY MENUID) of MENULSTENTRY with (fetch (MENULSTENTRY 									    MENUTITLE)							       of MENULSTENTRY)))))(\MAKEMENUWINDOW  (LAMBDA (MENULSTENTRY POS WIDTH)                    (* rgs: "23-SEP-82 14:32")    (PROG ((SFLG (fetch (MENULSTENTRY MENUSCROLLFLG) of MENULSTENTRY)))          (RETURN (COND		    ((AND (NUMBERP SFLG)			  (\MAKESCROLLINGMENUP MENULSTENTRY))		      (CREATEW (create REGION				       LEFT _(fetch XCOORD of POS)				       BOTTOM _(fetch YCOORD of POS)				       WIDTH _ WIDTH				       HEIGHT _ SFLG)			       (fetch (MENULSTENTRY MENUTITLE) of MENULSTENTRY)			       4 NIL))		    (T NIL))))))(\MAKESCROLLINGMENUP  (LAMBDA (MENULSTENTRY)                              (* ejs: "21-SEP-82 13:28")          (* * This function returns T if the menu specified by MENULSTENTRY should scroll)    (PROG ((SFLG (fetch (MENULSTENTRY MENUSCROLLFLG) of MENULSTENTRY)))          (RETURN (COND		    (SFLG (COND			    ((AND (NUMBERP SFLG)				  (IGREATERP (\FIND-MENUHEIGHT MENULSTENTRY)					     SFLG))			      T)			    (T NIL)))		    (T NIL))))))(\MENUCLOSEFN  (LAMBDA (WINDOW)                                    (* ejs: "28-AUG-82 13:13")    (for W in (WINDOWPROP WINDOW (QUOTE ITEMMENU)) do (CLOSEW (CDR W)))))(\MENUMOVEFN  (LAMBDA (WINDOW NEWPOS)                             (* ejs: "31-AUG-82 08:09")    (PROG ((RELPOS (create POSITION			   XCOORD _(IDIFFERENCE (fetch XCOORD of NEWPOS)						(fetch (REGION LEFT)						   of (WINDOWPROP WINDOW (QUOTE REGION))))			   YCOORD _(IDIFFERENCE (fetch YCOORD of NEWPOS)						(fetch (REGION BOTTOM)						   of (WINDOWPROP WINDOW (QUOTE REGION))))			   )))          (for W in (COND		      ((ILESSP (fetch YCOORD of RELPOS)			       0)			(REVERSE (WINDOWPROP WINDOW (QUOTE ITEMMENU))))		      (T (WINDOWPROP WINDOW (QUOTE ITEMMENU))))	     do (RELMOVEW (CDR W)			  RELPOS)))))(\UPDATEMINMENU  (LAMBDA (MAINW)                                     (* ejs: "31-AUG-82 09:13")    (WINDOWPROP MAINW (QUOTE MINMENUHEIGHT)		(IDIFFERENCE (fetch (REGION BOTTOM)				of (WINDOWPROP (CDAR (FLAST (WINDOWPROP MAINW									(QUOTE ITEMMENU)))						     )					       (QUOTE REGION)))			     (fetch (REGION BOTTOM) of (WINDOWPROP MAINW (QUOTE REGION))))		))))[DECLARE: EVAL@COMPILE (RECORD MENULSTENTRY (MENUITEMS MENUTITLE SELECTEDFN MENUID MENUSCROLLFLG))](RPAQQ MULTIMENUVARS (\TTYHEIGHT *HELPTITLEFLG*))(RPAQQ \TTYHEIGHT 80)(RPAQQ *HELPTITLEFLG* NIL)(DECLARE: DONTEVAL@LOAD DOEVAL@COMPILE DONTCOPY COMPILERVARS (ADDTOVAR NLAMA )(ADDTOVAR NLAML )(ADDTOVAR LAMA ))(DECLARE: DONTCOPY  (FILEMAP (NIL (1054 32266 (ADDMULTIMENU 1064 . 2415) (CHANGEMULTIMENU 2417 . 4905) (CREATEWINDOWFROMBOX 4907 . 5451) (DELETEALLMENUS 5453 . 5780) (DELMULTIMENU 5782 . 5925) (GET-WINDOW-OF-MENU 5927 . 6337) (GRAYEDMENUSELECTEDFN 6339 . 6831) (GRAYMENU 6833 . 10029) (HELPTITLEFN 10031 . 10358) (MAKEMENUS 10360 . 11716) (MAKETTYWINDOW 11718 . 13007) (MENUANDTITLEFN 13009 . 13725) (MENUEXISTS 13727 . 13922) (MULTIWINDOWREAD 13924 . 14442) (SETUP-MENU-FOR-HELP 14444 . 15026) (UNGRAYMENU 15028 . 16356) (WINDOWDOFUN 16358 . 17140) (\ADDMULTIMENU1 17142 . 19297) (\FIND-MENUCOLUMN-HEIGHT 19299 . 19660) (\FIND-MENUHEIGHT 19662 . 20682) (\FIND-MENUWIDTH 20684 . 22059) (\FIND-WIDEST-MENU 22061 . 22569) (\FIND-WIDEST-WINDOW 22571 . 22942) (\MAKEMENU 22944 . 27410) (\MAKEMENU1 27412 . 29618) (\MAKEMENUID 29620 . 29937) (\MAKEMENUWINDOW 29939 . 30507) (\MAKESCROLLINGMENUP 30509 . 30985) (\MENUCLOSEFN 30987 . 31175) (\MENUMOVEFN 31177 . 31864) (\UPDATEMINMENU 31866 . 32264)))))STOP