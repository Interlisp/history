(DEFINE-FILE-INFO PACKAGE "INTERLISP" READTABLE "INTERLISP" BASE 10)(FILECREATED " 9-Mar-99 16:15:48" {DSK}<project>medley3.5>library>SAMEDIR.;3 6060         changes to%:  (FNS CHECKSAMEDIR)      previous date%: "12-Jun-90 11:18:52" {DSK}<project>medley3.5>library>SAMEDIR.;1)(* ; "Copyright (c) 1982, 1984, 1985, 1986, 1987, 1990, 1999 by Venue & Xerox Corporation.  All rights reserved.")(PRETTYCOMPRINT SAMEDIRCOMS)(RPAQQ SAMEDIRCOMS ((FNS CHECKSAMEDIR HOST&DIRECTORYFIELD)                        (ADDVARS [MAKEFILEFORMS (OR (NLSETQ (CHECKSAMEDIR FILE))                                                    (RETFROM 'MAKEFILE]                               (MIGRATIONS))                        (GLOBALVARS MIGRATIONS)))(DEFINEQ(CHECKSAMEDIR  [LAMBDA (FILE)                                             (* ; "Edited  9-Mar-99 16:15 by rmk:")                                                             (* ; "Edited  9-Mar-99 16:14 by rmk:")                                                             (* ; "Edited  9-Mar-99 16:13 by rmk:")                                                             (* ; "Edited  9-Mar-99 16:03 by rmk:")                                                             (* ;                                                            "Edited 12-Jun-90 11:18 by mitani")    (* ;; "Check (a) that we are writing FILE to the same directory we last read/wrote it and (b) that a version newer than the current one has not since appeared.")    (* ;; " OKHOST/DIRS is a list of places it's OK for the file to be winding up, so if your'e migrating code from one place ot another, you can do it gracefully.")    (PROG ((*UPPER-CASE-FILE-NAMES* NIL)           (DATES (GET (SETQ FILE (MKATOM (U-CASE FILE)))                       'FILEDATES))           HOST/DIR HOST DIR NEWV OKHOST/DIRS)      AGAIN          (OR (LISTP DATES)              (RETURN))          [SETQ OKHOST/DIRS (CONS (SETQ HOST/DIR (DIRECTORYNAME T))                                  (MKLIST (CDR (ASSOC HOST/DIR MIGRATIONS :TEST 'STRING-EQUAL]          (COND             ([for OLDFILE in DATES bind HOST DIR                 never                 (CL:MEMBER (HOST&DIRECTORYFIELD (CDR OLDFILE))                        OKHOST/DIRS :TEST                        (FUNCTION (LAMBDA (A B)                                    (* ;;                "If STRING-EQUAL fails, we check to see if there is merely a mismatch in /, \, <, >")                                    (OR (STRING-EQUAL A B)                                        (AND (EQ (NCHARS A)                                                 (NCHARS B))                                             (FOR I AC BC FROM 1                                                WHILE (SETQ AC (NTHCHAR A I))                                                ALWAYS (SETQ BC (NTHCHAR B I))                                                      (OR (EQ AC BC)                                                          (EQ (U-CASE AC)                                                              (U-CASE BC))                                                          (AND (MEMB AC '(/ \ < >))                                                               (MEMB BC '(/ \ > <]              (* ;; "The file is going somewhere it has never been before.  ")              (* ;; "Check that that is really what the user wants.")              (SELECTQ (ASKUSER 10 'Y (LIST "You haven't loaded or written" FILE                                             "in your connected directory" HOST/DIR                                             "-- write it out anyway")                              `((O ,(CONCAT "Oops!  Connect to " (SETQ HOST/DIR (                                                                               HOST&DIRECTORYFIELD                                                                                 (CDAR DATES)))                                           " [confirm] ")                                   CONFIRMFLG T)                                (C "Connect to other directory: ")                                (Y "Yes, write it here")                                (N "No, abort MAKEFILE"))                              NIL NIL '(NOECHOFLG T))                  (Y (RETURN))                  (N (ERROR!))                  (C (SETQ HOST/DIR))                  (O (TERPRI T))                  (SHOULDNT))              [NLSETQ (CNDIR (OR HOST/DIR (READ T T]              (GO AGAIN))             ([AND [SETQ NEWV (INFILEP (PACKFILENAME.STRING 'VERSION NIL 'BODY (CDAR DATES]                   (NOT (STRING-EQUAL NEWV (CDAR DATES]              (* ;; "A newer version appeared while the user was editing this file.")              (* ;; "Ask if he should over-write it.")              (SELECTQ (ASKUSER 15 'Y (LIST (CDAR DATES)                                            "is not the most recent version (version"                                            (MKSTRING (FILENAMEFIELD NEWV 'VERSION))                                            "has since appeared)."                                             "Do you want to make the file anyway"))                  (Y)                  (N (ERROR!))                  (SHOULDNT])(HOST&DIRECTORYFIELD(LAMBDA (FILENAME) (* ; "Edited 18-Dec-87 18:47 by bvm:") (* ;; "Returns the host&dir fields packed together.") (for TAIL on (UNPACKFILENAME.STRING FILENAME) by (CDDR TAIL) do (COND ((FMEMB (CAR TAIL) (QUOTE (HOST DIRECTORY DEVICE))) (push $$VAL (CAR TAIL) (CADR TAIL)))) finally (RETURN (CL:APPLY (FUNCTION PACKFILENAME.STRING) $$VAL))))))(ADDTOVAR MAKEFILEFORMS (OR (NLSETQ (CHECKSAMEDIR FILE))                                (RETFROM 'MAKEFILE)))(ADDTOVAR MIGRATIONS )(DECLARE%: DOEVAL@COMPILE DONTCOPY(GLOBALVARS MIGRATIONS))(PUTPROPS SAMEDIR COPYRIGHT ("Venue & Xerox Corporation" 1982 1984 1985 1986 1987 1990 1999))(DECLARE%: DONTCOPY  (FILEMAP (NIL (752 5737 (CHECKSAMEDIR 762 . 5368) (HOST&DIRECTORYFIELD 5370 . 5735)))))STOP