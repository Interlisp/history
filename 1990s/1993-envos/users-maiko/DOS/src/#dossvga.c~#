/* Super VGA routines for DOS. */#include <conio.h>#define ET3000	0x20#define ET4000	0x21/* G e t _ c h i p s e t returns the type of chipset we are dealing with.*/get_chipset(){  if (vga_tseng_p())    if(vga_tseng4k_p()) {      return( ET4000 );      } else {	return( ET3000 );      }}/********************************************************************//* v g a _ t s e n g _ p if we can twiddle the high bits in the ATC *//* Misc. register we have a Tseng chip.                             *//********************************************************************/vga_tseng_p(){  unsigned char new_value,old_value, value;  outp(0x3bf, 3);		/* Set the key. */  if ((inp(0x3cc) & 1) == 1)    outp(0x3d8, 0xa0);  else outp(0x3b8, 0xa0);  /* read the old value */  inp(0x3da);			/* dummy read to set up attribute index */  outp(0x3c0, 0x16);		/* index ATC Misc Reg */  old_value = inp(0x3c1);  /* write a new value */  inp(0x3da);			/* dummy read to set up attribute index */  outp(0x3c0, 0x16);  new_value = old_value ^ 0x10;  outp(0x3c0, new_value);  /* read the new value */  inp(0x3da);  outp(0x3c0, 0x16);  value = inp(0x3c1);  /* write the old value */  inp(0x3da);  outp(0x3c0, 0x16);  outp(0x3c0, old_value);  return (value == new_value);}/********************************************************************//* v g a _ t s e n g 4 k _ p if we can twiddle the high bits in the *//* CRTC. register we have a Tseng chip.                             *//********************************************************************/vga_tseng4k_p(){  int base;  unsigned char new_value, old_value;  base = (inp (0x3cc) & 0x01 == 1) ? 0x3d0 :  0x3b0;  /* Get old value */  outp( base+4, 0x33);  old_value = inp (base+5);  /* Put/Get new value */  outp( base+5, old_value ^ 0x0f );  new_value = inp (base+5);  /* Restore old value */  outp(base+5, old_value);  return(new_value == old_value ^0xf);}main(){  switch (get_chipset()) {  case ET3000 :    printf("Et 3000\n");    break;  case ET4000 :    printf("Et 4000\n");    break;    default :      printf ("Foot\n");  }}