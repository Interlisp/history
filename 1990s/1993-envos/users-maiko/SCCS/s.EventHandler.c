h29723s 00002/00002/00259d D 1.3 91/08/26 15:25:39 sybalsky 3 2c ??es 00170/00109/00091d D 1.2 91/04/16 14:52:12 sybalsky 2 1c Retrofit foreign-OS changes from Savoir.es 00200/00000/00000d D 1.1 90/03/01 15:30:15 osamu 1 0c date and time created 90/03/01 15:30:15 by osamueuUf e 0tTI 1D 3/* %Z% %M% Version %I% (%G%). copyright venue & Fuji Xerox  */static char *id = "%Z% %M%	%I% %G%	(venue & Fuji Xerox)";E 3I 3/* @(#) EventHandler.c Version 1.2 (4/16/91). copyright venue & Fuji Xerox  */static char *id = "@(#) EventHandler.c	1.2 4/16/91	(venue & Fuji Xerox)";E 3D 2/**** Copyright (C) 1988 by Fuji Xerox co.,Ltd. All rights reserved.**		Author: Mitsunori Matsuda*		Date  : August 18, 1988*/E 2I 2/************************************************************************//*									*//*	(C) Copyright 1989, 1990, 1991 Venue. All Rights Reserved.	*//*	Manufactured in the United States of America.			*//*									*//*	The contents of this file are proprietary information 		*//*	belonging to Venue, and are provided to you under license.	*//*	They may not be further distributed or disclosed to third	*//*	parties without the specific permission of Venue.		*//*									*//************************************************************************/E 2#include <stdio.h>#include <X11/Xlib.h>#include <X11/Xutil.h>#include "XVersion.h"#include "MyWindow.h"#include "lispXbitblt.h"#define FALSE 0#define TRUE  !FALSEint Mouse_Included = FALSE;extern Display *Xdisplay;extern XImage XScreenBitmap;extern XSetWindowAttributes Lisp_SetWinAttributes;extern DisplayArea ScreenRegion;extern MyWindow Display_Window	      , Lisp_Window	      , Grav_Window[];extern int Bit_Gravity;extern int Auto_Repeat;I 2extern int Def_Auto_Repeat;E 2extern int Backing_Store;I 2/************************************************************************//*									*//*			l i s p _ X e x p o s e				*//*									*//*	Handle an "Expose" event from X.				*//*									*//************************************************************************/E 2lisp_Xexpose( event, window )D 2XExposeEvent *event;MyWindow *window;{E 2I 2  XExposeEvent *event;  MyWindow *window;  {E 2#ifdef TRACED 2	printf( "TRACE:	lisp_Xexpose()\n" );	printf( "lisp_Xexpose: Exposed region x=%d, y=%d, w=%d, h=%d\n"		, event->x, event->y, event->width, event->height );E 2I 2    printf( "TRACE:	lisp_Xexpose()\n" );    printf( "lisp_Xexpose: Exposed region x=%d, y=%d, w=%d, h=%d\n"    	, event->x, event->y, event->width, event->height );E 2#endifD 2	/* Repair Display Window */	Xbitblt ( event->x+ScreenRegion.left_x		, event->y+ScreenRegion.top_y		, event->width		, event->height );E 2I 2    /* Repair Display Window */    Xbitblt ( event->x+ScreenRegion.left_x	    , event->y+ScreenRegion.top_y	    , event->width	    , event->height );E 2D 2} /* end lisp_Xexpose */E 2I 2  } /* end lisp_Xexpose */E 2I 2/************************************************************************//*									*//*									*//*									*//*									*//*									*//************************************************************************/E 2Raise_LispWindow( event, window )D 2XCrossingEvent *event;MyWindow *window;{E 2I 2  XCrossingEvent *event;  MyWindow *window;  {E 2#ifdef TRACED 2	printf( "TRACE:Rase_LispWindow()\n" );E 2I 2    printf( "TRACE:Rase_LispWindow()\n" );E 2#endifD 2	if( !Backing_Store ) {		XRaiseWindow( Xdisplay, Lisp_Window.win );		XFlush( Xdisplay );	}E 2I 2    if( !Backing_Store )      {	XRaiseWindow( Xdisplay, Lisp_Window.win );	XFlush( Xdisplay );      }E 2D 2} /* end Raise_LispWindow */E 2I 2  } /* end Raise_LispWindow */E 2I 2/************************************************************************//*									*//*									*//*									*//*									*//*									*//************************************************************************/E 2#define North_West 0#define North_East 1#define South_West 2#define South_East 3extern Pixmap GravityOn_Pixmap            , GravityOff_Pixmap;Set_BitGravity( event, window )D 2XButtonEvent *event;MyWindow  *window;{E 2I 2  XButtonEvent *event;  MyWindow  *window;  {E 2D 2	int old_gravity	  , win;E 2I 2    int old_gravity, win;E 2#ifdef TRACED 2	printf( "TRACE: Set_BitGravity()\" );E 2I 2    printf( "TRACE: Set_BitGravity()\" );E 2#endifD 2	old_gravity = Bit_Gravity;E 2I 2    old_gravity = Bit_Gravity;E 2D 2	if( (event->type == ButtonPress) E 2I 2    if( (event->type == ButtonPress) E 2	 && ((event->button & 0xFF) == Button1) ) {		if( window->win == Grav_Window[0].win )      			Bit_Gravity = NorthWestGravity;		else if( window->win == Grav_Window[1].win ) 			Bit_Gravity = NorthEastGravity;		else if( window->win == Grav_Window[2].win ) 			Bit_Gravity = SouthWestGravity;		else if( window->win == Grav_Window[3].win ) 			Bit_Gravity = SouthEastGravity;	} /* end if(button) */D 2	if( Bit_Gravity != old_gravity ) { /* gravity changed */E 2I 2    if( Bit_Gravity != old_gravity )      { /* gravity changed */E 2D 2		if( old_gravity == NorthWestGravity ) win = North_West;		if( old_gravity == NorthEastGravity ) win = North_East;		if( old_gravity == SouthWestGravity ) win = South_West;		if( old_gravity == SouthEastGravity ) win = South_East;E 2I 2	if( old_gravity == NorthWestGravity ) win = North_West;	if( old_gravity == NorthEastGravity ) win = North_East;	if( old_gravity == SouthWestGravity ) win = South_West;	if( old_gravity == SouthEastGravity ) win = South_East;E 2D 2		/* Change Background Pixmap of Gravity Window */		XSetWindowBackgroundPixmap( Xdisplay					, Grav_Window[win].win					, GravityOff_Pixmap );		XClearWindow( Xdisplay, Grav_Window[win].win );E 2I 2	/* Change Background Pixmap of Gravity Window */	XSetWindowBackgroundPixmap( Xdisplay				, Grav_Window[win].win				, GravityOff_Pixmap );	XClearWindow( Xdisplay, Grav_Window[win].win );E 2D 2		XSetWindowBackgroundPixmap( Xdisplay					, window->win 					, GravityOn_Pixmap );		XClearWindow( Xdisplay, window->win );E 2I 2	XSetWindowBackgroundPixmap( Xdisplay				, window->win 				, GravityOn_Pixmap );	XClearWindow( Xdisplay, window->win );E 2D 2		/* Display BitGravity */		Lisp_SetWinAttributes.bit_gravity = Bit_Gravity;		XChangeWindowAttributes( Xdisplay					, Display_Window.win					, CWBitGravity					, &Lisp_SetWinAttributes );E 2I 2	/* Display BitGravity */	Lisp_SetWinAttributes.bit_gravity = Bit_Gravity;	XChangeWindowAttributes( Xdisplay				, Display_Window.win				, CWBitGravity				, &Lisp_SetWinAttributes );E 2D 2		/* Lisp_Window Window Gravity */		/*		Lisp_SetWinAttributes.win_gravity = Bit_Gravity;		XChangeWindowAttributes( Xdisplay					, Lisp_Window.win					, CWWinGravity					, &Lisp_SetWinAttributes );		*/		XFlush( Xdisplay );	} /* end if */E 2I 2	/* Lisp_Window Window Gravity */	/*	Lisp_SetWinAttributes.win_gravity = Bit_Gravity;	XChangeWindowAttributes( Xdisplay				, Lisp_Window.win				, CWWinGravity				, &Lisp_SetWinAttributes );	*/	XFlush( Xdisplay );      } /* end if */E 2D 2} /* end Set_BitGravity */E 2I 2  } /* end Set_BitGravity */E 2I 2/************************************************************************//*									*//*									*//*									*//*									*//*									*//************************************************************************/E 2extern int LispWindow_MaxWidth	    , LispWindow_MaxHeight;lisp_Xconfigure( event, window )D 2XConfigureEvent *event;MyWindow *window;{	int flag;E 2I 2  XConfigureEvent *event;  MyWindow *window;  {    int flag;E 2#ifdef TRACED 2	printf( "TRACE: lisp_Xconfigure()\n" );E 2I 2    printf( "TRACE: lisp_Xconfigure()\n" );E 2#endifD 2	window->x = event->x;	window->y = event->y;E 2I 2    window->x = event->x;    window->y = event->y;E 2D 2	if( (event->width  != window->width)	 || (event->height != window->height) ) { /* Lisp Window Resized */E 2I 2    if( (event->width  != window->width)     || (event->height != window->height) )      { /* Lisp Window Resized */E 2D 2		window->width  = event->width;		window->height = event->height;E 2I 2	window->width  = event->width;	window->height = event->height;E 2	D 2		flag = FALSE;E 2I 2	flag = FALSE;E 2D 2		if( window->width > LispWindow_MaxWidth ) {			window->width  = LispWindow_MaxWidth;			flag = TRUE;		}		if( window->height > LispWindow_MaxHeight ) {			window->height = LispWindow_MaxHeight;			flag = TRUE;		}		if( flag )			XResizeWindow( Xdisplay				     , window->win				     , window->width 				     , window->height );E 2I 2	if( window->width > LispWindow_MaxWidth )	  {	    window->width  = LispWindow_MaxWidth;	    flag = TRUE;	  }	if( window->height > LispWindow_MaxHeight )	  {	    window->height = LispWindow_MaxHeight;	    flag = TRUE;	  }	if( flag ) XResizeWindow( Xdisplay, window->win				  , window->width, window->height );E 2D 2		Resize_Subwindows();E 2I 2	Resize_Subwindows();E 2D 2	} /* end if */E 2I 2      } /* end if */E 2D 2} /* end lisp_Xconfigure */E 2I 2  } /* end lisp_Xconfigure */E 2I 2/************************************************************************//*									*//*									*//*									*//*									*//*									*//************************************************************************/E 2mouse_Xcrossed( event, window )D 2XCrossingEvent *event;MyWindow *window;{E 2I 2  XCrossingEvent *event;  MyWindow *window;  {E 2#ifdef TRACED 2	printf( "TRACE: mouse_Xcrossed()\n" );E 2I 2    printf( "TRACE: mouse_Xcrossed()\n" );E 2#endifD 2	if( event->type == EnterNotify ) {		Mouse_Included = TRUE;		if( !Auto_Repeat ) XAutoRepeatOff( Xdisplay );	}	if( event->type == LeaveNotify ) {		Mouse_Included = FALSE;		if( !Auto_Repeat ) XAutoRepeatOn( Xdisplay );	}} /* end mouse_Xcrossed */E 2I 2    if( event->type == EnterNotify )      {	Mouse_Included = TRUE;	if(Def_Auto_Repeat && !Auto_Repeat ) XAutoRepeatOff( Xdisplay );      }    if( event->type == LeaveNotify )      {	Mouse_Included = FALSE;	if(Def_Auto_Repeat && !Auto_Repeat ) XAutoRepeatOn( Xdisplay );      }  } /* end mouse_Xcrossed */E 2E 1