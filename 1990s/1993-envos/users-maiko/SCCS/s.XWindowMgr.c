h18413s 00012/00018/00215d D 1.4 90/09/18 23:29:15 sybalsky 4 3c Retrofit changes from AIX, DEC3100, PS/2es 00116/00053/00117d D 1.3 90/07/06 12:14:29 sybalsky 3 2c Bane change: Remove 1-event-per timer-int limit, speeding up keyboard in X version.es 00013/00002/00157d D 1.2 90/04/20 01:16:22 sybalsky 2 1c mes, bulk change.es 00159/00000/00000d D 1.1 90/04/19 23:18:50 sybalsky 1 0c date and time created 90/04/19 23:18:50 by sybalskyeuUf e 0tTI 1/* %Z% %M% Version %I% (%G%). copyright venue & Fuji Xerox  */static char *id = "%Z% %M%	%I% %G%	(venue & Fuji Xerox)";D 2/* %Z% %M% Version %I% (%G%). copyright venue & Fuji Xerox  */static char *id = "%Z% %M%	%I% %G%	(venue & Fuji Xerox)";E 2I 2/************************************************************************//*									*//*	Copyright 1989, 1990 Venue, Fuji Xerox Co., Ltd, Xerox Corp.	*//*									*//*	This file is work-product resulting from the Xerox/Venue	*//*	Agreement dated 18-August-1989 for support of Medley.		*//*									*//************************************************************************/E 2/**** Copyright (C) 1988 by Fuji Xerox co.,Ltd. All rights reserved.**		Author: Mitsunori Matsuda*		Date  : August 22, 1988*/#include <stdio.h>#include <X11/Xlib.h>#include <X11/Xutil.h>#include "XVersion.h"#include "MyWindow.h"I 3#include "dbprint.h"E 3#define FALSE 0#define TRUE  !FALSEextern Display *Xdisplay;extern XAnyEvent report;extern MyWindow *Head_of_Windows;D 3int Next_Event_req;E 3I 3/* int Next_Event_req;	removed JDS 7/6/90 keyboard speedup */E 3I 3/************************************************************************//*									*//*									*//*									*//*									*//*									*//************************************************************************/E 3Add_WindowList( window )MyWindow *window;{	MyWindow *temp;D 4#ifdef TRACE	printf( "TRACE: Add_Window()\" );#endifE 4I 4	TPRINT(( "TRACE: Add_Window()\n" ));E 4	if( !Head_of_Windows ) {		Head_of_Windows = window;	} else {		temp = Head_of_Windows;		while( temp->next ) {			temp = temp->next;		}		temp->next = window;	} /* end if */	window->next = NULL;} /* end Add_Window */I 3/************************************************************************//*									*//*									*//*									*//*									*//*									*//************************************************************************/E 3AddTop_WindowList( window )MyWindow *window;{D 4#ifdef TRACE	printf( "TRACE: AddTop_Window()\" );#endifE 4I 4	TPRINT(( "TRACE: AddTop_Window()\n" ));E 4	window->next = Head_of_Windows;	Head_of_Windows = window;} /* end AddTop_Window */I 3/************************************************************************//*									*//*									*//*									*//*									*//*									*//************************************************************************/E 3Remove_WindowList( window )MyWindow *window;{	MyWindow *temp1	       , *temp2;D 4#ifdef TRACE	printf( "TRACE: Remove_Window()\" );#endifE 4I 4	TPRINT(( "TRACE: Remove_Window()\n" ));E 4	if( Head_of_Windows ) {		if( Head_of_Windows == window ) {			Head_of_Windows = window->next;			window->next = NULL;		} else {			temp2 = Head_of_Windows;			temp1 = Head_of_Windows->next;			while( temp1 ) {				if( temp1 == window ) {					temp2->next = temp1->next;					window->next = NULL;					break;				}				temp2 = temp1;				temp1 = temp1->next;			} /* end while */		} /* end if */	} /* end if */} /* end Remove_Window */I 3/************************************************************************//*									*//*									*//*									*//*									*//*									*//************************************************************************/E 3getXsignaldata()D 3{	MyWindow *window;E 3I 3  {    MyWindow *window;E 3D 4#ifdef TRACED 3	printf( "TRACE: getXsignaldata()\n" );E 3I 3    printf( "TRACE: getXsignaldata()\n" );E 3#endifE 4I 4    TPRINT(( "TRACE: getXsignaldata()\n" ));E 4D 3	Next_Event_req = TRUE;	while( Next_Event_req && XPending( Xdisplay ) ) {		Next_Event_req = FALSE;		XNextEvent( Xdisplay, &report );		window = Head_of_Windows;		while( window ) {			if( report.window == window->win ) {				if( window->event_func ) {					(window->event_func)(&report,window);				}				break; /* exit while */			} /* end if */			window = window->next;		} /* end while */	} /* end if */E 3I 3    /* Next_Event_req = TRUE; removed JDS 7/6/90 keybaord speedup */    while(/* Next_Event_req &&*/ XPending( Xdisplay ) )      {	/* Next_Event_req = FALSE; removed JDS 7/6/90 keybaord speedup */	XNextEvent( Xdisplay, &report );	window = Head_of_Windows;	while( window )	  {	    if( report.window == window->win )	      {		if( window->event_func )		    (window->event_func)(&report,window);		break; /* exit while */	      } /* end if */	    window = window->next;	  } /* end while */      } /* end if */E 3D 3} /* end getXsignaldata() */E 3I 3  } /* end getXsignaldata() */E 3I 3/************************************************************************//*									*//*									*//*									*//*									*//*									*//************************************************************************/E 3DispatchXhandler( event, window ) /* General event handler */D 3XAnyEvent *event;MyWindow *window;{	MyEvent *temp;E 3I 3  XAnyEvent *event;  MyWindow *window;  {    MyEvent *temp;E 3D 4#ifdef TRACED 3	printf( "TRACE: DispatchXhandler()\" );E 3I 3    printf( "TRACE: DispatchXhandler()\" );E 3#endifE 4I 4    TPRINT(( "TRACE: DispatchXhandler()\n" ));E 4D 3	temp = window->event_head;E 3I 3    temp = window->event_head;E 3D 3	while( temp ) {		if( event->type == temp->type ) {			if( temp->func ) {				(temp->func)( event, window );			}			/*			break;			*/			return;		} /* end if */		temp = temp->next;	} /* end while *//*	printf( "DispatchXhandler(): Unexpected event type %d\n", event->type );*/} /* end DispatchXhandler */E 3I 3    while( temp )      {	if( event->type == temp->type )	  {	    if( temp->func )	      {		(temp->func)( event, window );	      }	    /* break; */	    return;	  } /* end if */	temp = temp->next;      } /* end while */E 3D 3BoolisXeventtype( display, event, type )Display *display;XEvent *event;{E 3I 3    DBPRINT(( "DispatchXhandler(): Unexpected event type %d\n",	      event->type ));  } /* end DispatchXhandler *//************************************************************************//*									*//*									*//*									*//*									*//*									*//************************************************************************/Bool isXeventtype( display, event, type )  Display *display;  XEvent *event;  {E 3D 4#ifdef TRACED 3        printf( "TRACE: isXeventtype()\n" );E 3I 3    printf( "TRACE: isXeventtype()\n" );E 3#endifE 4I 4    TPRINT(( "TRACE: isXeventtype()\n" ));E 4D 3        if( event->type == type )                return( True );        else                 return( False );E 3I 3    if( event->type == type ) return( True );    else return( False );E 3D 3} /* end isXeventtype */E 3I 3  } /* end isXeventtype */E 3E 1