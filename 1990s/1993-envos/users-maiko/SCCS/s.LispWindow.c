h45112s 00002/00001/00267d D 1.8 91/06/12 11:47:08 sybalsky 8 7c Set "input" flag in WMHints, so openlook window mgr and MacX will give us input focus.es 00048/00013/00220d D 1.7 91/01/25 17:52:24 sybalsky 7 6c Retrofit HP9000/RS6000 changeses 00000/00000/00233d D 1.6 90/09/21 18:09:39 sybalsky 6 5c Fix for color Xes 00013/00002/00220d D 1.5 90/09/18 23:26:56 sybalsky 5 4c Retrofit changes from AIX, DEC3100, PS/2es 00010/00009/00212d D 1.4 90/06/12 17:56:33 fuji 4 3c Matsuda: Bug fixes 00001/00001/00220d D 1.3 90/04/20 01:08:14 sybalsky 3 2c AIX:  shortening file names, bulk change.es 00002/00002/00219d D 1.2 90/04/19 22:46:19 sybalsky 2 1c AIX:  Shortened include file nameses 00221/00000/00000d D 1.1 90/03/01 15:30:29 osamu 1 0c date and time created 90/03/01 15:30:29 by osamueuUf e 0tTI 1/* %Z% %M% Version %I% (%G%). copyright venue & Fuji Xerox  */static char *id = "%Z% %M%	%I% %G%	(venue & Fuji Xerox)";/**** Copyright (C) 1988 by Fuji Xerox co.,Ltd. All rights reserved.**		Author: Mitsunori Matsuda*		Date  : June 5, 1988**/I 5/************************************************************************//*									*//*	Copyright 1989, 1990 Venue, Fuji Xerox Co., Ltd, Xerox Corp.	*//*									*//*	This file is work-product resulting from the Xerox/Venue	*//*	Agreement dated 18-August-1989 for support of Medley.		*//*									*//************************************************************************/E 5#include <stdio.h>#include <X11/Xlib.h>#include <X11/Xutil.h>#include "XVersion.h"#include "MyWindow.h"D 3#include "lispXdefaults.h"E 3I 3#include "Xdefaults.h"E 3D 2#include "LispCursorDef.h"#include "waitcursor.h"E 2I 2#include "XCursorDef.h"#include "XWaitCur.h"E 2I 7#include "dbprint.h"E 7#define FALSE 0#define TRUE  !FALSEextern char *Lisp_Window_Geom;extern int Lisp_Border         , LispDisplayWidth         , LispDisplayHeight         , Display_Width         , Display_Height	 , Lisp_icon_height	 , Lisp_icon_width;extern long Black_Pixel	  , White_Pixel;extern Display *Xdisplay;extern Bool isXeventtype();extern int DispatchXhandler()	 , Before_CreateLispWindow()	 , After_CreateLispWindow()	 , lisp_Xkeyboard()	 , lisp_Xconfigure();extern MyWindow  Root_Window;extern int Backing_Store;Pixmap      IconPixmap;GC          Copy_GC          , CopyInvert_GC;XGCValues   gcv;XSizeHints  szhint;XWMHints    Lisp_WMhints;XEvent      report;XSetWindowAttributes Lisp_SetWinAttributes;int         Video_Inverted = FALSE	  , DisplayRasterWidth	  , Scroll_Border	  , Scroll_Width = (SCROLL_WIDTH % 2) ? SCROLL_WIDTH+1 : SCROLL_WIDTH;Cursor WaitCursor;MyEvent Lisp_Event[] = {                  { KeyPress       , lisp_Xkeyboard , &Lisp_Event[1] }                , { KeyRelease     , lisp_Xkeyboard , &Lisp_Event[2] }                , { ConfigureNotify, lisp_Xconfigure, NULL           } };MyWindow *Head_of_Windows        , Lisp_Window = { WINDOW_NAME                        , NULL, NULL, NULL, NULL, NULL, NULL, NULL                        , KeyPressMask|KeyReleaseMask|StructureNotifyMask                        , NULL                        , Before_CreateLispWindow                        , After_CreateLispWindow                        , NULL                        , NULL                        , DispatchXhandler                              , &Lisp_Event[0]                        , NULL                        , NULL          };I 7/************************************************************************//*									*//*									*//*									*//*									*//*									*//************************************************************************/E 7Create_LispWindow()D 7{#ifdef TRACE	printf( "TRACE: Create_LispWindow()\n" );#endifE 7I 7  {    TPRINT(( "TRACE: Create_LispWindow()\n" ));E 7D 7	CreateWindow( &Root_Window, &Lisp_Window );E 7I 7    CreateWindow( &Root_Window, &Lisp_Window );E 7D 7} /* end Create_LispWindow */E 7I 7  } /* end Create_LispWindow */E 7I 7/************************************************************************//*									*//*									*//*									*//*									*//*									*//************************************************************************/E 7Before_CreateLispWindow( parent, child )MyWindow *parent       , *child;{	int bitmask;D 7#ifdef TRACE	printf( "TRACE: CreateLisp_Window()\n" );#endifE 7I 7	TPRINT(( "TRACE: CreateLisp_Window()\n" ));E 7	/* Get Geometry */	bitmask = XParseGeometry( Lisp_Window_Geom					, &(child->x)					, &(child->y)					, &(child->width)					, &(child->height) );	if( !(bitmask & WidthValue) ) {		child->width = DEF_WIN_WIDTH;	}	if( !(bitmask & HeightValue) ) {		child->height = DEF_WIN_HEIGHT;	}	if( !(bitmask & XValue) ) { 		child->x = DEF_WIN_X;	}	if ( Lisp_Window.x < 0 ) { 		child->x += Display_Width - (child->width - 1);	}D 4	if( bitmask & YValue ) {E 4I 4	if( !(bitmask & YValue) ) {E 4		child->y = DEF_WIN_Y;	}	if( child->y < 0 ) {		child->y += Display_Height - (child->height - 1); 	}	child->border = Scroll_Border = Lisp_Border;I 7    TPRINT(("Window geometry: x=%d, y=%d, width=%d, height=%d, border=%d.\n",	    child->x, child->y, child->width, child->height, child->border));E 7} /* end Before_CreateLispWindow */I 7/************************************************************************//*									*//*									*//*									*//*									*//*									*//************************************************************************/E 7int LispWindow_MaxWidth  , LispWindow_MaxHeight;After_CreateLispWindow( parent, child )MyWindow *parent       , *child;{	unsigned long event_mask;D 7#ifdef TRACE 	printf( "TRACE: After_CreateLispWindow()\n" );#endifE 7I 7	TPRINT(( "TRACE: After_CreateLispWindow()\n" ));E 7	XStoreName( Xdisplay, child->win, child->name );I 7	TPRINT(( "TRACE:      After XStoreName.\n" ));E 7	gcv.function   = GXcopy;	gcv.foreground = Black_Pixel;	gcv.background = White_Pixel;	Copy_GC = XCreateGC( Xdisplay, child->win				, GCForeground|GCBackground|GCFunction				, &gcv );	gcv.function   = GXcopyInverted;	CopyInvert_GC = XCreateGC( Xdisplay, child->win				, GCForeground|GCBackground|GCFunction				, &gcv );	Lisp_Window.gc = Video_Inverted ? &CopyInvert_GC					: &Copy_GC;	make_Xicon();        szhint.max_width  = LispWindow_MaxWidth = LispDisplayWidth 			+ ( (Scroll_Width > 0) ? Scroll_Width + 2*Scroll_Border					       : 0 );        szhint.max_height = LispWindow_MaxHeight = LispDisplayHeight 			+ ( (Scroll_Width > 0) ? Scroll_Width + 2*Scroll_Border					       : 0 );        szhint.flags = PMaxSize;	XSetStandardProperties( Xdisplay, child->win, child->name				,ICON_NAME , IconPixmap, NULL, NULL, &szhint );	Lisp_WMhints.icon_x = Display_Width - Lisp_icon_width ;				 	Lisp_WMhints.icon_y = 0;	Lisp_WMhints.icon_pixmap = IconPixmap;D 8	Lisp_WMhints.flags  = IconPositionHint | IconPixmapHint;E 8I 8	Lisp_WMhints.input = True;	Lisp_WMhints.flags  = IconPositionHint | IconPixmapHint | InputHint;E 8	XSetWMHints( Xdisplay, child->win, &Lisp_WMhints );D 4        event_mask =  StructureNotifyMask;E 4I 4        event_mask =  ExposureMask;E 4        XSelectInput( Xdisplay,  child->win, event_mask );	XMapWindow( Xdisplay, child->win );#ifdef TRACE 	printf( "XMap() finished.\n" );#endifD 4	/* waite for Map notify */	XIfEvent( Xdisplay, &report, isXeventtype, MapNotify );E 4I 4	/* waite for Expose  */	XIfEvent( Xdisplay, &report, isXeventtype, Expose );E 4D 4	XIfEvent( Xdisplay, &report, isXeventtype, ConfigureNotify );E 4I 4	child->x      = ((XExposeEvent*) &report)->x;	child->y      = ((XExposeEvent*) &report)->y;	child->width  = ((XExposeEvent*) &report)->width;	child->height = ((XExposeEvent*) &report)->height;E 4D 4	child->x      = ((XConfigureEvent*) &report)->x;	child->y      = ((XConfigureEvent*) &report)->y;	child->width  = ((XConfigureEvent*) &report)->width;	child->height = ((XConfigureEvent*) &report)->height;E 4I 4        event_mask =  StructureNotifyMask;        XSelectInput( Xdisplay,  child->win, event_mask );E 4	Lisp_SetWinAttributes.win_gravity = NorthWestGravity;I 7	Lisp_SetWinAttributes.override_redirect = TRUE;E 7	XChangeWindowAttributes( Xdisplay				, child->winD 7				, CWWinGravityE 7I 7				, CWWinGravity||CWOverrideRedirectE 7				, &Lisp_SetWinAttributes );	XFlush( Xdisplay );	Add_WindowList( child );	init_Xcursor();		Create_Subwindows( child );	set_Xcursor( (char*) wait_cursor.cuimage			, (int) wait_cursor.cuhotspotx			, (int) (15 - wait_cursor.cuhotspoty)D 5			, &WaitCursor );E 5I 5			, &WaitCursor, 0 );E 5	DefineCursor( child, &WaitCursor );D 5} /* end Afterk_CreateLispWindow */ E 5I 5} /* end After_CreateLispWindow */ E 5E 1