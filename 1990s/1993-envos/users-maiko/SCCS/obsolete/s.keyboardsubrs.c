h01663s 00017/00002/00113d D 2.5 90/03/01 13:57:23 osamu 7 6c Mitsunori Matsuda adds XWindow functionality.es 00004/00004/00111d D 2.4 89/01/09 17:18:55 shih 6 5c spellinges 00002/00000/00113d D 2.3 88/06/30 10:52:21 greep 5 4c put "#ifdef DEBUG" around printfes 00004/00002/00109d D 2.2 88/06/06 17:06:25 greep 4 3c added required second arg to open call on keyboardes 00000/00000/00111d D 2.1 88/05/17 09:25:30 hayata 3 2c Version up to 2.1es 00002/00002/00109d D 1.2 88/03/13 14:52:17 hayata 2 1c Add SCCS key id (%Z%)es 00111/00000/00000d D 1.1 88/02/24 16:57:43 hayata 1 0c date and time created 88/02/24 16:57:43 by hayataeuUtTI 1D 2/* This is G-file %M% Version %I% (%G%). copyright Xerox & Fuji Xerox  */static char *id = "%M%	%I% %G%";E 2I 2D 6/* This is G-file %Z% %M% Version %I% (%G%). copyright Xerox & Fuji Xerox  */E 6I 6/* %Z% %M% Version %I% (%G%). copyright envos & Fuji Xerox  */E 6static char *id = "%Z% %M%	%I% %G%";E 2/*** ADOPTED NEW VERSION ***/D 7E 7/* *	Copyright (C) 1987 by Fuji Xerox Co., Ltd. All rights reserved. *D 6 *	Auther	:	Osamu Nakamura	E 6I 6 *	Author	:	Osamu NakamuraE 6 */#include <stdio.h>#include <sys/time.h>#include <sys/types.h>I 4#include <sys/file.h>E 4#include <sundev/kbd.h>#include <sundev/kbio.h>#include <sunwindow/window_hs.h>#include "lispemul.h"/**************************************************** * *	KB_enable() entry of SUBRCALL 82 1 *			called from (\KB_enable X) * ****************************************************/extern struct screen LispScreen;extern int LispWindowFd,	   LispReadFds;extern int errno;KB_enable( args )LispPTR	*args;		/* args[0] :	ON/OFF flag			 *		T -- ON			 *		NIL -- OFF			 */{D 7E 7	if( args[0] == ATOM_T )I 7#ifdef SUNDISPLAYE 7		LispReadFds |= 1<< LispWindowFd;I 7#endif SUNDISPLAY#ifdef XWINDOW		enable_Xkeyboard();#endif XWINDOWE 7	else if( args[0] == NIL )I 7#ifdef SUNDISPLAYE 7		LispReadFds &= ~(1 << LispWindowFd);I 7#endif SUNDISPLAY#ifdef XWINDOW		disable_Xkeyboard();#endif XWINDOWE 7	else{		error("KB_enable: illegal arg \n");		printf("KB_enable: arg = %d\n", args[0] );	}}/**************************************************** * *	KB_beep() entry of SUBRCALL 80 2 *			called from (\KB_beep SW FREQ) * ****************************************************//*struct timeval belltime ={	0,100};*/extern int LispKbdFd;KB_beep( args )LispPTR	*args;		/* args[0] :	ON/OFF flag			 *		T -- ON			 *		NIL -- OFF			 * args[1] :	frequency			 */{	int keycommand;D 6	E 6I 6I 7#ifdef SUNDISPLAYE 7E 6/*	belltime.tv_usec = args[1] & 0xffff;	win_bell(LispWindowFd, belltime, 0);*/D 4	if( (LispKbdFd = open( LispScreen.scr_kbdname )) == -1)		fprintf( stderr, "can't open %s\n", LispScreen.scr_kbdname);E 4I 4	if( (LispKbdFd = open( LispScreen.scr_kbdname, O_RDWR)) == -1)		fprintf( stderr, "can't open %s, errno=%d\n",			LispScreen.scr_kbdname, errno);E 4	if( args[0] == ATOM_T ){		keycommand = KBD_CMD_BELL;	/* Turn on the bell */		if(ioctl( LispKbdFd, KIOCCMD, &keycommand)== -1)			fprintf( stderr, "Error at ioctl errno =%d\n", errno);	}	else{		keycommand = KBD_CMD_NOBELL;	/* Turn off the bell */		if(ioctl( LispKbdFd, KIOCCMD, &keycommand)== -1)			fprintf( stderr, "Error at ioctl errno =%d\n", errno);	}D 6	E 6I 6E 6	close( LispKbdFd );I 7#endif SUNDISPLAY#ifdef XWINDOW	if( args[0] == ATOM_T ) 		beep_Xkeyboard();#endif XWINDOWE 7}/**************************************************** * *	KB_setmp() entry of SUBRCALL 81 1 *			called from (\KB_setMP MPCODE) * ****************************************************/KB_setmp( args )LispPTR	*args;		/* args[0] :	MPCODE	*/{I 5#ifdef  DEBUGE 5	printf("MP: %d\n", args[0] & 0xffff );I 5#endifE 5}E 1