h04938s 00006/00003/00108d D 1.8 92/11/25 21:09:13 sybalsky 8 7c Fixing endif's with extra text => comment. \nes 00004/00004/00107d D 1.7 92/04/21 17:20:25 sybalsky 7 6c shortening file names for DOS \nes 00000/00000/00111d D 1.6 90/04/20 01:50:23 sybalsky 6 5c AIX:  shortening file names, bulk change.es 00013/00000/00098d D 1.5 90/03/01 12:58:25 osamu 5 4c Mitsunori Matsuda adds XWindow functionality.es 00002/00002/00096d D 1.4 90/02/09 10:46:20 mitani 4 3c each case clause was closed with breakes 00005/00000/00093d D 1.3 90/02/08 16:13:35 osamu 3 2c add include file "display.h". c 	Because in_display_segment is defined there.es 00002/00018/00091d D 1.2 89/12/28 15:27:01 sybalsky 2 1c es 00109/00000/00000d D 1.1 89/10/19 16:33:26 sybalsky 1 0c date and time created 89/10/19 16:33:26 by sybalskyeuUtTI 5/* %Z% %M% Version %I% (%G%). copyright envos & Fuji Xerox  */static char *id = "%Z% %M%	%I% %G%		(envos & Fuji Xerox)";E 5I 1D 2/* %Z% %M% Version %I% (%G%). copyright envos & Fuji Xerox  */static char *id = "%Z% %M%	%I% %G%	(envos & Fuji Xerox)";/************************************************************************//*									*//*				MISC7.C					*//*									*//*	Miscellaneous, uncommon 7-argument opcodes, dispatched		*//*	by the alpha byte in the opcode stream.				*//*									*//*	Alpha byte 	Operation/Description				*//*	0		PSEUDOCOLOR, unimplemented, I don't know	*//*			what it's supposed to do (JDS 10/19/89)		*//*	1		FBITMAPBIT, the fast bitmap-bit read/write	*//*			function.					*//*									*//*									*//*									*//************************************************************************/E 2I 2/*	misc7.c */E 2#include <stdio.h>#include <sys/ioctl.h>#include "lispemul.h"D 7#include "lispglobal.h"#include "address68k.h"E 7I 7#include "lspglob.h"#include "adr68k.h"E 7#include "lispmap.h"D 7#include "lisptypes.h"#include "emulglobal.h"E 7I 7#include "lsptypes.h"#include "emlglob.h"E 7#include "gc.h"#include "arith.h"#include "my.h"#include "bitblt.h"#include "dbprint.h"I 3/* osamu '90/02/08 * add display.h, because in_display_secment() is changed as * macro. difinition is in display.h  */#include "display.h"E 3#ifndef NOPIXRECT#include <sunwindow/window_hs.h>#include <sunwindow/win_ioctl.h>#include <suntool/sunview.h>#include <signal.h>#include <sunwindow/cms_mono.h>#include <suntool/canvas.h>#endif	/*************************************************/	/*  Possible operation fields for FBITMAPBIT     */	/*************************************************/#define OP_INVERT   0		/* Invert the bit at the given location */#define OP_ERASE    1		/* Turn the given bit off. */#define OP_READ     2		/* Just read the bit that's there. */#define OP_PAINT    3		/* Turn the bit on. */extern int LispWindowFd;extern int ScreenLocked;/***	N_OP_misc7  -- pseudocolor or fbitmapbit   ***/N_OP_misc7(arg1, arg2, arg3, arg4, arg5, arg6, arg7, alpha)  int alpha;  register LispPTR arg1, arg2, arg3, arg4, arg5, arg6, arg7;  {    DLword *base;    int x, y, operation, heightminus1, rasterwidth, oldbit;    int displayflg;    DBPRINT(("MISC7 op with alpha byte %d.\n", alpha));    if (alpha != 1) ERROR_EXIT(arg7);    base = Addr68k_from_LADDR(arg1);    N_GETNUMBER(arg2, x, doufn);    N_GETNUMBER(arg3, y, doufn);    N_GETNUMBER(arg4, operation, doufn);    N_GETNUMBER(arg5, heightminus1, doufn);    N_GETNUMBER(arg6, rasterwidth, doufn);    DBPRINT(("MISC7 args OK.\n"));    displayflg = n_new_cursorin(base, x, (heightminus1 - y), 1, 1);    base = base + (rasterwidth * (heightminus1 - y)) + (0xFFFF & (x>>4));    x = 32768 >> (x & 0xF);    oldbit = x & *base;    ScreenLocked = T;I 5#ifdef SUNDISPLAYE 5    if (displayflg) HideCursor;I 5D 8#endif SUNDISPLAYE 8I 8#endif /* SUNDISPLAY */E 8I 8E 8E 5    switch (operation)      {D 4	case OP_INVERT:  *base ^= x;	case OP_ERASE:   *base &= ~x;E 4I 4	case OP_INVERT:  *base ^= x;	break;	case OP_ERASE:   *base &= ~x;	break;E 4	case OP_READ:  break;	default:  *base |= x;      };I 5#ifdef SUNDISPLAYE 5#ifdef DISPLAYBUFFER    if (in_display_segment(base)) flush_display_ptrregion(base, 0, 16, 1);#endif    if (displayflg) ShowCursor;I 5D 8#endif SUNDISPLAYE 8I 8#endif /* SUNDISPLAY */E 8I 8E 8#ifdef XWINDOW    if (in_display_segment(base)) flush_display_ptrregion(base, 0, 16, 1);D 8#endif XWINDOWE 8I 8#endif /* XWINDOW */E 8E 5    ScreenLocked = NIL;    DBPRINT(("FBITMAPBIT old bit = 0x%x.\n", oldbit));    return(S_POSITIVE | (oldbit ? 1 : 0));doufn:		ERROR_EXIT(arg7);} /*  end N_OP_misc7()  */E 1