h02343s 00004/00004/00065d D 2.8 92/04/21 17:05:50 sybalsky 12 11c shortening file names for DOS \nes 00000/00000/00069d D 2.7 90/04/20 01:23:06 sybalsky 11 10c AIX:  shortening file names, bulk change.es 00027/00015/00042d D 2.6 90/03/15 22:02:14 sybalsky 10 9c comments added, code reformattedes 00001/00001/00056d D 2.5 89/03/23 12:54:21 sybalsky 9 8c Byte-order fixes to word pointer codees 00008/00010/00049d D 2.4 89/01/09 17:18:39 shih 8 7c spellinges 00002/00052/00057d D 2.3 88/10/12 14:41:08 krivacic 7 6c new out-of-line interfacees 00006/00000/00103d D 2.2 88/05/27 14:50:01 krivacic 6 5c C_ONLY ifdefes 00000/00000/00103d D 2.1 88/05/17 09:22:38 hayata 5 4c Version up to 2.1es 00004/00023/00099d D 1.4 88/04/14 14:42:24 krivacic 4 3c removed the 32 bit versiones 00052/00000/00070d D 1.3 88/04/13 17:51:06 krivacic 3 2c added N_OP_bltes 00002/00002/00068d D 1.2 88/03/13 14:33:53 hayata 2 1c Add SCCS key id (%Z%)es 00070/00000/00000d D 1.1 88/02/24 16:55:57 hayata 1 0c date and time created 88/02/24 16:55:57 by hayataeuUtTI 1D 2/* This is G-file %M% Version %I% (%G%). copyright Xerox & Fuji Xerox  */static char *id = "%M%	%I% %G%";E 2I 2D 8/* This is G-file %Z% %M% Version %I% (%G%). copyright Xerox & Fuji Xerox  */E 8I 8D 10/* %Z% %M% Version %I% (%G%). copyright envos & Fuji Xerox  */E 10I 10/* %Z% %M% Version %I% (%G%). copyright Venue & Fuji Xerox  */E 10E 8static char *id = "%Z% %M%	%I% %G%";E 2I 10/************************************************************************//*									*//*	Copyright 1989, 1990 Venue, Fuji Xerox Co., Ltd, Xerox Corp.	*//*									*//*	This file is work-product resulting from the Xerox/Venue	*//*	Agreement dated 18-August-1989 for support of Medley.		*//*									*//************************************************************************/E 10/*D 10 *	Copyright (C) 1987 by Fuji Xerox Co., Ltd. All rights reserved.E 10 *D 8 *	Auther :  Takeshi ShimizuE 8I 8 *	Author :  Takeshi ShimizuE 8 * *//******************************************************************//*D 8E 8		File Name  :	blt.c		Including  :	OP_bltD 8				E 8		Created    :	jul 9, 1987 by T.ShimizuD 8E 8*//******************************************************************/#include "lispemul.h"#include "address.h"D 12#include "address68k.h"#include "lisptypes.h"E 12I 12#include "adr68k.h"#include "lsptypes.h"E 12#include "lispmap.h"#include "stack.h"D 12#include "emulglobal.h"#include "lispglobal.h"E 12I 12#include "emlglob.h"#include "lspglob.h"E 12#include "cell.h"I 6D 7#ifdef C_ONLYE 7E 6D 8/* D 7  OP_blt takes 3 arguments . STK-1 has destination's pointer. STK has source's pointer. TOS has number of words to be translated.*/OP_blt(){ register  DLword *source68k; register  DLword *dest68k ; register int nw;#ifdef TRACE	printPC();	printf("TRACE : OP_blt \n");#endif if((TopOfStack & 0xff0000) != S_POSITIVE)   error("OP_blt : Invlid arg . nwords"); nw = TopOfStack & 0xffff ; source68k =Addr68k_from_LADDR((*((LispPTR *)(CurrentStackPTR))) ); source68k += nw ; CurrentStackPTR -= 2 ; dest68k = Addr68k_from_LADDR((*((LispPTR *)(CurrentStackPTR))) ); CurrentStackPTR -= 2 ; dest68k += nw ; while(nw) {    *(--dest68k)= *(--source68k) ;   nw--;  }   PC++;} /* end OP_blt */I 3I 6#elseE 6/* E 7  N_OP_blt takes 3 arguments . STK-1 has destination's pointer. STK has source's pointer. TOS has number of words to be translated.E 8I 8/*  N_OP_blt takes 3 arguments.	STK-1 has destination's pointer.	STK has source's pointer.	TOS has number of words to be translated.E 8*/I 10E 10D 7LispPTR N_OP_blt(destptr, sourceptr, wordcount, error_addr)E 7I 7LispPTR N_OP_blt(destptr, sourceptr, wordcount)E 7D 10	LispPTR destptr, sourceptr;	register LispPTR wordcount;E 10I 10  LispPTR destptr, sourceptr;  register LispPTR wordcount;E 10D 7	int *error_addr;E 7D 10{ register  DLword *source68k; register  DLword *dest68k ; register int nw;E 10I 10  {    register  DLword *source68k;    register  DLword *dest68k ;    register int nw;E 10D 7#ifdef TRACE	printPC();	printf("TRACE : N_OP_blt \n");#endif if((wordcount & 0xff0000) != S_POSITIVE) ERROR_EXIT(error_addr);E 7I 7D 10 if((wordcount & 0xff0000) != S_POSITIVE) ERROR_EXIT(wordcount);E 7 nw = wordcount & 0xffff ;E 10I 10    if((wordcount & 0xff0000) != S_POSITIVE) ERROR_EXIT(wordcount);    nw = wordcount & 0xffff ;E 10D 4 if (nw & 1) {					/* odd case, move words */E 4I 4D 10 source68k = Addr68k_from_LADDR(sourceptr) + nw; dest68k = Addr68k_from_LADDR(destptr) + nw;E 10I 10    source68k = Addr68k_from_LADDR(sourceptr) + nw;    dest68k = Addr68k_from_LADDR(destptr) + nw;E 10E 4D 4 	source68k = Addr68k_from_LADDR(sourceptr) + nw; 	dest68k = Addr68k_from_LADDR(destptr) + nw;E 4I 4D 9 while(nw)	{  *(--dest68k)= *(--source68k) ; nw--; }E 9I 9D 10 while(nw)	{  (GETWORD(--dest68k))= GETWORD(--source68k) ; nw--; }E 10I 10    while(nw)	{  (GETWORD(--dest68k))= GETWORD(--source68k) ; nw--; }E 10E 9E 4D 4 	while(nw) 	{   	 *(--dest68k)= *(--source68k) ;  	 nw--;  	} } else { 					/* even case, move 32 bit words */ 	source68k = Addr68k_from_LADDR(sourceptr) + nw; 	dest68k = Addr68k_from_LADDR(destptr) + nw; 	nw = nw >> 1;	while(nw) 	{   	 *(--(LispPTR *)dest68k)= *(--(LispPTR *)source68k) ;  	 nw--;  	}} return(NIL_PTR);E 4I 4D 10 return(wordcount);E 4} /* end N_OP_blt */E 10I 10    return(wordcount);  } /* end N_OP_blt */E 10D 8  E 8I 8E 8I 6D 7#endifE 7E 6E 3E 1