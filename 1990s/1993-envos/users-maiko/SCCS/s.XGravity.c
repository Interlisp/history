h47259s 00002/00001/00234d D 1.6 93/02/08 14:42:28 sybalsky 6 5c Big VM (and new CDR coding) changes for 3.0 \nes 00003/00002/00232d D 1.5 92/04/27 18:41:23 nilsson 5 4c Fix of Xdisplay deps.es 00001/00001/00233d D 1.4 92/04/21 16:58:38 sybalsky 4 3c shortening file names for DOS \nes 00123/00091/00111d D 1.3 90/09/18 23:28:19 sybalsky 3 2c Retrofit changes from AIX, DEC3100, PS/2es 00065/00026/00137d D 1.2 90/08/21 17:13:55 sybalsky 2 1c Retrofit AIX changes from IBMes 00163/00000/00000d D 1.1 90/05/07 20:34:50 osamu 1 0c date and time created 90/05/07 20:34:50 by osamueuUf e 0tTI 1/* @(#) GravityWindow.c Version 1.2 (4/19/90). copyright venue & Fuji Xerox  */static char *id = "@(#) GravityWindow.c	1.2 4/19/90	(venue & Fuji Xerox)";/**** Copyright (C) 1988 by Fuji Xerox co.,Ltd. All rights reserved.**		Author: Mitsunori Matsuda*		Date  : September 5, 1988*/I 2/************************************************************************//*									*//*	Copyright 1989, 1990 Venue, Fuji Xerox Co., Ltd, Xerox Corp.	*//*									*//*	This file is work-product resulting from the Xerox/Venue	*//*	Agreement dated 18-August-1989 for support of Medley.		*//*									*//************************************************************************/E 2#include <stdio.h>#include <X11/Xlib.h>#include <X11/Xutil.h>I 3#include "dbprint.h"E 3#include "XVersion.h"#include "MyWindow.h"D 4#include "XCursorDef.h"E 4I 4#include "Xcursdef.h"E 4#include "Xdefcur.h"extern Display *Xdisplay;extern MyWindow Lisp_Window	      , Grav_Window[];extern int Bit_Gravity	 , Scroll_WidthI 3	 , Default_DepthE 3	 , Scroll_Border;Cursor DefaultCursor = NULL;Pixmap GravityOn_Pixmap     , GravityOff_Pixmap;I 2/************************************************************************//*									*//*		     B e f o r e _ C r e a t e G r a v			*//*									*//*									*//*									*//************************************************************************/E 2Before_CreateGrav( parent, child )MyWindow *parent       , *child;D 2{E 2I 2  {E 2D 3#ifdef TRACED 2	printf( "TRACE: Before_CreateGrav()\n" );E 2I 2    printf( "TRACE: Before_CreateGrav()\n" );E 2#endifE 3I 3    TPRINT(( "TRACE: Before_CreateGrav()\n" ));E 3D 2	{ int i;	  for( i=0; i<2; i++)	    { int j;	      for( j=0; j<2; j++ ) {		if( child == &Grav_Window[i*2+j] ) {			Grav_Window[i*2+j].border = parent->border;			Grav_Window[i*2+j].width  = Grav_Window[i*2+j].height 				= Scroll_Width / 2 - Grav_Window[i*2+j].border;			Grav_Window[i*2+j].x = (parent->width - 1)						- (Scroll_Width + Scroll_Border)					+ ( j ? ( Grav_Window[i*2+(j-1)].width						 +Grav_Window[i*2+(j-1)].border						 +Grav_Window[i*2+j].border)					      : 0 );			Grav_Window[i*2+j].y = (parent->height - 1)						- (Scroll_Width + Scroll_Border)					+ ( i ? ( Grav_Window[(i-1)*2+j].height						 +Grav_Window[(i-1)*2+j].border						 +Grav_Window[i*2+j].border)					      : 0 );E 2I 2    { int i;      for( i=0; i<2; i++)	{ int j;	  for( j=0; j<2; j++ )	    {	      if( child == &Grav_Window[i*2+j] )		{		  Grav_Window[i*2+j].border = parent->border;		  Grav_Window[i*2+j].width  = Grav_Window[i*2+j].height 			= Scroll_Width / 2 - Grav_Window[i*2+j].border;		  Grav_Window[i*2+j].x = (parent->width - 1)					- (Scroll_Width + Scroll_Border)				+ ( j ? ( Grav_Window[i*2+(j-1)].width					 +Grav_Window[i*2+(j-1)].border					 +Grav_Window[i*2+j].border)				      : 0 );		  Grav_Window[i*2+j].y = (parent->height - 1)					- (Scroll_Width + Scroll_Border)				+ ( i ? ( Grav_Window[(i-1)*2+j].height					 +Grav_Window[(i-1)*2+j].border					 +Grav_Window[i*2+j].border)				      : 0 );E 2		} /* end if */D 2	      } /* end for(j) */	    } /* end for(i) */	}E 2I 2	    } /* end for(j) */	  } /* end for(i) */      }E 2D 2} /* end Before_CreateScrollbar */E 2I 2  } /* end Before_CreateScrollbar */E 2I 2I 3/************************************************************************//*									*//*			A f t e r _ C r e a t e G r a v			*//*									*//*									*//*									*//************************************************************************/E 3E 2#include "Check.h"#define North_West 0#define North_East 1#define South_West 2#define South_East 3After_CreateGrav( parent, child )D 3MyWindow *parent       , *child;{	int win;#ifdef TRACE	printf( "TRACE: After_CreateGrav()\n" );#endifE 3I 3  MyWindow *parent         , *child;  {    int win;    TPRINT(( "TRACE: After_CreateGrav()\n" ));E 3	D 3	if( !DefaultCursor ) {		set_Xcursor( (char*)default_cursor.cuimage				, (int)default_cursor.cuhotspotx				, (int)(15 - default_cursor.cuhotspoty)				, &DefaultCursor );	} /* end if */E 3I 3    if( !DefaultCursor )      {D 5	set_Xcursor( (char*)default_cursor.cuimageE 5I 5	set_Xcursor( Xdisplay,		    (char*)default_cursor.cuimageE 5			, (int)default_cursor.cuhotspotx			, (int)(15 - default_cursor.cuhotspoty)			, &DefaultCursor );      } /* end if */E 3I 2D 3#ifndef AIXE 2	if( !GravityOn_Pixmap )		GravityOn_Pixmap = XCreateBitmapFromData( Xdisplay							, Lisp_Window.win							, check_bits							, check_width							, check_height );	if( !GravityOff_Pixmap )		GravityOff_Pixmap = XCreateBitmapFromData( Xdisplay							, Lisp_Window.win							, plain_bits							, check_width							, check_height );E 3I 3#ifdef NEVER    if( !GravityOn_Pixmap )      GravityOn_Pixmap = XCreateBitmapFromData( Xdisplay						, Lisp_Window.win						, check_bits						, check_width						, check_height );    if( !GravityOff_Pixmap )      GravityOff_Pixmap = XCreateBitmapFromData( Xdisplay						, Lisp_Window.win						, plain_bits						, check_width						, check_height );E 3I 2#elseD 3	if (!GravityOn_Pixmap)	  GravityOn_Pixmap = XCreatePixmapFromBitmapData(Xdisplay,							 Lisp_Window.win,							 check_bits,							 16, 16, 0, 1, 8);E 3I 3    if (!GravityOn_Pixmap)      GravityOn_Pixmap = XCreatePixmapFromBitmapData(Xdisplay,						 Lisp_Window.win,						 check_bits,						 16, 16, 1, 0,						 Default_Depth);E 3D 3	if (!GravityOff_Pixmap)	  GravityOff_Pixmap = XCreatePixmapFromBitmapData(Xdisplay,							  Lisp_Window.win,							  plain_bits,							  16, 16, 0, 1, 8);#endif AIXE 3I 3    if (!GravityOff_Pixmap)      GravityOff_Pixmap = XCreatePixmapFromBitmapData(Xdisplay,						  Lisp_Window.win,						  plain_bits,						  16, 16, 1, 0, 						  Default_Depth);D 6#endif NEVERE 6I 6#endif /* NEVER */E 6E 3E 2D 3	if( Bit_Gravity == NorthWestGravity ) win = North_West;	if( Bit_Gravity == NorthEastGravity ) win = North_East;	if( Bit_Gravity == SouthWestGravity ) win = South_West;	if( Bit_Gravity == SouthEastGravity ) win = South_East;E 3I 3    if( Bit_Gravity == NorthWestGravity ) win = North_West;    if( Bit_Gravity == NorthEastGravity ) win = North_East;    if( Bit_Gravity == SouthWestGravity ) win = South_West;    if( Bit_Gravity == SouthEastGravity ) win = South_East;E 3D 3	if( child == &Grav_Window[win] ) {		XSetWindowBackgroundPixmap( Xdisplay						, child->win						, GravityOn_Pixmap );	} else {		XSetWindowBackgroundPixmap( Xdisplay						, child->win						, GravityOff_Pixmap );	} /* end if */E 3I 3    if( child == &Grav_Window[win] )      {	XSetWindowBackgroundPixmap( Xdisplay				, child->win				, GravityOn_Pixmap );      }    else      {	XSetWindowBackgroundPixmap( Xdisplay					, child->win					, GravityOff_Pixmap );      } /* end if */E 3D 3	XMapWindow( Xdisplay, child->win );	Add_WindowList( child );E 3I 3    XMapWindow( Xdisplay, child->win );    Add_WindowList( child );E 3D 3	DefineCursor( child, &DefaultCursor );	E 3I 3D 5    DefineCursor( child, &DefaultCursor );	E 5I 5    DefineCursor( Xdisplay, child, &DefaultCursor );	E 5E 3D 3} /* end After_CreatGrav */E 3I 3  } /* end After_CreatGrav */E 3I 3/************************************************************************//*									*//*									*//*									*//*									*//*									*//************************************************************************/E 3Before_ResizeGrav( window )D 3MyWindow *window;{#ifdef TRACE	printf( "TRACE: Before_ResizeGrav()\n" );#endif	{ int i;	  for( i=0; i<2; i++ )	    { int j;	      for( j=0; j<2; j++ ) {		if( window == &Grav_Window[i*2+j] ) {			Grav_Window[i*2+j].x = (window->parent->width - 1)						- (Scroll_Width + Scroll_Border)					+ ( j ? ( Grav_Window[i*2+(j-1)].width						 +Grav_Window[i*2+(j-1)].border						 +Grav_Window[i*2+j].border)					      : 0 );			Grav_Window[i*2+j].y = (window->parent->height - 1)						- (Scroll_Width + Scroll_Border)					+ ( i ? ( Grav_Window[(i-1)*2+j].height						 +Grav_Window[(i-1)*2+j].border						 +Grav_Window[i*2+j].border)					      : 0 );		} /* end if */	      } /* end for(j) */	    } /* end for(i) */	}	E 3I 3  MyWindow *window;  {    int i;E 3I 3    TPRINT(( "TRACE: Before_ResizeGrav()\n" ));    for( i=0; i<2; i++ )      { int j;	for( j=0; j<2; j++ )	  {	    if( window == &Grav_Window[i*2+j] )	      {		Grav_Window[i*2+j].x = (window->parent->width - 1)					- (Scroll_Width + Scroll_Border)				+ ( j ? ( Grav_Window[i*2+(j-1)].width					 +Grav_Window[i*2+(j-1)].border					 +Grav_Window[i*2+j].border)				      : 0 );		Grav_Window[i*2+j].y = (window->parent->height - 1)					- (Scroll_Width + Scroll_Border)				+ ( i ? ( Grav_Window[(i-1)*2+j].height					 +Grav_Window[(i-1)*2+j].border					 +Grav_Window[i*2+j].border)				      : 0 );	      } /* end if */	  } /* end for(j) */      } /* end for(i) */E 3} /* Before_ResizeGrav */D 3After_ResizeGrav( window )MyWindow *window;{#ifdef TRACE	printf( "TRACE: After_ResizeGrav()\n" );#endifE 3D 3} /* After_ResizeGrav */E 3I 3/************************************************************************//*									*//*									*//*									*//*									*//*									*//************************************************************************/After_ResizeGrav( window )  MyWindow *window;  {    TPRINT(( "TRACE: After_ResizeGrav()\n" ));  } /* After_ResizeGrav */E 3E 1