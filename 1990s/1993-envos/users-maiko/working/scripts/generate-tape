#! /bin/csh -f# First line invokes CSH shell# ============================================================================# Changes:#	09-17-90 Carl Gadener : Added bundled sun3 & sun4 for release and Beta#	08-23-90 Carl Gadener : Added Beta options as well as made the script#				easier to upgrade#	12-28-89 Carl Gadener : Added Escaped command facilities#	06-30-89 Carl Gadener : Creation of script# ============================================================================# SYNOPSYS:#		generate-tape [-t <tapetype>]##	Script for generating "tar" tapes of different Medley releases and/or#	related products like NoteCards, Rooms and PCL. The script will prompt#	for a choice of "fixed" options related to "known" release directories.#	If user doesn't want any of the provided options, he/she may instead#	choose to specify a direct path to a directory to create a "tar" tape#	from. The different menu options and currently "known" directories are:##	Menu:##	[1]  Medley $RELEASE for Sun3#	[2]  Medley $RELEASE for Sun4#	[3]  Medley $RELEASE for IBM RS/6000#	[4]  Medley $BETA (Beta) for Sun3#	[5]  Medley $BETA (Beta) for Sun4#	[6]  Medley $BETA (Beta) for Sun3 & Sun4#	[7]  Medley $RELEASE bundled for Sun3 (Rooms, LOOPS, LispUsers)#	[8]  Medley $RELEASE bundled for Sun4 (Rooms, LOOPS, LispUsers)#	[9]  Medley $RELEASE bundled for Sun3/4 (Rooms, LOOPS, LispUsers) \#	[10] Medley 1.1 demo for Sun3/4 \#	[11] NoteCards runtime for Sun3/4 \#	[12] NoteCards development (includes Medley $RELEASE for Sun3/4) \#	[13] NoteCards demo for Sun3/4 \#	[14] Rooms for Medley $RELEASE \#	[15] LOOPS for Medley $RELEASE \#	[16] LispUsers for Medley $RELEASE \#	[17] PCL <`cat $PCL/pcldate`> (including compiled Medley-files) \#	[18] NoteCards demo for RS6000##	<pathname of directory to "tar">#	!<Unix command>		##	[t]ape-type :1/4-inch (/dev/rst0) or reel (/dev/rmt0) \#	[s]ame as specified earlier#	[h]elp (bring up this menu)#	[q]uit## ============================================================================## NOTE:#	The <pathname> entry on the menu allows user to specify any pathname.##	!<Unix command> will issue a command in the current shell, ei. you#	can for example do a "!cd /foo" and the working directory will change#	to /foo. Pretty neat, Huh!# ============================================================================# Setting the version numbers for the RELEASE and for the BETA versionsset RELEASE=2.0set BETA="2.0"# All the directoriesset LDEDIR="/usr/local/lde"set OTHERDIR="$LDEDIR/OTHER"set TAPEDIR="$LDEDIR/RELEASE/tape"set MEDLEYSUN3="$TAPEDIR/medley-sun3"set MEDLEYSUN4="$TAPEDIR/medley-sun4"set MEDLEYRS6000="$TAPEDIR/medley-rs6000"set MEDLEYSUNALL="$TAPEDIR/medley-allprod-sun4"set MEDLEYSUN3BETA="$TAPEDIR/medley-sun3-beta"set MEDLEYSUN4BETA="$TAPEDIR/medley-sun4-beta"set MEDLEYSUNALLBETA="$TAPEDIR/medley-sunall-beta"set MEDLEYSUN3BUNDLED="$TAPEDIR/medley-bundled-sun3"set MEDLEYSUN4BUNDLED="$TAPEDIR/medley-bundled-sun4"set MEDLEYSUNALLBNDLD="$TAPEDIR/medley-bundled-sunall"set MEDLEYDEMO="$TAPEDIR/medley-demo"set NOTECARDSRUNTIME="$TAPEDIR/NC-runtime"set NOTECARDSDEV="$TAPEDIR/NC-dev"set NOTECARDSDEMO="$TAPEDIR/NC-demo"set ROOMS="$TAPEDIR/rooms"set LOOPS="$TAPEDIR/loops"set LISPUSERS="$TAPEDIR/lispusers"set PCL="$OTHERDIR/pcl/release"set NOTECARDS6000DEMO="$TAPEDIR/NC6000-demo"# 1/4-inch cartridge is default set Device="/dev/rst0"set DeviceType = "1/4-inch cartridge"if ($#argv > 0) then		# parse command	switch ($argv[1])	case -t:	# tape type is specified		shift argv		if ($#argv == 0) then			echo "Error  	: Expected argument missing after -t"			echo "        Valid tape types are: 1/4-inch, reel or floppy"			exit		endif		set tapetype=$argv[1]		switch ("$tapetype")		case '1/4-inch':			set Device = "/dev/rst0"	# 1/4-inch cartridge 			set DeviceType = "1/4-inch cartridge"			breaksw		case '8mm':			set Device = "/dev/rxb0"	# 8mm tape			set DeviceType = "8mm tape"			breaksw		case 'reel': 			set Device = "/dev/rmt0"	# 1600BPI tapereel 			set DeviceType = "1600 BPI reeltape"			breaksw		case 'floppy':			set Device = "/dev/rfd0"	# 3.5" floppy			set DeviceType = "3.5-inch floppy"			breaksw		default:			echo "Error  : $tapetype not a valid type."			echo "        Valid tape types are: 1/4-inch, reel or floppy"			exit			breaksw		endsw		breaksw	default:		echo "Usage: generate-tape [-t tapetype]"		exit		breaksw	endswendifmenuloop:	# What a way to create a loopecho "\Medley general tar tape creator \=================================\ [1]  Medley $RELEASE for Sun3 \ [2]  Medley $RELEASE for Sun4 \ [3]  Medley $RELEASE for IBM RS/6000 \ [4]  Medley $BETA (Beta) for Sun3 \ [5]  Medley $BETA (Beta) for Sun4 \ [6]  Medley $BETA (Beta) for Sun3/4 \ [7]  Medley $RELEASE bundled for Sun3 (Rooms, LOOPS, LispUsers) \ [8]  Medley $RELEASE bundled for Sun4 (Rooms, LOOPS, LispUsers) \ [9]  Medley $RELEASE bundled for Sun4 (Rooms, LOOPS, LispUsers, NOTECARDS) \ [10] Medley 1.1 demo for Sun3/4 \ [11] NoteCards runtime for Sun3/4 \ [12] NoteCards development (Includes Medley $RELEASE for Sun3/4) \ [13] NoteCards demo for Sun3/4 \ [14] Rooms for Medley $RELEASE \ [15] LOOPS for Medley $RELEASE \ [16] LispUsers for Medley $RELEASE \ [17] PCL <`cat $PCL/pcldate`> (including compiled Medley-files) \ [18] NoteCards demo for RS/6000"echo "\ <pathname of directory to tar> \ \!<Unix command> \ \ [t]ape-type :1/4-inch, 8mm, reel or floppy \ [s]ame as specified earlier \ [p]rint choice \ [h]elp (bring up this menu) \ [q]uit\"answer:echo -n "Select : "set ttyans = `line` set SPECIALTAPE=notTrue	switch ("$ttyans")case 1:	set SPECIALTAPE=true	set directory=$MEDLEYSUN3	set EXTRAFILES = ./rooms	breakswcase 2:	set SPECIALTAPE=true	set directory=$MEDLEYSUN4	set EXTRAFILES = ./rooms	breakswcase 3:	set SPECIALTAPE=true	set directory=$MEDLEYRS6000	set EXTRAFILES = ./rooms	breakswcase 4:	set SPECIALTAPE=true	set directory=$MEDLEYSUN3BETA	set EXTRAFILES = ./rooms	breakswcase 5:	set SPECIALTAPE=true	set directory=$MEDLEYSUN4BETA	set EXTRAFILES = ./rooms	breakswcase 6:	set SPECIALTAPE=true	set directory=$MEDLEYSUNALLBETA	set EXTRAFILES = ./rooms	breakswcase 7:	set SPECIALTAPE=true	set directory=$MEDLEYSUN3BUNDLED	set EXTRAFILES ="./rooms ./loops ./lispusers"	breakswcase 8:	set SPECIALTAPE=true	set directory=$MEDLEYSUN4BUNDLED	set EXTRAFILES="./rooms ./loops ./lispusers"	breakswcase 9:	set SPECIALTAPE=true	set directory=$MEDLEYSUNALL	set EXTRAFILES="./rooms ./loops ./lispusers"	breakswcase 10:	set directory=$MEDLEYDEMO	breakswcase 11:	set directory=$NOTECARDSRUNTIME	breakswcase 12:	set directory=$NOTECARDSDEV	breakswcase 13:	set directory=$NOTECARDSDEMO	breakswcase 14:	set directory=$ROOMS	breakswcase 15:	set directory=$LOOPS	breakswcase 16:	set directory=$LISPUSERS	breakswcase 17:	set directory=$PCL	echo ""	echo "NOTE: The pcldate will be : `cat $PCL/pcldate`"	breakswcase 18:	set directory=$NOTECARDS6000DEMO	breakswcase !?*:	echo ""	eval `echo "$ttyans" | sed -e s/\\!//`	goto answer	breakswcase [tT]:case tape:case TAPE:	tapeloop:	echo "================================================"	echo "Valid tape types are:"	echo " [1] 1/4-inch (default)"	echo " [2] reel"	echo " [3] floppy"	echo " [4] 8mm"	echo -n "Tape type (1/4-inch) ? "	set tapetype=`line`	switch ("$tapetype")	case '1/4-inch'	:	case 1:	case "":		set DeviceType = "1/4-inch cartridge"		set Device="/dev/rst0"	# 1/4-inch cartridge 		breaksw	case 'reel': 	case 2:		set DeviceType = "1600BPI tape-reel"		set Device="/dev/rmt0"	# 1600BPI tapereel		breaksw	case 'floppy': 	case 3:		set Device="/dev/rfd0"		# 3.5" floppy 		set DeviceType = "3.5-inch floppy"		breaksw	case '8mm':	case 4:		set Device = "/dev/rxb0"	# 8mm tape		set DeviceType = "8mm tape"		breaksw	default:		echo "Error  : $tapetype not a valid type."		goto tapeloop		breaksw	endsw	echo "$DeviceType chosen"	goto answercase [sS]:case same:case SAME:	if (! $?directory) then		echo "Error  : You haven't specified a choice yet"		goto answer	endif	breakswcase [pP]:case print:case PRINT:	if (! $?directory) then		echo "Error  : You haven't specified a choice yet"		goto answer	else		echo "================================================"		echo "Directory : `pwd` "		echo "Device    : $DeviceType"		echo "================================================"	endif	goto answer	breakswcase [hH]:case help:	case HELP:	goto menuloop	breakswcase [qQ]:case quit:case QUIT:	echo "generate-tape: aborted ..."	exitcase "":	goto answerdefault:		set directory=("$ttyans")	breakswendswif -d "$directory" then	chdir $directory	set QUESTION="Proceed ? "	continueloop:	# What can I say	echo "================================================"	echo "Directory : `pwd` "	echo "Device    : $DeviceType"		# 3.5" floppy	echo ""	if ($Device == "/dev/rfd0") then		echo "Make sure you are using pre-formated floppies ! "	endif		echo "================================================"	echo -n "$QUESTION"	set ANSWER = `line`	switch ("$ANSWER")	case [yY]:	case [yY][eE][sS]:	case "":		breaksw	case [nN]:	case [nN][oO]:	case [qQ]:	case [qQ][uU][iI][tT]:		goto answer		breaksw	default:		echo 'Please answer "[y]es" or "[n]o"'		goto continueloop		breaksw	endsw	#end of loop	echo ""	echo "OK, (operation can still be aborted with ^C)..."	echo ""# Fix up the device and the COMMAND	switch ("$Device")	case /dev/rst0:		if ("$SPECIALTAPE" == true) then			set Device = /dev/nrst0			set COMMAND = "/bin/tar chfb $Device 256"		else			set COMMAND = "/bin/tar chf $Device"		endif		breaksw	case /dev/rxb0:		if ("$SPECIALTAPE" == true) then			set Device = /dev/nrxb0			set COMMAND = "/bin/tar chfb $Device 256"		else			set COMMAND = "/bin/tar chf $Device"		endif		breaksw	case /dev/rmt0:		if ("$SPECIALTAPE" == true) then			set Device = /dev/nrmt0			set COMMAND = "/bin/tar chfb $Device 256"		else			set COMMAND = "/bin/tar chf $Device"		endif		breaksw	case /dev/rfd0:		if ("$SPECIALTAPE" == true) then			echo "Error: Cannot create this kind of tape"			exit		endif		set COMMAND = "/bin/bar chZBfbH $Device 200 Venue-floppy"		breaksw	endsw# The actual tar/bar command ********************# The "h" in the argument will make sure "tar" follows links# A kludge for Medley 2.0 . HEY,  it works!!!if ("$SPECIALTAPE" == true) then	/bin/mt -f $Device rewind 	$COMMAND ./install-medley	$COMMAND ./medley	$COMMAND ./install.*	$COMMAND ./lisplibrary ./clos	$COMMAND ./checksumdir ./lispsysouts	$COMMAND ./fonts	$COMMAND $EXTRAFILES	/bin/mt -f $Device rewindelse	$COMMAND .endif# *******************************************	if ($Device == "/dev/rfd0") then		/bin/eject	endif	if ($status == 0) then 		echo "Done ..."		if ("$SPECIALTAPE" != true) then			set QUESTION="Do you want a Table of Contents ? "			TOCloop:	# What can I say			echo -n "$QUESTION"			set ANSWER = `line`			switch ("$ANSWER")			case [yY]:			case [yY][eE][sS]:				set UNIQUE = `date '+%y%j%H%M%S'`				set TEMPFILE = /a/tmp/TOC$UNIQUE				onintr interrupted						/bin/tar tf $Device >! $TEMPFILE				/bin/sort $TEMPFILE -o $TEMPFILE.sorted				/bin/egrep -v "/fonts/" $TEMPFILE.sorted >! $TEMPFILE				/bin/egrep "/fonts/" $TEMPFILE.sorted >> $TEMPFILE				/bin/rm $TEMPFILE.sorted	-			enscript -2rG -Pps -bTable-of-Contents $TEMPFILE				breaksw			case [nN]:			case [nN][oO]:				breaksw			default:				echo 'Please answer "[y]es" or "[n]o"'				goto TOCloop				breaksw			endsw			#end of loop		endif				echo -n "Remove the $DeviceType"		if (($Device == /dev/rst0) | ($Device == /dev/nrst0)) then 			echo " and turn the write protect to SAFE."		else if (($Device == /dev/rmt0) | ($Device == /dev/rmt0)) then 			echo " and remove the write protect ring."		else # floppy			echo " and flip the write protect tab"			echo "until you can see through the notch."		endif	else		echo ""		echo "Error  : Tape inserted incorrectly, or tape-drive might not"		echo "        belong to host (`hostname`) you are currently logged in to."		echo ""		set QUESTION = "Try again ? "		goto continueloop	endifelse	echo ""	echo "Error  : $directory is not a valid directory or reply."	goto answerendifset QUESTION="Do you wish to make more tapes ? "moretapesloop:	# What can I say	echo -n "$QUESTION"	set ANSWER = `line`	switch ("$ANSWER")	case [yY]:	case [yY][eE][sS]:		breaksw	case [nN]:	case [nN][oO]:		echo "generate-tape: Done ..."		exit		breaksw	default:		echo 'Please answer "[y]es" or "[n]o"'		goto moretapesloop		breaksw	endsw#end of loopgoto menuloopinterrupted:/bin/rm -f $TEMPFILE