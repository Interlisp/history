/* This is G-file @(#) arith3.c Version 2.3 (5/31/88). copyright Xerox & Fuji Xerox  */static char *id = "@(#) arith3.c	2.3 5/31/88";/* *	Copyright (C) 1987 by Fuji Xerox Co., Ltd. All rights reserved. * *	Auther :  Takeshi Shimizu * *//***********************************************************************//* 		File Name :	arith3.c		Desc	:	  				Date :		Jun. 29, 1987 				Edited by :	Takeshi Shimizu				Changed :	09-Nov, 1987 Hayata(OP_boxiplus) 		Including :	OP_makenumber				OP_boxiplus				OP_boxidiff								*//**********************************************************************/#include "lispemul.h"#include "lispmap.h"#include "emulglobal.h"#include "lispglobal.h"#include "lisptypes.h"#include "address.h"#include "address68k.h"#include "cell.h" #include "arith.h"  #ifdef C_ONLY/**********************************************************************//*		Func name :	OP_makenumber			Date :		Jun. 29, 1987			Edited by :	Take*//**********************************************************************/OP_makenumber(){  LispPTR arg1 ; 	/* Keep val of CSTK */  int  *cell68k ; 	/* Pointer to FIXP cell */  DLword *createcell68k();  PopStackTo(arg1);  /* Pop CSTK to arg1 */  if(((TopOfStack & 0xFF0000) != S_POSITIVE) || ((arg1 & 0xFF0000) !=  S_POSITIVE))	error("OP_makenumber : Illegal Arg");  switch(arg1=(arg1 & 0xFFFF))   {	case 0:		TopOfStack |=S_POSITIVE ;			break;	case 0xFFFF :	TopOfStack |=S_NEGATIVE;			break;	default :	cell68k=(int *)createcell68k(TYPE_FIXP);			*cell68k=arg1<<16;			*cell68k |=TopOfStack & 0xFFFF ;			TopOfStack = LADDR_from_68k(cell68k);			break;    } PC++; /* Increment PC */} /* end OP_makenumber *//**********************************************************************//*		Func name :	OP_boxiplus			Date :		Jun. 29, 1987			Edited by :	Take			Changed :	09-Nov, 1987 Hayata*//**********************************************************************/OP_boxiplus(){  LispPTR  cstk ;	/* keep CSTK value */  int    arg1 ;		/* Immidiate value converted from the OBJECT pointed by CSTK */  int    arg2 ;		/* Immidiate value converted from the OBJECT pointed by TOS */  LispPTR *cell68k ;	/* cache pointer for cstk *//* Type of cell68k was chnaged from DLword* to LispPTR*. */  if( GetTypeNumber(cstk= *((LispPTR *)(CurrentStackPTR))) == TYPE_FIXP )   {	/* Get Immidiate values */	GetNumber(cstk, arg1);	GetNumber(TopOfStack, arg2);	cell68k=(LispPTR *)Addr68k_from_LADDR(cstk);	*cell68k = arg1 + arg2 ; /* No care about overflow */	PopCStack;	PC++;   }  else	ufn(0366); /* UFN call */} /* OP_boxiplus *//**********************************************************************//*		Func name :	OP_boxidiff			Date :		Jun. 29, 1987			Edited by :	Take(31-aug-87)*//**********************************************************************/OP_boxidiff(){  LispPTR  cstk ;	/* keep CSTK value */  int    arg1 ;		/* Immidiate value converted from the OBJECT pointed by CSTK */  int    arg2 ;		/* Immidiate value converted from the OBJECT pointed by TOS */  int *cell68k ;	/* cache pointer for cstk */  if( GetTypeNumber(cstk= *((LispPTR *)(CurrentStackPTR))) == TYPE_FIXP )   {	/* Get Immidiate values */	GetNumber(cstk, arg1);	GetNumber(TopOfStack, arg2);	cell68k=(int *)Addr68k_from_LADDR(cstk);	*cell68k = arg1 - arg2 ; /* No care about underflow */	PopCStack;	PC++;   }  else	ufn(0367); /* UFN call */} /* end OP_boxidiff */#else/**********************************************************************//*		Func name :	N_OP_makenumber			Date :		March 9, 1988			Edited by :	Krivacic*//**********************************************************************/N_OP_makenumber(a, b, error_addr)  int a, b, *error_addr;{ register int result;  if(((a & 0xFFFF0000) != S_POSITIVE) || ((b & 0xFFFF0000) !=  S_POSITIVE))	ERROR_EXIT(error_addr);  result = ((a & 0xffff) << 16) | (b & 0xffff);  N_ARITH_SWITCH(result);} /* end OP_makenumber *//**********************************************************************//*		Func name :	N_OP_boxiplus			Date :		March 9, 1988			Edited by :	Krivacic*//**********************************************************************/N_OP_boxiplus(a, b, error_addr)  register int a;  int b, *error_addr;{  register int    arg2 ;   if( GetTypeNumber(a) == TYPE_FIXP )   {	N_GETNUMBER(b, arg2, bad);	*((LispPTR *)Addr68k_from_LADDR(a)) += arg2;	return(a);   }bad:	ERROR_EXIT(error_addr);} /* OP_boxiplus *//**********************************************************************//*		Func name :	OP_boxidiff*//**********************************************************************/N_OP_boxidiff(a, b, error_addr)  register int a;  int b, *error_addr;{  register int    arg2 ;   if( GetTypeNumber(a) == TYPE_FIXP )   {	N_GETNUMBER(b, arg2, bad);	*((LispPTR *)Addr68k_from_LADDR(a)) -=  arg2;	return(a);   }  bad: ERROR_EXIT(error_addr);} /* end OP_boxidiff */#endif