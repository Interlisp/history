/* This is G-file @(#) stack.c Version 1.3 (3/13/88). copyright Xerox & Fuji Xerox  */static char *id = "@(#) stack.c	1.3 3/13/88";/* *	Copyright (C) 1987 by Fuji Xerox Co., Ltd. All rights reserved. * *	Auther :  Takeshi Shimizu,Naoyuki Mitani * *//**********************************************************************//* 		File Name :	stack.c		Desc	:	stack management  					Date :		Mar 06, 1987 					Edited by :	Naoyuki Mitani 		Including :	OP_myalink				OP_myargcount				*//**********************************************************************/#include "lispemul.h"#include "stack.h"#include "lispmap.h"#include "emulglobal.h"#include "lispglobal.h"/**********************************************************************//*		Func name :	OP_myalink				Get the word offset of the FX of the caller				from the top of StackSpace . And set it to 				TOS as a pointer to integer .				It ignore slowp.					Date :		Apr 13, 1987					Edited by :	Naoyuki Mitani					Change :	Jun. 2 1987 take*//**********************************************************************/OP_myalink(){#ifdef TRACE	printPC();	printf("TRACE: OP_myalink()\n");#endif PushCStack; TopOfStack = ((( CURRENTFX-> alink) & 0xfffe)-FRAMESIZE) | S_POSITIVE;	/* Set the alink offset to TOS as a pointer to integer */ PC++; if (StackCheck)	StackOverflow;}/* end OP_myalink *//**********************************************************************//*		Func name :	OP_myargcount				Get the number of arguments of current stack 				frame . And set it to TOS as a pointer to 				integer .					Date :		Apr 14, 1987					Edited by :	Naoyuki Mitani					Changed by:	Naoyuki Mitani(Mar-06)	*//**********************************************************************/OP_myargcount(){ DLword  arg_num;		/* Number of arguments */ #ifdef TRACE	printPC();	printf("TRACE: OP_myargcount()\n");#endif PushCStack; if (( CURRENTFX-> alink & 1) == 0)	arg_num =((int)((DLword *)CURRENTFX - 2) - (int)IVar) >> 2;					/* FAST case */ else	arg_num =((int)(Stackspace + CURRENTFX->blink) - (int)IVar) >> 2;					/* SLOWP case */ TopOfStack = S_POSITIVE | arg_num; PC++; if (StackCheck)	StackOverflow;}/* end OP_myargcount */