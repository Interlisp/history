(DEFINE-FILE-INFO READTABLE "XCL" PACKAGE "ROOMS")(il:filecreated " 6-Jul-88 18:05:47" il:|{POGO:AISNORTH:XEROX}<ROOMS>NEXT>USERS>RANDOM-WINDOW-TYPES.;4| 9404         il:|changes| il:|to:|  (il:window-types :who-line :addressbook)      il:|previous| il:|date:| "23-Jun-88 12:44:08" il:|{POGO:AISNORTH:XEROX}<ROOMS>NEXT>USERS>RANDOM-WINDOW-TYPES.;3|); Copyright (c) 1988 by Xerox Corporation.  All rights reserved.(il:prettycomprint il:random-window-typescoms)(il:rpaqq il:random-window-typescoms ((il:* il:|;;| "Window types for various LispUsers modules") (file-environments il:random-window-types) (il:p (require "ROOMS")) (il:* il:|;;| "Window type for WHO-LINE") (il:window-types :who-line) (il:* il:|;;| "Window types for the CALENDAR program") (il:window-types :calendar-year :calendar-month) (il:* il:|;;| "Window type for the PRINTERMENU program") (il:window-types :printer-menu-window) (il:* il:|;;| "Window type for some clocks") (il:window-types :crock-window :biclock) (il:* il:|;;| "Window types for AddressBook and PhoneDirectory") (il:coms (il:window-types :addressbook :phone-directory) (il:functions address-book-window-p phone-directory-window-p find-window)) (il:* il:|;;| "Window type for GRID-ICONS") (il:window-types :grid-icon-coms-editor) (il:coms (il:* il:|;;| "special handlers for FILEWATCH.  these are somewhat broken") (il:declare\: il:eval@compile il:dontcopy (il:p (unless (il:reclook (quote il:fw-ofd)) (il:loadvars (quote (il:fw-ofd)) (quote il:filewatch))))) (il:advise il:filewatch) (il:functions file-watch-exit-function file-watch-entry-function) (il:p (pushnew (quote file-watch-exit-function) *room-exit-functions*) (pushnew (quote file-watch-entry-function) *room-entry-functions*)))))(il:* il:|;;| "Window types for various LispUsers modules")(define-file-environment il:random-window-types :compiler :compile-file :readtable "XCL" :package "ROOMS")(require "ROOMS")(il:* il:|;;| "Window type for WHO-LINE")(def-window-type :who-line :recognizer (lambda (window) (declare (global il:*who-line*)) (eq window il:*who-line*)) :abstracter (lambda (window) nil) :reconstituter (lambda (props) (declare (global il:*who-line*)) (il:install-who-line-options) il:*who-line*) :no-shape t (il:* il:\; "don't scale placements") :title "" :files (il:who-line il:random-window-types))(il:* il:|;;| "Window types for the CALENDAR program")(def-window-type :calendar-year :recognizer (lambda (w) (eq (il:windowprop w (quote il:repaintfn)) (quote il:repaintyear))) :abstracter (lambda (w) (list (il:windowprop w (quote il:year#)))) :reconstituter (lambda (data) (destructuring-bind (year) data (flet ((find-calendar-year nil (find-if (function (lambda (w) (and (eq (il:windowprop w (quote il:repaintfn)) (quote il:repaintyear)) (eql (il:windowprop w (quote il:year#)) year)))) (il:openwindows)))) (or (find-calendar-year) (progn (il:calendar nil nil year) (find-calendar-year)))))) :title (lambda (placement region dsp) (print-pep-title-string (or (il:windowprop (placement-window placement) (quote il:year#)) "YEAR") region dsp :no-title-bar? t)) :files (il:calendar il:random-window-types))(def-window-type :calendar-month :recognizer (lambda (w) (eq (il:windowprop w (quote il:repaintfn)) (quote il:repaintmonth))) :abstracter (lambda (w) (list (il:windowprop w (quote il:year#)) (il:windowprop w (quote il:month#)))) :reconstituter (lambda (data) (destructuring-bind (year month) data (flet ((find-calendar-month nil (find-if (function (lambda (w) (and (eq (il:windowprop w (quote il:repaintfn)) (quote il:repaintyear)) (eql (il:windowprop w (quote il:year#)) year) (eql (il:windowprop w (quote il:month#)) month)))) (il:openwindows)))) (or (find-calendar-month) (progn (il:calendar month nil year) (find-calendar-month)))))) :title (lambda (placement region dsp) (print-pep-title-string (let ((month-number (il:windowprop (placement-window placement) (quote il:month#)))) (if month-number (nth (1- month-number) (quote ("Jan" "Feb" "Mar" "Apr" "May" "Jun" "Jul" "Aug" "Sep" "Oct" "Nov" "Dec"))) "MONTH")) region dsp :no-title-bar? t)) :files (il:calendar il:random-window-types))(il:* il:|;;| "Window type for the PRINTERMENU program")(def-window-type :printer-menu-window :recognizer (lambda (w) (and (boundp (quote il:printermenu.window)) (eq w il:printermenu.window))) :reconstituter (lambda (data) (declare (ignore data)) (unless (and (boundp (quote il:printermenu.window)) il:printermenu.window) (il:printermenu)) il:printermenu.window) :abstracter (lambda (w) (declare (ignore w)) nil) :title "PrinterMenu" :files (il:printermenu il:random-window-types))(il:* il:|;;| "Window type for some clocks")(def-window-type :crock-window :recognizer (lambda (w) (and (boundp (quote il:crockwindow)) (eq w il:crockwindow))) :reconstituter (lambda (data) (declare (ignore data)) (unless (and (boundp (quote il:crockwindow)) (il:windowp il:crockwindow)) (il:crock (il:createregion 0 0 100 100))) il:crockwindow) :abstracter (lambda (w) (declare (ignore w)) nil) :title "Crock" :files (il:crock il:random-window-types))(def-window-type :biclock :recognizer (lambda (window) (eq (il:windowprop window (quote il:reshapefn)) (quote il:biclockrsfn))) :abstracter (lambda (window) (declare (ignore window)) nil) :reconstituter (lambda (data) (declare (ignore data) (global il:biclockwindow)) (if (boundp (quote il:biclockwindow)) il:biclockwindow (il:biclock))) :title (lambda (placement region dsp) (print-pep-title-string "Clock" region dsp :no-title-bar? t)) :files (il:biclock il:random-window-types))(il:* il:|;;| "Window types for AddressBook and PhoneDirectory")(def-window-type :addressbook :dependencies (:textstream) :recognizer address-book-window-p :abstracter (lambda (window) (declare (ignore window)) nil) :reconstituter (lambda (data) (declare (ignore data)) (or (find-window (function address-book-window-p) t) (il:|MakeAddressBook|))) :no-shape (il:* il:|;;| "don't shape placements, because reshaping address books loses") t :title "Address" :files (il:addressbook il:random-window-types))(def-window-type :phone-directory :recognizer phone-directory-window-p :abstracter (lambda (window) (declare (ignore window)) nil) :reconstituter (lambda (data) (declare (ignore data)) (or (find-window (function phone-directory-window-p) t) (il:|Let-your-fingers-do-the-walking|))) :title "Phone" :files (il:phone-directory il:random-window-types))(defun address-book-window-p (window) (eq (il:windowprop window (quote il:|ProcessName|)) (quote il:|Address Book|)))(defun phone-directory-window-p (window) (eq (il:windowprop window (quote il:buttoneventfn)) (quote il:|Phone-Window-ButtonEventFn|)))(defun find-window (test &optional include-hidden-p) (dolist (window (all-windows include-hidden-p)) (when (funcall test window) (return window))))(il:* il:|;;| "Window type for GRID-ICONS")(def-window-type :grid-icon-coms-editor :recognizer (lambda (window) (eq (il:windowprop window (quote il:buttoneventfn)) (quote il:loaded-files-icon-window-buttoneventfn))) :abstracter (lambda (window) (declare (ignore window)) nil) :reconstituter (lambda (data) (declare (ignore data) (global il:loaded-files-icon-window)) il:loaded-files-icon-window) :files (il:grid-icons il:random-window-types))(il:* il:|;;| "special handlers for FILEWATCH.  these are somewhat broken")(il:declare\: il:eval@compile il:dontcopy (unless (il:reclook (quote il:fw-ofd)) (il:loadvars (quote (il:fw-ofd)) (quote il:filewatch))))(reinstall-advice (quote il:filewatch) :before (quote ((:first (locally (declare (il:globalvars il:|FW-Dormant?|)) (and il:|FW-Dormant?| (il:del.process (il:find.process (quote il:|FileWatcher|))) (il:block)))))))(il:readvise il:filewatch)(defun file-watch-exit-function (room) (declare (global il:|FW-OFDList|)) (when (fboundp (quote il:filewatchprop)) (il:* il:|;;| "turn file watcher display off") (dolist (ofd il:|FW-OFDList|) (let ((window (il:|fetch| (il:fw-ofd il:ofdwindow) il:|of| ofd))) (when (il:openwp window) (il:\\closew1 window))))))(defun file-watch-entry-function (room) (declare (global il:|FW-Running?| il:|FW-Dormant?| il:|FW-OFDList|)) (when (fboundp (quote il:filewatchprop)) (unless (eq room *current-room*) (il:* il:|;;| "ignore case where filewatch just turned on from editor & we're leaving/re-entring the room to refresh screen.") (room-prop *current-room* :file-watch-on? (and il:|FW-Running?| (not il:|FW-Dormant?|)))) (if (room-prop room :file-watch-on?) (il:* il:|;;| "turn on the file watcher display") (if il:|FW-Running?| (progn (dolist (ofd il:|FW-OFDList|) (unless (eq (il:|fetch| (il:fw-ofd il:ofdstatus) il:|of| ofd) (quote il:forgotten)) (il:openw (il:|fetch| (il:fw-ofd il:ofdwindow) il:|of| ofd)))) (setq il:|FW-Dormant?| nil)) (il:filewatch (quote il:on))) (il:* il:|;;| "turn filewatch display off") (progn (setq il:|FW-Dormant?| t) (il:* il:|;;| "some may have opened since FILE-WATCH-EXIT-FUNCTION was called") (dolist (ofd il:|FW-OFDList|) (let ((window (il:|fetch| (il:fw-ofd il:ofdwindow) il:|of| ofd))) (when (il:openwp window) (il:\\closew1 window))))))))(pushnew (quote file-watch-exit-function) *room-exit-functions*)(pushnew (quote file-watch-entry-function) *room-entry-functions*)(il:putprops il:random-window-types il:copyright ("Xerox Corporation" 1988))(il:declare\: il:dontcopy  (il:filemap (nil)))il:stop