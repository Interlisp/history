(DEFINE-FILE-INFO READTABLE "XCL" PACKAGE "YP")(il:filecreated " 7-Sep-89 22:25:56" "{NB:Parc:Xerox}<NFS>Medley>GIDPATCH.;2" 2311         il:|changes| il:|to:|  (il:vars il:gidpatchcoms)      il:|previous| il:|date:| " 7-Sep-89 22:25:04" "{NB:Parc:Xerox}<NFS>Medley>GIDPATCH.;1"); Copyright (c) 1989 by Xerox Corporation.  All rights reserved.(il:prettycomprint il:gidpatchcoms)(il:rpaqq il:gidpatchcoms ((il:functions get-user-gids) (il:vars (*gids-from-user-map* "gid.byuser")) (il:prop (il:filetype il:makefile-environment) il:gidpatch)))(defun get-user-gids (user-name) (unless (stringp user-name) (setq user-name (string user-name))) (let ((gids (cond (*gids-from-user-map* (il:* il:\; "There's already a nice inverted map, use it.") (let ((entry (yp-match *gids-from-user-map* user-name))) (and entry (let ((*read-base* 10)) (read-from-string entry))))) (t (il:* il:|;;| "Ugh, have to invert group.bygid manually.  I.e., enumerate it, and search for user-name in each entry.") (let ((name-length (length user-name))) (read-map "group.bygid" (function (lambda (key line) (il:* il:|;;| "Format of LINE is \"groupname:*:id:members\", where members is list of users separated by commas") (let ((colon (position #\: line))) (and colon (setq colon (position #\: line :start (1+ colon))) (setq colon (position #\: line :start (1+ colon))) (il:* il:\; "Proper format so far, so search for username among members") (let ((start (+ colon 2)) end) (loop (unless (setq start (il:strpos user-name line start)) (il:* il:\; "Gosh, I'd use SEARCH instead, but STRPOS is 10 times faster") (return nil)) (setq end (+ start name-length)) (case (char line (- start 2)) ((#\: #\,) (il:* il:\; "Good, name started on name boundary") (when (or (>= end (length line)) (eql (char line (1- end)) #\,)) (il:* il:\; "Good, name ends on name boundary") (return (integer-from-string key))))) (setq start end))))))))))))) (if (listp gids) gids (format il:promptwindow "~&Couldn't find group IDs for user ~A because ~A" user-name gids))))(il:rpaq *gids-from-user-map* "gid.byuser")(il:putprops il:gidpatch il:filetype :compile-file)(il:putprops il:gidpatch il:makefile-environment (:readtable "XCL" :package "YP"))(il:putprops il:gidpatch il:copyright ("Xerox Corporation" 1989))(il:declare\: il:dontcopy  (il:filemap (nil)))il:stop