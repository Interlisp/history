/* @(#) Cursor.c Version 1.5 (9/18/90). copyright venue & Fuji Xerox  */static char *id = "@(#) Cursor.c	1.5 9/18/90	(venue & Fuji Xerox)";/**** Copyright (C) 1988 by Fuji Xerox co.,Ltd. All rights reserved.**		Author: Mitsunori Matsuda*		Date  : August 12, 1988**//************************************************************************//*									*//*	Copyright 1989, 1990 Venue, Fuji Xerox Co., Ltd, Xerox Corp.	*//*									*//*	This file is work-product resulting from the Xerox/Venue	*//*	Agreement dated 18-August-1989 for support of Medley.		*//*									*//************************************************************************/#include <stdio.h>#include <X11/Xlib.h>#include <X11/Xutil.h>#include "lispemul.h"#include "lisptypes.h"#include "display.h"#include "dbprint.h"#include "XVersion.h"#include "MyWindow.h"extern Display *Xdisplay;extern MyWindow Lisp_Window;extern XGCValues gcv;extern int Lisp_Xinitialized	 , Video_Inverted	 , Bitmap_Pad	 , Default_Depth;extern unsigned long Black_Pixel	           , White_Pixel;XImage CursorImage;Pixmap CursorPixmap_source     , CursorPixmap_mask;GC cursor_source_gc , cursor_mask_gc;XColor cursor_fore_xcsd     , cursor_back_xcsd     , xced;Colormap Colors;/************************************************************************//*									*//*			i n i t _ X c u r s o r				*//*									*//*	Initialization code for X-windows cursors.			*//*									*//************************************************************************/init_Xcursor(){    TPRINT(( "TRACE: init_Xcursor()\n" ));    CursorImage.width   = CURSORWIDTH;    CursorImage.height  = CURSORHEIGHT;    CursorImage.xoffset = 0;    CursorImage.format  = XYBitmap;#if (defined (XV11R1) || defined(BYTESWAP))    CursorImage.byte_order  = LSBFirst;#else XV11R1 | BYTESWAP    CursorImage.byte_order  = MSBFirst;#endif XV11R1 | BYTESWAP    CursorImage.bitmap_unit = BITSPER_DLWORD;#ifdef AIX    CursorImage.bitmap_pad  = 32;#else    CursorImage.bitmap_pad  = Bitmap_Pad;#endif AIX    CursorImage.depth       = 1;    CursorImage.bytes_per_line = BITSPER_DLWORD/8;     CursorImage.bitmap_bit_order = MSBFirst;    CursorPixmap_source = XCreatePixmap( Xdisplay, Lisp_Window.win				, CURSORWIDTH, CURSORHEIGHT,				1);    CursorPixmap_mask   = XCreatePixmap( Xdisplay, Lisp_Window.win				, CURSORWIDTH, CURSORHEIGHT, 				1);    gcv.function = Video_Inverted ? GXcopyInverted : GXcopy;    gcv.foreground = Black_Pixel;    gcv.background = White_Pixel;#ifdef AIX    gcv.plane_mask = 1;#endif AIX    cursor_source_gc = XCreateGC( Xdisplay, Lisp_Window.win				, GCForeground|GCBackground|GCFunction#ifdef AIX					|GCPlaneMask#endif AIX				, &gcv );    cursor_mask_gc   = XCreateGC( Xdisplay, Lisp_Window.win				, GCForeground|GCBackground|GCFunction#ifdef AIX					|GCPlaneMask#endif AIX				, &gcv );    XAllocNamedColor( Xdisplay, Colors, "black" 			, &cursor_fore_xcsd, &xced );    XAllocNamedColor( Xdisplay, Colors, "white" 			, &cursor_back_xcsd, &xced );  } /* end init_Xcursor *//************************************************************************//*									*//*			s e t _ X c u r s o r				*//*									*//*									*//*									*//************************************************************************/set_Xcursor( bitmap, hotspot_x, hotspot_y, return_cursor, from_lisp )  unsigned char *bitmap;  int hotspot_x    , hotspot_y    , from_lisp;  Cursor *return_cursor;  {    extern unsigned char reversedbits[];    unsigned char image[32];    int i;    Pixmap Cursor_src, Cursor_msk;#ifdef BYTESWAP       if (from_lisp) for (i=0; i<32; i++) image[i] = reversedbits[bitmap[i^3]];    else for ( i=0; i<32; i++) image[i] = reversedbits[bitmap[i]];#else    for ( i=0; i<32; i++) image[i] = reversedbits[bitmap[i]];#endif BYTESWAP         Cursor_src = XCreatePixmapFromBitmapData(Xdisplay, Lisp_Window.win,						  image, 16, 16, 1, 0, 1),         Cursor_msk = XCreatePixmapFromBitmapData(Xdisplay, Lisp_Window.win,						  image, 16, 16, 1, 0, 1);#ifdef NEVER#ifdef TRACE     printf( "TRACE: set_Xcursor()\n" );#endif    CursorImage.data = (char*) bitmap;    XPutImage( Xdisplay, CursorPixmap_source, cursor_source_gc	     , &CursorImage, 0, 0, 0, 0, CURSORWIDTH, CURSORHEIGHT );    XPutImage( Xdisplay, CursorPixmap_mask  , cursor_mask_gc	     , &CursorImage, 0, 0, 0, 0, CURSORWIDTH, CURSORHEIGHT );#endif NEVER    *return_cursor = XCreatePixmapCursor( Xdisplay#ifdef NEVER			, CursorPixmap_source, CursorPixmap_mask#else			, Cursor_src, Cursor_msk#endif NEVER			, &cursor_fore_xcsd, &cursor_back_xcsd			, hotspot_x, hotspot_y );	/* Should free these now (doc says server may not copy them) */	XFreePixmap(Xdisplay, Cursor_src);	XFreePixmap(Xdisplay, Cursor_msk);    XFlush( Xdisplay );  } /* end set_Xcursor */