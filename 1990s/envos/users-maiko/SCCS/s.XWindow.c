h33638s 00008/00004/00215d D 1.9 93/02/08 14:43:31 sybalsky 9 8c Big VM (and new CDR coding) changes for 3.0 \nes 00001/00001/00218d D 1.8 92/04/21 17:00:12 sybalsky 8 7c shortening file names for DOS \nes 00005/00005/00214d D 1.7 91/05/26 17:24:22 sybalsky 7 6c Misc X Cleanup, trying to fix a bug that's in the X-server code.es 00005/00000/00214d D 1.6 91/01/25 17:53:14 sybalsky 6 5c Retrofit HP9000/RS6000 changeses 00000/00000/00214d D 1.5 90/09/21 18:09:56 sybalsky 5 4c Fix for color Xes 00013/00007/00201d D 1.4 90/09/18 23:29:07 sybalsky 4 3c Retrofit changes from AIX, DEC3100, PS/2es 00102/00057/00106d D 1.3 90/08/21 17:14:17 sybalsky 3 2c Retrofit AIX changes from IBMes 00013/00002/00150d D 1.2 90/04/20 01:15:57 sybalsky 2 1c names, bulk change.es 00152/00000/00000d D 1.1 90/04/19 23:18:31 sybalsky 1 0c date and time created 90/04/19 23:18:31 by sybalskyeuUf e 0tTI 1/* %Z% %M% Version %I% (%G%). copyright venue & Fuji Xerox  */static char *id = "%Z% %M%	%I% %G%	(venue & Fuji Xerox)";D 2/* %Z% %M% Version %I% (%G%). copyright venue & Fuji Xerox  */static char *id = "%Z% %M%	%I% %G%	(venue & Fuji Xerox)";E 2I 2/************************************************************************//*									*//*	Copyright 1989, 1990 Venue, Fuji Xerox Co., Ltd, Xerox Corp.	*//*									*//*	This file is work-product resulting from the Xerox/Venue	*//*	Agreement dated 18-August-1989 for support of Medley.		*//*									*//************************************************************************/E 2/**** Copyright (C) 1988 by Fuji Xerox co.,Ltd. All rights reserved.**		Author: Mitsunori Matsuda*		Date  : September 5, 1988*/#include <stdio.h>#include <X11/Xlib.h>#include <X11/Xutil.h>#include "lispemul.h"#include "address.h"D 8#include "address68k.h"E 8I 8#include "adr68k.h"E 8I 6#include "dbprint.h"E 6#include "XVersion.h"#include "MyWindow.h"extern DLword *DisplayRegion68k;extern Display *Xdisplay;extern GC Copy_GC	, CopyInvert_GC;extern XSetWindowAttributes Lisp_SetWinAttributes;D 7extern int Bitmap_PadE 7I 7extern int Bitmap_Pad, Bitmap_UnitE 7	 , Video_Inverted	 , LispDisplayWidth	 , LispDisplayHeight	 , Scroll_Width	 , Scroll_Border;extern int Backing_Store;XImage XScreenBitmap;DisplayArea ScreenRegion;int Bit_Gravity;I 3/************************************************************************//*									*//*		B e f o r e _ C r e a t e D i s p l a y			*//*									*//*									*//*									*//************************************************************************/E 3Before_CreateDisplay( parent, child )D 3MyWindow *parent       , *child;{E 3I 3  MyWindow *parent         , *child;  {E 3#ifdef TRACED 3	printf( "TRACE: Before_CreateDisplay()\n" );E 3I 3    printf( "TRACE: Before_CreateDisplay()\n" );E 3#endifD 3	/* Display Window Geometory */	child->border = 0;			/* fixed width */	child->x = child->y = 0;	child->width  = parent->width  			- ( (Scroll_Width>0) ? (Scroll_Width + 2*Scroll_Border)E 3I 3    /* Display Window Geometory */    child->border = 0;			/* fixed width */    child->x = child->y = 0;    child->width  = parent->width  		    - ( (Scroll_Width>0) ? (Scroll_Width + 2*Scroll_Border)E 3					     : 0 );D 3	child->height = parent->height 			- ( (Scroll_Width>0) ? (Scroll_Width + 2*Scroll_Border)E 3I 3    child->height = parent->height 		    - ( (Scroll_Width>0) ? (Scroll_Width + 2*Scroll_Border)E 3					     : 0 );I 6    TPRINT(("Window geometry: parent width=%d, parent height=%d, width=%d, height=%d, border=%d.\n",	    parent->width, parent->height, child->width, child->height, child->border));E 6D 3} /* end Before_CreateDisplay */E 3I 3  } /* end Before_CreateDisplay */E 3I 3/************************************************************************//*									*//*		A f t e r _ C r e a t e D i s p l a y			*//*									*//*									*//*									*//************************************************************************/E 3After_CreateDisplay( parent, child )D 3MyWindow *parentE 3I 3  MyWindow *parentE 3       , *child;D 3{E 3I 3  {E 3#ifdef TRACED 3	printf( "TRACE: After_CreateDisplay()\n" );E 3I 3    printf( "TRACE: After_CreateDisplay()\n" );E 3#endifD 3	XMapWindow( Xdisplay, child->win );	AddTop_WindowList( child );E 3I 3    XMapWindow( Xdisplay, child->win );    AddTop_WindowList( child );E 3D 3	/* Default BitGravity is NorthWest */	Bit_Gravity = NorthWestGravity;	Lisp_SetWinAttributes.bit_gravity = Bit_Gravity;	XChangeWindowAttributes( XdisplayE 3I 3    /* Default BitGravity is NorthWest */    Bit_Gravity = NorthWestGravity;    Lisp_SetWinAttributes.bit_gravity = Bit_Gravity;    XChangeWindowAttributes( XdisplayE 3				, child->win				, CWBitGravity				, &Lisp_SetWinAttributes );	/* Backing Store */D 3	if( Backing_Store ) {		Lisp_SetWinAttributes.backing_store = Always;		XChangeWindowAttributes( XdisplayE 3I 3    if( Backing_Store )      {	Lisp_SetWinAttributes.backing_store = Always;	XChangeWindowAttributes( XdisplayE 3				, child->win				, CWBackingStore				, &Lisp_SetWinAttributes );D 3	} /* end if(Backing_Store) */E 3I 3      } /* end if(Backing_Store) */E 3	/* Dispay Region */D 3	ScreenRegion.left_x   = 0;	ScreenRegion.top_y    = 0;	ScreenRegion.right_x  = child->width  - 1;	ScreenRegion.bottom_y = child->height - 1;E 3I 3    ScreenRegion.left_x   = 0;    ScreenRegion.top_y    = 0;    ScreenRegion.right_x  = child->width  - 1;    ScreenRegion.bottom_y = child->height - 1;E 3#ifdef TRACED 3	printf( "After_CreateDisplayRegion(): " );	printf( " ScreenRegion( %d, %d )-( %d, %d )\n"E 3I 3    printf( "After_CreateDisplayRegion(): " );    printf( " ScreenRegion( %d, %d )-( %d, %d )\n"E 3				, ScreenRegion.left_x				, ScreenRegion.top_y				, ScreenRegion.right_x				, ScreenRegion.bottom_y );#endifD 3	child->gc = Video_Inverted ? &CopyInvert_GCE 3I 3    child->gc = Video_Inverted ? &CopyInvert_GCE 3				    : &Copy_GC;D 3	/* Initialize Image */        XScreenBitmap.width   = LispDisplayWidth;        XScreenBitmap.height  = LispDisplayHeight;         XScreenBitmap.xoffset = 0;        XScreenBitmap.format  = XYBitmap;        XScreenBitmap.data = (char*) DisplayRegion68k;E 3I 3    /* Initialize Image */    XScreenBitmap.width   = LispDisplayWidth;    XScreenBitmap.height  = LispDisplayHeight;     XScreenBitmap.xoffset = 0;    XScreenBitmap.format  = XYBitmap;    XScreenBitmap.data = (char*) DisplayRegion68k;E 3D 4#ifdef XV11R1E 4I 4#if (defined(XV11R1)) || (defined(BYTESWAP))E 4D 3        XScreenBitmap.byte_order = LSBFirst;E 3I 3    XScreenBitmap.byte_order = LSBFirst;E 3D 4#else XV11R1E 4I 4D 9#else XV11R1 || BYTESWAPE 9I 9#else /* XV11R1 || BYTESWAP */E 9E 4D 3        XScreenBitmap.byte_order = MSBFirst;E 3I 3    XScreenBitmap.byte_order = MSBFirst;E 3D 4#endif XV11R1E 4I 4D 9#endif XV11R1 || BYTESWAPE 9I 9#endif /* XV11R1 || BYTESWAP */E 9I 9E 9#ifndef NEVERD 7    XScreenBitmap.bitmap_unit = 32;E 7I 7    XScreenBitmap.bitmap_unit = Bitmap_Unit;E 7#elseE 4D 3        XScreenBitmap.bitmap_unit = 16;E 3I 3    XScreenBitmap.bitmap_unit = 16;E 3D 4        XScreenBitmap.bitmap_bit_order = MSBFirst;D 3        XScreenBitmap.bitmap_pad = Bitmap_Pad;        XScreenBitmap.depth = 1;        XScreenBitmap.bytes_per_line = ((LispDisplayWidth+(BITSPER_DLWORD-1))E 3I 3#ifdef AIX    XScreenBitmap.bitmap_pad = 16;E 4I 4D 7#endif NEVERE 7I 7D 9#endif sunE 9I 9#endif /* sun */E 9E 7I 9E 9    XScreenBitmap.bitmap_bit_order = MSBFirst;D 7#ifndef NEVERE 7I 7#ifndef NEVEWRE 7    XScreenBitmap.bitmap_pad = 32;E 4#else    XScreenBitmap.bitmap_pad = Bitmap_Pad;D 4#endif AIXE 4I 4D 7#endif NEVERE 7I 7D 9#endif sunE 9I 9#endif /* sun */E 9E 7E 4    XScreenBitmap.depth = 1;    XScreenBitmap.bytes_per_line = ((LispDisplayWidth+(BITSPER_DLWORD-1))E 3                                        /BITSPER_DLWORD) * (BITSPER_DLWORD/8);D 3} /* end After_CreateDisplay */E 3I 3  } /* end After_CreateDisplay */E 3I 3/************************************************************************//*									*//*		B e f o r e _ R e s i z e D i s p l a y			*//*									*//*									*//*									*//************************************************************************/E 3Before_ResizeDisplay( child )D 3MyWindow *child;{E 3I 3  MyWindow *child;  {E 3#ifdef TRACED 3	printf( "TRACE: Before_ResizeDisplay()\n" );E 3I 3    printf( "TRACE: Before_ResizeDisplay()\n" );E 3#endifD 3	child->width = child->parent->width 			- ( (Scroll_Width>0) ? (Scroll_Width + 2*Scroll_Border)E 3I 3    child->width = child->parent->width 		    - ( (Scroll_Width>0) ? (Scroll_Width + 2*Scroll_Border)E 3					    : 0 );D 3	child->height = child->parent->height 			- ( (Scroll_Width>0) ? (Scroll_Width + 2*Scroll_Border)E 3I 3    child->height = child->parent->height 		    - ( (Scroll_Width>0) ? (Scroll_Width + 2*Scroll_Border)E 3					    : 0 );D 3} /* end Before_ResizeDisplay */E 3I 3  } /* end Before_ResizeDisplay */E 3I 3/************************************************************************//*									*//*		A f t e r _ R e s i z e D i s p l a y			*//*									*//*									*//*									*//************************************************************************/E 3After_ResizeDisplay( child )D 3MyWindow *child;{E 3I 3  MyWindow *child;  {E 3#ifdef TRACED 3	printf( "TRACE: After_ResizeDisplay()\n" );E 3I 3    printf( "TRACE: After_ResizeDisplay()\n" );E 3#endifD 3} /* end After_ResizeDisplay */E 3I 3  } /* end After_ResizeDisplay */E 3E 1