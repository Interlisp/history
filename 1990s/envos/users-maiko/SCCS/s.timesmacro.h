h23049s 00001/00001/00074d D 1.2 88/03/13 13:27:33 hayata 2 1c Add SCCS key id (%Z%)es 00075/00000/00000d D 1.1 88/02/23 18:37:22 hayata 1 0c date and time created 88/02/23 18:37:22 by hayataeuUtTI 1D 2/* This is G-file %M% Version %I% (%G%). copyright Xerox & Fuji Xerox  */E 2I 2/* This is G-file %Z% %M% Version %I% (%G%). copyright Xerox & Fuji Xerox  */E 2#define TWOS_compl(x) ((0xffff & (~(x)))+1)#define OPTIMES2 { \  arg1 = *((LispPTR *)(CSTKPTR)); \  if((arg1 & 0xFF0000) ==  S_POSITIVE){ \	if((TOPOFSTACK & 0xFF0000) == S_POSITIVE){ \	  result = (0xffff & TOPOFSTACK) * (0xffff & arg1) ;\	  goto POS;\	}\	else if ((TOPOFSTACK & 0xFF0000) == S_NEGATIVE){ \	  if((arg1 & 0xffff)==0) goto ZERO; \	  result = (TWOS_compl(TOPOFSTACK & 0xffff)) * (0xffff & arg1) ;\	  goto NEG ;\	} \	else { \		UFN(Get_BYTE(PCMAC)); \		NEXTOPCODE; \	     } \  } \ else if((arg1 & 0xFF0000) ==  S_NEGATIVE) {\	  if((TOPOFSTACK & 0xFF0000) == S_POSITIVE){\	  /* nega * posi */\		if((TOPOFSTACK & 0xffff)==0) goto ZERO; \		result = (0xffff & TOPOFSTACK) * TWOS_compl(0xffff & arg1) ;\		goto NEG ;\	   }\	  else if ((TOPOFSTACK & 0xFF0000) == S_NEGATIVE){\		/* neg * neg */\		  if(((arg1 & 0xffff)==0)||((TOPOFSTACK & 0xffff)==0))\		   {\			 UFN(Get_BYTE(PCMAC)); /* UFN case */\			  NEXTOPCODE;\		   }\			result=TWOS_compl(arg1 & 0xffff)*TWOS_compl(0xffff & TOPOFSTACK) ;\			goto POS ;\		}\	}\      else \	{\		UFN(Get_BYTE(PCMAC)); /* UFN case */\		NEXTOPCODE;\	}\POS :	if(result & 0xffff0000) /* UFN case */\	{\	  if (result & 0x80000000) {\		UFN(Get_BYTE(PCMAC));/* MSB on? */ \		NEXTOPCODE ;\	  }\	  wordp = createcell68k(TYPE_FIXP);\	  *((int *) wordp)= result ;\	  TOPOFSTACK = LADDR_from_68k(wordp);\	}\	else\	TOPOFSTACK=S_POSITIVE| (result&0xffff);\ 	CSTKPTR -= 2 ;\	PCMAC++; /* Increment PCMAC */\	NEXTOPCODE;\NEG :	if(result & 0xffff0000) {\		UFN(Get_BYTE(PCMAC)); /* UFN case */\		NEXTOPCODE;\	 }\	if((result = TWOS_compl(result))==0) {\		UFN(Get_BYTE(PCMAC)); /* UFN case */\		NEXTOPCODE;\	 }\	TOPOFSTACK=S_NEGATIVE | (result&0xffff);\ 	CSTKPTR -= 2 ;\	PCMAC++; /* Increment PCMAC */\	NEXTOPCODE;\ZERO : 	TOPOFSTACK=S_POSITIVE;\ 	CSTKPTR -= 2 ;\	PCMAC++; /* Increment PCMAC */\	NEXTOPCODE;\} /* end OP_times2 */E 1