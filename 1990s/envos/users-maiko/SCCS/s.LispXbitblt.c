h23562s 00080/00064/00046d D 1.2 91/01/24 23:30:34 sybalsky 2 1c Removed extraneous "static" line at the front; reformatted code.es 00110/00000/00000d D 1.1 91/01/24 14:34:37 sybalsky 1 0c date and time created 91/01/24 14:34:37 by sybalskyeuUf e 0tTI 1/* %Z% %M% Version %I% (%G%). copyright venue & Fuji Xerox  */static char *id = "%Z% %M%	%I% %G%	(venue & Fuji Xerox)";D 2/* @(#) LispXbitblt.c Version 1.2 (4/20/90). copyright venue & Fuji Xerox  */static char *id = "@(#) LispXbitblt.c	1.2 4/20/90	(venue & Fuji Xerox)";E 2/**** Copyright (C) 1988 by Fuji Xerox co.,Ltd. All rights reserved.**		Author: Mitsunori Matsuda*		Date  : August 11, 1988**/I 2/************************************************************************//*									*//*	Copyright 1989, 1990 Venue, Fuji Xerox Co., Ltd, Xerox Corp.	*//*									*//*	This file is work-product resulting from the Xerox/Venue	*//*	Agreement dated 18-August-1989 for support of Medley.		*//*									*//************************************************************************/E 2#include <stdio.h>#include <X11/Xlib.h>#include <X11/Xutil.h>#include "XVersion.h"#include "MyWindow.h"I 2#include "dbprint.h"E 2#define FALSE 0#define TRUE  !FALSEextern Display *Xdisplay;extern XImage XScreenBitmap;extern MyWindow Lisp_Window	      , Display_Window;extern DisplayArea ScreenRegion;D 2#define Xbitblt(x,y,w,h) { \		XPutImage( Xdisplay, Display_Window.win \			, *(Display_Window.gc) \			, &XScreenBitmap \			, x \			, y \			, x - ScreenRegion.left_x \			, y - ScreenRegion.top_y \			, w \			, h ); \	/*	XFlush( Xdisplay ); */	 \} E 2I 2#define Xbitblt(x,y,w,h)			\  {						\    XPutImage( Xdisplay, Display_Window.win,	\	       *(Display_Window.gc),		\	       &XScreenBitmap,			\	       x , y, x - ScreenRegion.left_x,	\	      y - ScreenRegion.top_y, w, h );	\  } /************************************************************************//*									*//*		    c l i p p i n g _ X b i t b l t			*//*									*//*	BITBLT from the display region to the X server's display,	*//*	clipping to fit the window we're in on the server.		*//*									*//************************************************************************/E 2clipping_Xbitblt(x,y,w,h)D 2int x  , y  , w  , h;{ 	int temp_x 	  , temp_y; E 2I 2  int x, y, w, h;  {     int temp_x, temp_y; E 2D 2#ifdef TRACE	printf( "TRACE: clipping_Xbitblt()\n" );#endifE 2I 2    TPRINT(( "TRACE: clipping_Xbitblt()\n" ));E 2D 2	temp_x = x + w - 1; 	temp_y = y + h - 1; E 2I 2    temp_x = x + w - 1;     temp_y = y + h - 1; E 2D 2	if( ( temp_x < ScreenRegion.left_x ) 	 || ( x > ScreenRegion.right_x ) 	 || ( temp_y < ScreenRegion.top_y ) 	 || ( y > ScreenRegion.bottom_y ) ) { 		return; 	} E 2I 2    if ( (temp_x < ScreenRegion.left_x) 	 || (x > ScreenRegion.right_x) 	 || (temp_y < ScreenRegion.top_y) 	 || (y > ScreenRegion.bottom_y)) return; E 2	D 2	if( ( x >= ScreenRegion.left_x ) E 2I 2    if ( ( x >= ScreenRegion.left_x ) E 2	 && ( temp_x <= ScreenRegion.right_x ) 	 && ( y >= ScreenRegion.top_y ) D 2	 && ( temp_y <= ScreenRegion.bottom_y ) ) { 		Xbitblt( x, y, w, h ); 		return; 	}E 2I 2	 && ( temp_y <= ScreenRegion.bottom_y ) )      { 	Xbitblt( x, y, w, h ); 	return;       }E 2 D 2	if( x < ScreenRegion.left_x ) { 		w -= ScreenRegion.left_x - x; 		x = ScreenRegion.left_x; 	}E 2I 2    if ( x < ScreenRegion.left_x )      { 	w -= ScreenRegion.left_x - x; 	x = ScreenRegion.left_x;       }E 2 D 2	if( temp_x > ScreenRegion.right_x ) { 		w -= temp_x - ScreenRegion.right_x; 	}E 2I 2    if ( temp_x > ScreenRegion.right_x ) w -= temp_x - ScreenRegion.right_x; E 2 D 2	if( y < ScreenRegion.top_y ) { 		h -= ScreenRegion.top_y - y; 		y = ScreenRegion.top_y; 	}E 2I 2    if ( y < ScreenRegion.top_y )      { 	h -= ScreenRegion.top_y - y; 	y = ScreenRegion.top_y;       }E 2 D 2	if( temp_y > ScreenRegion.bottom_y ) { 		h -= temp_y - ScreenRegion.bottom_y; 	}E 2I 2    if ( temp_y > ScreenRegion.bottom_y ) h -= temp_y - ScreenRegion.bottom_y; E 2 D 2	if( ( w>0 ) && ( h>0 ) ) { 		Xbitblt( x, y, w, h ); 	} } /* end clipping_Xbitblt */E 2I 2    if ((w>0) && (h>0)) Xbitblt( x, y, w, h ); E 2I 2  } /* end clipping_Xbitblt *//************************************************************************//*									*//*			r e f r e s h _ X s c r e e n			*//*									*//*	Redisplay the X display completely.				*//*									*//************************************************************************/E 2refresh_Xscreen()D 2{#ifdef TRACE	printf( "TRACE: refresh_Xscreen()\n" );#endifE 2I 2  {    TPRINT(( "TRACE: refresh_Xscreen()\n" ));E 2D 2	Xbitblt( ScreenRegion.left_x		, ScreenRegion.top_y		, Display_Window.width		, Display_Window.height );E 2I 2    Xbitblt( ScreenRegion.left_x	   , ScreenRegion.top_y	   , Display_Window.width	   , Display_Window.height );E 2D 2} /* end refresh_Xscreen */E 2I 2  } /* end refresh_Xscreen */E 2E 1