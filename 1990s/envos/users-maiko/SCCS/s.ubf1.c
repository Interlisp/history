h58830s 00002/00001/00089d D 1.13 92/11/25 21:14:32 sybalsky 13 12c Fixing endif's with extra text => comment. \nes 00006/00007/00084d D 1.12 92/04/22 13:04:24 sybalsky 12 11c SGI portes 00003/00003/00088d D 1.11 92/04/21 17:26:40 sybalsky 11 10c shortening file names for DOS \nes 00015/00001/00076d D 1.10 90/06/04 18:09:27 sybalsky 10 9c reformat, copyrightes 00000/00000/00077d D 1.9 90/04/20 01:59:28 sybalsky 9 8c AIX:  shortening file names, bulk change.es 00006/00000/00071d D 1.8 90/03/27 14:29:34 sybalsky 8 7c fp rounding fixes 00001/00000/00070d D 1.7 90/03/21 12:25:52 takeshi 7 6c includes fp.hes 00000/00000/00070d D 1.6 88/10/12 18:43:54 krivacic 6 5c merge sun3/4 floating ptes 00005/00005/00065d D 1.5 88/10/12 14:45:26 krivacic 5 4c new out-of-line interfacees 00001/00000/00069d D 1.4 88/06/16 09:06:28 charnley 4 3c added missing h filees 00015/00023/00054d D 1.3 88/06/16 08:56:56 charnley 3 2c added max neg case to conversions.es 00009/00003/00068d D 1.2 88/06/09 11:21:32 charnley 2 1c have 'unbox' coerce ints to floats; used to punt.es 00071/00000/00000d D 1.1 88/06/02 11:50:17 charnley 1 0c date and time created 88/06/02 11:50:17 by charnleyeuUf e 0tTI 1D 10/* This is G-file %Z% %M% Version %I% (%G%). copyright Xerox & Fuji Xerox  */E 10I 10/* This is G-file %Z% %M% Version %I% (%G%). copyright Venue & Fuji Xerox  */E 10static char *id = "%Z% %M%	%I% %G%";D 12/*	ubf1.c */E 12I 10D 12E 12/************************************************************************//*									*/D 12/*	Copyright 1989, 1990 Venue, Fuji Xerox Co., Ltd, Xerox Corp.	*/E 12I 12/*	(C) Copyright 1989-92 Venue. All Rights Reserved.		*//*	Manufactured in the United States of America.			*/E 12/*									*/D 12/*	This file is work-product resulting from the Xerox/Venue	*//*	Agreement dated 18-August-1989 for support of Medley.		*/E 12I 12/*	The contents of this file are proprietary information 		*//*	belonging to Venue, and are provided to you under license.	*//*	They may not be further distributed or disclosed to third	*//*	parties without the specific permission of Venue.		*/E 12/*									*//************************************************************************/D 12E 12E 10#include <stdio.h>#include "lispemul.h"D 11#include "address68k.h"#include "lispglobal.h"#include "lisptypes.h"E 11I 11#include "adr68k.h"#include "lspglob.h"#include "lsptypes.h"E 11I 2#include "lispmap.h"I 4#include "arith.h"I 7#include "fp.h"E 7E 4#include "my.h"E 2/************************************************************	OP_ubfloat1  -- op 355  ==  UBFLOAT1355/0	BOX355/1	UNBOX355/2	ABS355/3	NEGATEI 3355/4	UFIXE 3***********************************************************/D 5N_OP_ubfloat1(arg, alpha, error_addr)int arg, alpha, *error_addr;E 5I 5N_OP_ubfloat1(arg, alpha)int arg, alpha;E 5{  switch (alpha) {    case 0: /* box */      {      register DLword *wordp;      DLword *createcell68k();D 3#ifdef	TRACE  printPC();  printf("TRACE: N_OP_ubfloat1() -- box\n");#endif        wordp = createcell68k(TYPE_FLOATP);        *((int *)wordp) = arg;        return(LADDR_from_68k(wordp));E 3I 3      wordp = createcell68k(TYPE_FLOATP);      *((int *)wordp) = arg;      return(LADDR_from_68k(wordp));E 3      }D 3      break;E 3    case 1: /* unbox */D 3#ifdef	TRACE  printPC();  printf("TRACE: N_OP_ubfloat1() -- unbox\n");#endifE 3D 2      if (GetTypeNumber(arg) != TYPE_FLOATP) ERROR_EXIT(error_addr);      return(*(int *)(Addr68k_from_LADDR(arg)));      break;E 2I 2      {      float dest;      int ret;D 5      N_MakeFloat(arg, dest, error_addr);E 5I 5      N_MakeFloat(arg, dest, arg);E 5      ret = *(int *)&dest;      return(ret);      }E 2    case 2: /* abs */D 3#ifdef	TRACE  printPC();  printf("TRACE: N_OP_ubfloat1() -- abs\n");#endifE 3      return(0x7FFFFFFF & arg);D 3      break;E 3    case 3: /* neg */D 3#ifdef	TRACE  printPC();  printf("TRACE: N_OP_ubfloat1() -- neg\n");#endifE 3      return(0x80000000 ^ arg);D 3      break;E 3I 3    case 4: /* ufix */      {      register float temp;      int val;      temp = *(float *)&arg;      if ( (temp > ((float) 0x7fffffff)) ||           (temp < ((float) 0x80000000)) )D 5               ERROR_EXIT(error_addr);E 5I 5               ERROR_EXIT(arg);I 8#ifdef I386      I386Reset;D 13#endif I386E 13I 13#endif /* I386 */E 13E 8E 5      val = (int)temp;I 8#ifdef I386      I386Round;#endifE 8      N_ARITH_SWITCH(val);      }E 3D 5    default: ERROR_EXIT(error_addr);E 5I 5    default: ERROR_EXIT(arg);E 5  }/* end switch */}/* end N_OP_ubfloat1() */	/* end module */E 1