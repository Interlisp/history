h54889s 00045/00030/00047d D 2.7 93/02/08 14:51:42 sybalsky 10 9c Big VM (and new CDR coding) changes for 3.0 \nes 00003/00000/00074d D 2.6 92/06/26 13:48:46 sybalsky 9 8c retrofit of 386 unix changes \nes 00004/00004/00070d D 2.5 92/04/21 17:12:41 sybalsky 8 7c shortening file names for DOS \nes 00001/00001/00073d D 2.4 90/04/20 01:34:43 sybalsky 7 6c AIX:  shortening file names, bulk change.es 00000/00000/00074d D 2.3 89/03/28 01:48:28 sybalsky 6 5c word-ptr fixeses 00001/00026/00073d D 2.2 88/05/31 19:59:15 masinter 5 4c eliminate deadbeat OP_reclaimcell codees 00000/00000/00099d D 2.1 88/05/17 09:24:18 hayata 4 3c Version up to 2.1es 00002/00002/00097d D 1.3 88/03/20 16:47:08 masinter 3 2c merge new gc code for closure cache, new reclaimes 00002/00002/00097d D 1.2 88/03/13 14:47:54 hayata 2 1c Add SCCS key id (%Z%)es 00099/00000/00000d D 1.1 88/02/24 16:56:56 hayata 1 0c date and time created 88/02/24 16:56:56 by hayataeuUtTI 1D 2/* This is G-file %M% Version %I% (%G%). copyright Xerox & Fuji Xerox  */static char *id = "%M%	%I% %G%";E 2I 2/* This is G-file %Z% %M% Version %I% (%G%). copyright Xerox & Fuji Xerox  */static char *id = "%Z% %M%	%I% %G%";E 2D 10/* *	Copyright (C) 1987 by Fuji Xerox Co., Ltd. All rights reserved. *D 5 *	Auther	:	Naoyuki Mitani	E 5I 5 *	Author	:	Naoyuki Mitani	E 5 */E 10I 10/************************************************************************//*									*//*	(C) Copyright 1989-92 Venue. All Rights Reserved.		*//*	Manufactured in the United States of America.			*//*									*//*	The contents of this file are proprietary information 		*//*	belonging to Venue, and are provided to you under license.	*//*	They may not be further distributed or disclosed to third	*//*	parties without the specific permission of Venue.		*//*									*//************************************************************************/E 10/**********************************************************************//*D 10 		File Name :	gc2.c		Desc	:	implement opcode SCAN1,SCAN2,GCRECLAIMCELLE 10I 10 		File Name:	gc2.c		Desc: implement opcode SCAN1,SCAN2,GCRECLAIMCELLE 10 D 10 					Date :		Apr 13, 1987 					Edited by :	Naoyuki MitaniE 10 		Including :	OP_scan1				OP_scan2D 7				OP_gcreclaimcellE 7I 7				OP_gcreccellE 7							*//**********************************************************************/#include "lispemul.h"#include "lispmap.h"D 8#include "lisptypes.h"#include "lispglobal.h"#include "emulglobal.h"E 8I 8#include "lsptypes.h"#include "lspglob.h"#include "emlglob.h"E 8#include "address.h"D 8#include "address68k.h"E 8I 8#include "adr68k.h"E 8I 9#ifdef GCC386#include "inlnPS2.h"D 10#endif GCC386E 10I 10#endif /* GCC386 */E 10E 9I 10E 10/**********************************************************************//*		Func Name : OP_gcscan1*//**********************************************************************/OP_gcscan1()D 10{DLword gcscan1();E 10I 10  {    DLword gcscan1();E 10#ifdef TRACED 10	printPC();	printf("TRACE: OP_gcscan1()\n");E 10I 10    printPC();    printf("TRACE: OP_gcscan1()\n");E 10#endifD 10	if((TopOfStack & 0xFF0000)==S_POSITIVE) {		TopOfStack=gcscan1(LOLOC(TopOfStack));	 }	if(TopOfStack != NIL) TopOfStack |= S_POSITIVE ; PC++;} /* OP_gcscan1 end */E 10I 10    if((TopOfStack & SEGMASK)==S_POSITIVE)      {	TopOfStack=gcscan1(LOLOC(TopOfStack));      }    if(TopOfStack != NIL) TopOfStack |= S_POSITIVE ;    PC++;   } /* OP_gcscan1 end */E 10I 10E 10/**********************************************************************//*		Func Name : OP_gcscan2*//**********************************************************************/OP_gcscan2()D 10{DLword gcscan2();E 10I 10  {    DLword gcscan2();E 10#ifdef TRACED 10	printPC();	printf("TRACE: OP_gcscan2()\n");E 10I 10    printPC();    printf("TRACE: OP_gcscan2()\n");E 10#endifD 10	if((TopOfStack & 0xFF0000)==S_POSITIVE) {		TopOfStack=gcscan2(LOLOC(TopOfStack));	 }	if(TopOfStack != NIL) TopOfStack |= S_POSITIVE ; PC++;} /* OP_gcscan2 end */E 10I 10    if((TopOfStack & SEGMASK)==S_POSITIVE)      {	TopOfStack=gcscan2(LOLOC(TopOfStack));      }    if(TopOfStack != NIL) TopOfStack |= S_POSITIVE ;    PC++;  } /* OP_gcscan2 end */E 10D 5/**********************************************************************//*		Func Name : OP_reclaimcell*//**********************************************************************/OP_reclaimcell(){DLword gcscan2();#ifdef TRACE	printPC();	printf("TRACE: OP_reclaimcell()\n");	print(TopOfStack);#endifD 3/*	ufn(0172);E 3I 3       ufn(0172);E 3D 3	return;	*/	 E 3I 3	return;		 E 3	TopOfStack = gcreclaimcell(TopOfStack);	/*check_dtd_chain(2);*/	PC++;	return;}E 5E 1