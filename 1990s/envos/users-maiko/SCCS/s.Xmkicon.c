h37338s 00036/00013/00058d D 1.4 92/10/08 16:51:32 nilsson 4 3c If no iconbitmap is given, we default to the old bitmap.es 00003/00003/00068d D 1.3 92/04/27 18:44:01 nilsson 3 2c Fix of Xdisplay deps.es 00026/00036/00045d D 1.2 92/04/23 16:32:38 nilsson 2 1c New short name regimen. Improved X commandline handling.es 00081/00000/00000d D 1.1 92/04/21 15:27:51 sybalsky 1 0c date and time created 92/04/21 15:27:51 by sybalskyeuUf e 0tTI 1/* %Z% %M% Version %I% (%G%). copyright venue & Fuji Xerox  */static char *id = "%Z% %M%	%I% %G%	(venue & Fuji Xerox)";D 2/* %Z% %M% Version %I% (%G%). copyright venue & Fuji Xerox  */static char *id = "%Z% %M%	%I% %G%	(venue & Fuji Xerox)";E 2D 2E 2/************************************************************************//*									*//*	Copyright 1989, 1990, 1991 Venue				*//*									*//*	This file was work-product resulting from the Xerox/Venue	*//*	Agreement dated 18-August-1989 for support of Medley.		*//*									*//************************************************************************/#include <stdio.h>#include <X11/Xlib.h>#include <X11/Xutil.h>#include "dbprint.h"#include "XVersion.h"#include "MyWindow.h"D 2#include "Xicon.h"E 2I 2D 4/* #include "Xicon.h" <<-- Not used any more /jarl*/E 4I 4#include "Xicon.h"E 4E 2I 4XImage IconImage;E 4D 3extern Display *Xdisplay;E 3extern MyWindow Lisp_Window;extern int Bitmap_Pad		 , Default_Depth;D 2Pixmap IconPixmap;XImage IconImage;E 2I 2extern Pixmap IconPixmap;char *iconpixmapfile[1024];E 2D 2E 2/************************************************************************//*									*//*			m a k e _ X i c o n				*//*									*//*	Make the icon for the shrunken Medley window.			*//*									*//************************************************************************/D 3make_Xicon()E 3I 3make_Xicon(display)     Display *display;E 3  {D 2    TPRINT(( "TRACE: make_Xicon()\n" ));    IconImage.width = Lisp_icon_width;    IconImage.height = Lisp_icon_height;    IconImage.xoffset = 0;    IconImage.format  = XYBitmap;    IconImage.data    = (char*) Lisp_icon;#if (defined(XV11R1) || defined(BYTESWAP))    IconImage.byte_order  = LSBFirst;#else XV11R1 | BYTESWAP    IconImage.byte_order  = MSBFirst;#endif XV11R1 | BYTESWAP    IconImage.bitmap_unit = 8;    IconImage.bitmap_pad  = Bitmap_Pad;    IconImage.depth       = 1;    IconImage.bytes_per_line = Lisp_icon_width/8;#if defined(X_ICON_IN_X_BITMAP_FORMAT)    IconImage.bitmap_bit_order = LSBFirst;#else    IconImage.bitmap_bit_order = MSBFirst;E 2I 2    unsigned int width, height;    int value, x_hot, y_hot;    char *getenv();    #ifdef TRACE D 4	printf( "In make_Xicon().\n" );E 4I 4    printf( "In make_Xicon().\n" );E 4E 2#endifD 4D 2    IconPixmap = XCreatePixmap( Xdisplay, Lisp_Window.win                                , Lisp_icon_width , Lisp_icon_height				, Default_Depth );    XPutImage( Xdisplay, IconPixmap, *(Lisp_Window.gc), &IconImage			, 0, 0, 0, 0                        , Lisp_icon_width, Lisp_icon_height );E 2I 2    if (iconpixmapfile == 0) {      mess_reset();      printf("!!CAUTION: icon pixmap fileis not set.\n");      printf("Please retry after setting icon pixmap file correctly.\n");      exit(0);			/* exit to shell */    }E 4D 3    value = XReadBitmapFile(Xdisplay, RootWindow(Xdisplay, 0),E 3I 3    value = XReadBitmapFile(display, RootWindow(display, 0),E 3			    iconpixmapfile,			    &width, &height,			    &IconPixmap,			    &x_hot, &y_hot);D 4    if (value == BitmapFileInvalid)E 4I 4    if  (value == BitmapOpenFailed) {      IconImage.width = Lisp_icon_width;      IconImage.height = Lisp_icon_height;      IconImage.xoffset = 0;      IconImage.format  = XYBitmap;      IconImage.data    = (char*) Lisp_icon;#if defined(BYTESWAP)      IconImage.byte_order  = LSBFirst;#else BYTESWAP      IconImage.byte_order  = MSBFirst;#endif BYTESWAP      IconImage.bitmap_unit = 8;      IconImage.bitmap_pad  = Bitmap_Pad;      IconImage.depth       = 1;      IconImage.bytes_per_line = Lisp_icon_width/8;#if defined(X_ICON_IN_X_BITMAP_FORMAT)      IconImage.bitmap_bit_order = LSBFirst;#else      IconImage.bitmap_bit_order = MSBFirst;#endif      IconPixmap = XCreatePixmap( display, Lisp_Window.win				 , Lisp_icon_width , Lisp_icon_height				 , Default_Depth );      XPutImage( display, IconPixmap, *(Lisp_Window.gc), &IconImage		, 0, 0, 0, 0		, Lisp_icon_width, Lisp_icon_height );    }    else if (value == BitmapFileInvalid)E 4      fprintf(stderr, "Iconpixmapfile %s contains invalid bitmap data\n", iconpixmapfile);D 4    else if (value == BitmapOpenFailed)      fprintf(stderr, "Iconpixmapfile %s could not be opened\n", iconpixmapfile);E 4    else if (value == BitmapNoMemory)      fprintf(stderr, "Not enough memory to allocate icon pixmap\n");E 2D 4  } /* end make_Xicon */E 4I 4  }				/* end make_Xicon */E 4E 1