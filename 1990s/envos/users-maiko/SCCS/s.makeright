h58364s 00007/00001/00122d D 1.16 91/03/07 19:44:58 sybalsky 16 15c Add '3' option, for making 3-byte emulators.es 00003/00000/00120d D 1.15 91/02/20 17:46:02 sybalsky 15 14c Add an option to generate 3-byte emulatorses 00000/00000/00120d D 1.14 91/01/25 17:41:07 gadener 14 13c es 00016/00003/00104d D 1.13 90/07/26 11:36:14 sybalsky 13 12c Add init as a make target.es 00007/00063/00100d D 1.12 90/07/04 04:07:15 sybalsky 12 11c Bane change:  Consolidate makefile-tail'ses 00003/00019/00160d D 1.11 90/05/09 18:51:48 fuji 11 10c Takeshi: Color emulator put into ldesingle/ldemulti.es 00007/00000/00172d D 1.10 90/04/25 00:00:38 osamu 10 9c fix bugs around ldesinglees 00001/00000/00171d D 1.9 90/04/24 20:26:12 osamu 9 8c release option supportes 00076/00018/00095d D 1.8 90/04/24 19:41:14 osamu 8 7c release option supportes 00014/00003/00099d D 1.7 90/03/15 21:30:01 sybalsky 7 6c added copyright notice, fixed some grammares 00023/00003/00079d D 1.6 90/03/01 14:37:16 osamu 6 5c Mitsunori Matsuda adds XWindow option. 'makeright x' creates lde for XWindowes 00007/00000/00075d D 1.5 90/02/15 10:46:46 takeshi 5 4c description for Cldeetheres 00027/00007/00048d D 1.4 90/02/12 11:41:43 takeshi 4 3c Add new option for color fileses 00014/00000/00041d D 1.3 90/02/07 14:32:43 osamu 3 2c add display option, available options are single, multi. c 	usage makeright [display-option] [other-options].c es 00037/00003/00004d D 1.2 90/02/07 11:17:53 osamu 2 1c makerightes 00007/00000/00000d D 1.1 88/10/18 15:45:50 bane 1 0c date and time created 88/10/18 15:45:50 by baneeuUf e 0tTI 1D 2# Sets options in magic include file# first set machine type flagsE 2I 2D 11# makeright E 11I 11# makerightD 12#  %Z% %M% Version %I% (%G%). E 12I 12D 13#  @(#) makeright Version 1.11 (5/9/90). E 13I 13#  @(#) makeright Version 1.12 (7/18/90). E 13E 12E 11I 7##***********************************************************************/##									*/##	Copyright 1989, 1990 Venue, Fuji Xerox Co., Ltd, Xerox Corp.	*/##									*/##	This file is work-product resulting from the Xerox/Venue	*/##	Agreement dated 18-August-1989 for support of Medley.		*/##									*/##***********************************************************************/#E 7# Feb. 6 1990 osamu: Add display option#		     release option does not support yet.I 8# Apr.23 1990 osamu: add release option.E 8#I 13# Jul 18 1990 JDS:  Add 'init' option for making init-loading emulators#I 16# Mar 7 1991 JDS:  Add '3' option for making 3-byte emulators.#E 16E 13# usage:  makeright [display-option] [other-option]# # example: makeright single	;  make lde for mmaped displayFB#	   makeright multi	;  make lde for cg3,cg6I 7#	   makeright x		;  make lde for X-windows#	   makeright color	;  make lde with color support in it.E 7#	   makeright multi release ; make release version of lde for cg3,cg6I 13#	   makeright init	;  make lde for loading INIT.DLINIT b/w onlyI 16#	   makeright x 3	;  make lde for X-windows, 3-byte-atom version.E 16E 13## makeright multi requires directory "maiko/${osversion}.${architecture}-multi"D 13# (ex. maiko/sunos4.spaarc-multi)E 13I 13# (ex. maiko/sunos4.sparc-multi)E 13# object files are stored there.#I 13# makeright init  requires directory "maiko/init.${architecture}#E 13I 8# Note: X11R4 environment link shared libraries. #	lde need X library. If lde links shared libraries, #	X shared libraries are needed at run time.#D 12# Hyde X shared libraries from link libraries search path.E 12I 12# Hide X shared libraries from link libraries search path.E 12setenv	LD_LIBRARY_PATH	/usr/local/lib set	RELDIR = ../RELEASE/E 8if($1 == "") then	set display=singleelseD 8	set display=$1E 8I 8	if($1 == "release") then 		switch($2)		case single:			set display = single			breaksw		case multi:			set display = multi			breakswD 11#		case color:#			set display = color#			breakswE 11		case x:			set display = x			breaksw		default:			makeright single release			makeright multi releaseD 11#			makeright color	releaseE 11			makeright x	release			exit			breaksw		endsw	else		set display=$1	endifE 8endifI 8E 8if( $#argv > 0 ) then	shiftendif I 3E 3E 2set architecture = `mach`set osversion = `osversion`I 3switch($display)I 13	case init:		set display = single		set releasename = init.${architecture}		set ldename = ldeinit		breakswE 13	case single:			set releasename = ${osversion}.${architecture}I 13		set ldename = ldesingleE 13		breaksw	case multi:			set releasename = ${osversion}.${architecture}-${display}I 13		set ldename = ldemultiE 13		breakswI 4D 11	case color:			set releasename = ${osversion}.${architecture}-${display}		breakswE 11D 6E 6I 6	case x:		set releasename = ${osversion}.${architecture}-${display}I 13		set ldename = ldexE 13		breakswE 6E 4	default:	D 7		echo "display-option: $display does not supported."E 7I 7		echo "display-option: $display is not supported."E 7		exit		breakswendswI 15D 16if ( ("$1" == "3") || ("$3" == "3)) then set releasename = ${releasename}-3E 16I 16if ( ("$1" == "3")) then  set releasename = ${releasename}-3  shiftendifE 16E 15I 9set releaseflg = 0E 9I 8D 11if( $1 == "release" ) thenE 11I 11if( "$1" == "release" ) thenE 11	set releaseflg = 1	if($display != single) then		if( !(-e usermakefile-${releasename})) then			ln usermakefile-${osversion}.${architecture} usermakefile-${releasename}		endif	endifelse	set releaseflg = 0endifset installdir = ${RELDIR}install.${osversion}.${architecture}/E 8E 3D 2set releasename = ${osversion}.${architecture}E 2I 2D 4if($display == single ) then	set releasename = ${osversion}.${architecture}else	set releasename = ${osversion}.${architecture}-${display}endifE 4I 4#if($display == single ) then#	set releasename = ${osversion}.${architecture}#else#	set releasename = ${osversion}.${architecture}-${display}#endifE 4echo start making lde for ${releasename}.E 2# then finally do the make, including the right stuffD 4(echo RELEASENAME = ${releasename}; cat makefile-header makefile-${releasename} makefile-tail) | make -f - $*E 4I 4D 12switch($display)	case single :I 10       		if (-e ../${releasename}/lde) then       			/bin/rm -f ../${releasename}/lde       		endif       		if (-e ../${releasename}/ldesingle) then       			/bin/cp -p ../${releasename}/ldesingle \			../${releasename}/lde       		endifE 10D 8		(echo RELEASENAME = ${releasename}; cat makefile-header makefile-${releasename} makefile-tail) | make -f - $*E 8I 8		(echo RELEASENAME = ${releasename}; echo INSDIR = ${installdir}; cat makefile-header makefile-${releasename} makefile-tail) | make -f - $*E 8		breaksw	case multi  :D 8		(echo RELEASENAME = ${releasename}; cat makefile-header makefile-${releasename} makefile-tail) | make -f - $*E 8I 8		(echo RELEASENAME = ${releasename}; echo INSDIR = ${installdir}; cat makefile-header makefile-${releasename} makefile-tail) | make -f - $*E 8		breakswD 11	case color :D 8		(echo RELEASENAME = ${releasename}; cat makefile-header makefile-${releasename} makefile-tail-forCOLOR) | make -f - $*E 8I 8		(echo RELEASENAME = ${releasename}; echo INSDIR = ${installdir}; cat makefile-header makefile-${releasename} makefile-tail-forCOLOR) | make -f - $*E 8		breakswE 11I 6	case x :D 8		(echo RELEASENAME = ${releasename}; cat makefile-header makefile-${releasename} makefile-tail-for-x) | make -f - $*E 8I 8		(echo RELEASENAME = ${releasename}; echo INSDIR = ${installdir}; cat makefile-header makefile-${releasename} makefile-tail-for-x) | make -f - $*E 8		breakswE 6	default:	D 7		echo "display-option: $display does not supported."E 7I 7		echo "display-option: $display is not supported."E 7		exit		breakswendswD 8E 8E 4I 2#if($status == 0) then# success making ldeD 4	mv ../${releasename}/lde ../${osversion}.${architecture}/lde${display}E 4I 4D 8	/bin/mv ../${releasename}/lde ../${osversion}.${architecture}/lde${display}E 4endifE 8I 8	if($releaseflg == 0) then		/bin/cp ../${releasename}/lde ../${osversion}.${architecture}/lde${display}E 8I 5D 11# move Cldeether onto ${releasename}D 8if($display == "color") thenif(-e ../${releasename}/Cldeether) then	echo "Move Cldeether onto ../${osversion}.${architecture}"	/bin/mv -f ../${releasename}/Cldeether ../${osversion}.${architecture}/CldeetherE 8I 8		if($display == "color") then			if(-e ../${releasename}/Cldeether) then				echo "Move Cldeether onto ../${osversion}.${architecture}"				/bin/mv -f ../${releasename}/Cldeether ../${osversion}.${architecture}/Cldeether			endif		endifE 11	endif	if ($releaseflg == 1) then#		#making release version		echo rename ${installdir}lde to lde${display}		/bin/mv ${installdir}/lde ${installdir}/lde${display} 		/bin/mv ${installdir}/lde.o ${installdir}/lde${display}.o	endifE 8endifD 8endifE 8E 5# compile ldeboot.cecho compiling ldeboot.cI 8if( $releaseflg == 0) then	set ldeoutputdir = ../${osversion}.${architecture}/else	set ldeoutputdir = ${installdir}endif  E 8D 6cc -o ../${osversion}.${architecture}/lde ../src/ldeboot.c -lpixrectE 6I 6switch($display)	case single:D 8#		cc -o ../${osversion}.${architecture}/lde ../src/ldeboot.c -lpixrect		cc -o ../${osversion}.${architecture}/lde ../src/ldeboot.c -lX11 -lpixrect -DXWINDOW -DXV11R4 -I../inc/E 8I 8#		cc -o ${ldeoutputdir}lde ../src/ldeboot.c -lpixrect		cc -o ${ldeoutputdir}lde ../src/ldeboot.c -lX11 -lpixrect -DXWINDOW -DXV11R4 -I../inc/E 8		breaksw	case multi:D 8#		cc -o ../${osversion}.${architecture}/lde ../src/ldeboot.c -lpixrect		cc -o ../${osversion}.${architecture}/lde ../src/ldeboot.c -lX11 -lpixrect -DXWINDOW -DXV11R4 -I../inc/E 8I 8#		cc -o ${ldeoutputdir}lde ../src/ldeboot.c -lpixrect		cc -o ${ldeoutputdir}lde ../src/ldeboot.c -lX11 -lpixrect -DXWINDOW -DXV11R4 -I../inc/E 8		breaksw	case x:D 8		cc -o ../${osversion}.${architecture}/lde ../src/ldeboot.c -lX11 -lpixrect -DXWINDOW -DXV11R4 -I../inc/E 8I 8		cc -o ${ldeoutputdir}lde ../src/ldeboot.c -lX11 -lpixrect -DXWINDOW -DXV11R4 -I../inc/E 8		breaksw	default:D 7		echo "display-option: $display does not supported."E 7I 7		echo "display-option: $display is not supported."E 7		exit		breakswendswI 8E 12I 12# With makefile-tail merged, this should only take ONE make command....D 13make RELEASENAME=${releasename} INSDIR=${installdir} LDENAME=lde${display} \E 13I 13make RELEASENAME=${releasename} INSDIR=${installdir} LDENAME=${ldename} \E 13			OSARCHNAME=${osversion}.${architecture} \			-f makefile-header -f makefile-${releasename} \			-f makefile-tail $*E 12E 8E 6E 2E 1