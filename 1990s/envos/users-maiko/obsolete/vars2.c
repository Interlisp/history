/* This is G-file @(#) vars2.c Version 1.2 (3/13/88). copyright Xerox & Fuji Xerox  */static char *id = "@(#) vars2.c	1.2 3/13/88";/* *	Copyright (C) 1987 by Fuji Xerox Co., Ltd. All rights reserved. * *	Auther	:	Hiroshi Hayata	 *//**************************************************		Changed	: 14-Sep-87 by Hayata***************************************************/#include	<stdio.h>#include	"lispemul.h"#include	"lispglobal.h"#include	"emulglobal.h"#include	"stack.h"/**************************************************OP_pvar0_,OP_pvar1_,OP_pvar2_,OP_pvar3_,OP_pvar4_,OP_pvar5_,OP_pvar6_	Entry:	PVARn_	opcode[0130-0136]***************************************************/OP_pvar0_(){#ifdef	TRACE	printPC();	printf("TRACE: OP_pvar0_() ");#endif	*((int *)PVar) = TopOfStack;	PC++;}OP_pvar1_(){#ifdef	TRACE	printPC();	printf("TRACE: OP_pvar1_() ");#endif	*((int *)PVar + 1) = TopOfStack;	PC++;}OP_pvar2_(){#ifdef	TRACE	printPC();	printf("TRACE: OP_pvar2_() ");#endif	*((int *)PVar + 2) = TopOfStack;	PC++;}OP_pvar3_(){#ifdef	TRACE	printPC();	printf("TRACE: OP_pvar3_() ");#endif	*((int *)PVar + 3) = TopOfStack;	PC++;}OP_pvar4_(){#ifdef	TRACE	printPC();	printf("TRACE: OP_pvar4_() ");#endif	*((int *)PVar + 4) = TopOfStack;	PC++;}OP_pvar5_(){#ifdef	TRACE	printPC();	printf("TRACE: OP_pvar5_() ");#endif	*((int *)PVar + 5) = TopOfStack;	PC++;}OP_pvar6_(){#ifdef	TRACE	printPC();	printf("TRACE: OP_pvar6_() ");#endif	*((int *)PVar + 6) = TopOfStack;	PC++;}/**************************************************OP_pvarx_	Entry:	PVARX_	opcode[0137]***************************************************/OP_pvarx_(){register short	n;#ifdef	TRACE	printPC();	printf("TRACE: OP_pvarx_() ");#endif	n = 0xFF & (*(++PC));	*((int *)(PVar + n)) = TopOfStack;	PC++;}/**************************************************OP_ivarx_	Entry:	IVARX_	opcode[0142]		1.set the value of TopOfStack to IVAR slot.	2.PC increment.***************************************************/OP_ivarx_(){#ifdef	TRACE	printPC();	printf("TRACE: OP_ivarx_()\n");#endif	*((int *)(IVar + (0xFF & (*(++PC))))) = TopOfStack;	PC++;}/**************************************************OP_storen	Entry:	STORE.N_	opcode[074]		1.set the value of TopOfStack to the address of (CurrentStackPTR - alpha).	2.PC increment.***************************************************/OP_storen(){register DLword	*pslot;#ifdef	TRACE	printPC();	printf("TRACE: OP_storen()\n");#endif/*CSP	pslot = CurrentStackPTR - ((0xFF & (*(++PC))) + 1);	*/	pslot = CurrentStackPTR - ((0xFF & (*(++PC))));	*((int *)pslot) = TopOfStack;	PC++;}/**************************************************OP_copyn	Entry:	COPY.N	opcode[075]		1.Push CurrentStack.	2.set the value of (CurrentStackPTR - alpha) to TopOfStack.	3.PC increment.***************************************************/OP_copyn(){register DLword	*pslot;#ifdef	TRACE	printPC();	printf("TRACE: OP_copyn()\n");#endif	PushCStack;/*CSP	pslot = CurrentStackPTR - ((0xFF & (*(++PC))) + 1);	 */	pslot = CurrentStackPTR - ((0xFF & (*(++PC))));	TopOfStack = GetLongWord(pslot);	PC++;	if(StackCheck)		StackOverflow;}/**************************************************OP_gvar	Entry:	GVAR		opcode[0140]		1.save the value of TopOfStack to the address of CurrentStackPTR.	2.increment CurrentStackPTR by 2.	3.set the value of [VALSPACE, (alpha, beta)*2] to TopOfStack.	3.increment PC by 3.***************************************************/OP_gvar(){register unsigned int	offset;	/* offset of argued slot: word offset from Valspace */register DLword	alpha;	/* 1st argument of opcode */register DLword	beta;	/* 2nd argument of opcode */#ifdef	TRACE	printPC();	printf("TRACE: OP_gvar()\n");#endif	PushCStack;	alpha = 0xFF & (*(++PC));	beta = 0xFF & (*(++PC));	offset = (( alpha<<8 ) | beta ) << 1;	TopOfStack = GetLongWord( Valspace + offset );	PC++; 	if (StackCheck)		StackOverflow;}/**************************************************OP_spardn	Entry:	PVARd_		opcode[0270-0276]***************************************************/OP_spard0(){#ifdef	TRACE	printPC();	printf("TRACE: OP_spard0()\n");#endif	*((int *)PVar) = TopOfStack;	PopCStack;	PC++;}OP_spard1(){#ifdef	TRACE	printPC();	printf("TRACE: OP_spard1()\n");#endif	*((int *)PVar + 1) = TopOfStack;	PopCStack;	PC++;}OP_spard2(){#ifdef	TRACE	printPC();	printf("TRACE: OP_spard2()\n");#endif	*((int *)PVar + 2) = TopOfStack;	PopCStack;	PC++;}OP_spard3(){#ifdef	TRACE	printPC();	printf("TRACE: OP_spard3()\n");#endif	*((int *)PVar + 3) = TopOfStack;	PopCStack;	PC++;}OP_spard4(){#ifdef	TRACE	printPC();	printf("TRACE: OP_spard4()\n");#endif	*((int *)PVar + 4) = TopOfStack;	PopCStack;	PC++;}OP_spard5(){#ifdef	TRACE	printPC();	printf("TRACE: OP_spard5()\n");#endif	*((int *)PVar + 5) = TopOfStack;	PopCStack;		/* pop the top of Evaluation Stack to TopOfStack */	PC++;}OP_spard6(){#ifdef	TRACE	printPC();	printf("TRACE: OP_spard6()\n");#endif	*((int *)PVar + 6) = TopOfStack;	PopCStack;		/* pop the top of Evaluation Stack to TopOfStack */	PC++;}/**************************************************OP_pop	Entry:	POP		opcode[0277]****************************************************/OP_pop(){#ifdef	TRACE	printPC();	printf("TRACE: OP_pop()\n");#endif/*CSP	--((int *)CurrentStackPTR);	TopOfStack = *((int *)(CurrentStackPTR+1));	*/	TopOfStack = *((int *)CurrentStackPTR);	CurrentStackPTR -= 2;	PC++;}/**************************************************OP_popn	Entry:	POP.N		opcode[0300]		1.decrement CurrentStackPTR by 2 or alpha*2 .	2.set the value of CurrentStackPTR address to TopOfStack.	3.increment PC by 1.****************************************************/OP_popn(){register int	dec;		/* word offset number to decrement CurrentStackPTR */#ifdef	TRACE	printPC();	printf("TRACE: OP_pop()\n");#endif/*CSP	dec = ( (0xFF & (*(++PC))) << 1 ) + 2;	CurrentStackPTR -= dec;	TopOfStack = *((int *)(CurrentStackPTR+1));	*/	dec = (0xFF & (*(++PC))) + 1;	(int *)CurrentStackPTR -= dec;	TopOfStack = *((int *)(CurrentStackPTR + 2));	PC++;}