/* This is G-file @(#) equal.c Version 2.2 (5/27/88). copyright Xerox & Fuji Xerox  */static char *id = "@(#) equal.c	2.2 5/27/88";/* *	Copyright (C) 1987 by Fuji Xerox Co., Ltd. All rights reserved. * *	Auther :  Takeshi Shimizu * *//**********************************************************************//* 		File Name :	equal.c		Desc	:	implement opcode EQ  					Date :		Apr 13, 1987 					Edited by :	Naoyuki Mitani 		Including :	OP_eq				OP_eqlop							*//**********************************************************************/#include "lispemul.h"#include "lispmap.h"#include "lisptypes.h"#include "lispglobal.h"#include "emulglobal.h"#include "address68k.h"#include "arith.h"#ifdef C_ONLY/**********************************************************************//*		Func name :	OP_eq				Pop the contents of the current evaluation				stack and compare it with previous contents				of TOS . Returns atomT or atomNIL .					Date :		Apr 13, 1987					Edited by :	Naoyuki Mitani*//**********************************************************************/OP_eq(){ register LispPTR temp;#ifdef TRACE	printPC();	printf("TRACE: OP_eq()\n");#endif temp = TopOfStack; PopCStack; if (temp == TopOfStack)	TopOfStack = ATOM_T; else	TopOfStack = NIL_PTR; PC++;} /* OP-eq end *//**********************************************************************//*		Func name :	OP_eqlop			This OPCODE used by both EQL(72Q) and EQUAL(364Q)			Pop the contents of the current evaluation			stack and compare it with previous contents			of TOS . Returns atomT or atomNIL .					Date :		JUL 21, 1987					Edited by :	take*//**********************************************************************/OP_eqlop(){  register LispPTR stkarg ;  register int num1,num2;  register int type1,type2;  LispPTR *fobjptr1,*fobjptr2;  stkarg= *((LispPTR *)(CurrentStackPTR )); /* get arg1 on cstk */  if(stkarg == TopOfStack) goto TRET;  else if(((TopOfStack & 0xFF0000) == S_POSITIVE) ||	((TopOfStack & 0xFF0000) == S_NEGATIVE) ||	((TopOfStack & 0xFF0000) == ATOMS_OFFSET) ||	((TopOfStack & 0xFF0000) == ATOMS_OFFSET) ) 	  goto NILRET;  type1=GetTypeNumber(TopOfStack);  type2=GetTypeNumber(stkarg);  if((type1==TYPE_FIXP) && (type2==TYPE_FIXP))   {	GetNumber(TopOfStack , num1);	GetNumber(stkarg , num2); /* if it calls UFN,return*/   	if(num1==num2)		goto TRET;	else goto NILRET ;   } else if ((type1==TYPE_FLOATP)&&(type2==TYPE_FLOATP))	{		fobjptr1=(LispPTR *)Addr68k_from_LADDR(TopOfStack);		fobjptr2=(LispPTR *)Addr68k_from_LADDR(stkarg);		if(*fobjptr1== *fobjptr2)			goto TRET;		else  goto NILRET;	}	else 	{		ufn(Get_BYTE(PC));		return;	} TRET:	TopOfStack = ATOM_T;	CurrentStackPTR -= 2;	PC++;	return; NILRET: TopOfStack = NIL;	CurrentStackPTR -= 2;	PC++;	return;} /* OP_eqlop end */#else/**********************************************************************//*		Func name :	N_OP_eqlop			This OPCODE used by both EQL(72Q) and EQUAL(364Q)			Pop the contents of the current evaluation			stack and compare it with previous contents			of TOS . Returns atomT or atomNIL .					Date :		March 21, 198					Edited by :	bk*//**********************************************************************/int N_OP_eqlop(tos_m_1, tos, error_addr)	register LispPTR tos_m_1, tos;	int * error_addr;{  register int num1,num2;  register int type1,type2;  LispPTR *fobjptr1,*fobjptr2;  if(tos_m_1 == tos) goto TRET;  else {register LispPTR tos_type = (tos & 0xff0000);	if((tos_type == S_POSITIVE) ||	(tos_type == S_NEGATIVE) ||	(tos_type == ATOMS_OFFSET) ) 	  goto NILRET;	}  type1=GetTypeNumber(tos);  type2=GetTypeNumber(tos_m_1);  if((type1==TYPE_FIXP) && (type2==TYPE_FIXP))   {	N_GETNUMBER(tos , num1, doerror);	N_GETNUMBER(tos_m_1 , num2, doerror); /* if it calls UFN,return*/   	if(num1==num2)		goto TRET;	else goto NILRET ;   } else if ((type1==TYPE_FLOATP)&&(type2==TYPE_FLOATP))	{		fobjptr1=(LispPTR *)Addr68k_from_LADDR(tos);		fobjptr2=(LispPTR *)Addr68k_from_LADDR(tos_m_1);		if(*fobjptr1== *fobjptr2)			goto TRET;		else  goto NILRET;	}	else 	{doerror:	ERROR_EXIT(error_addr);	} TRET:	return(ATOM_T); NILRET: return(NIL_PTR);} /* N_OP_eqlop end */#endif