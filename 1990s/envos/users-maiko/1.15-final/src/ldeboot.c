/* @(#) ldeboot.c Version 1.3 (3/1/90). copyright envos & Fuji Xerox  */static char *id = "@(#) ldeboot.c	1.3 3/1/90		(envos & Fuji Xerox)";	/*  (c) CopyRight Fuji Xerox 1989  Maiko Project *//* FILE: ldeboot.c REL.1 SCCSID:1.1  *//* SCCS file: /envos/medley/fuji/1.1.3/emul/SCCS/s.ldeboot.c  */#include <stdio.h>#include <ctype.h>#include <sys/ioctl.h>#include <sun/fbio.h>#include <fcntl.h>#include <errno.h>#ifdef XWINDOW#include <strings.h>#include <X11/Xlib.h>#include <X11/Xutil.h>#include "XVersion.h"#define LDEX "ldex"extern char *getenv();#endif XWINDOW#define LDEMONO "ldesingle"#define LDECOLOR "ldemulti"#define FBTYPE_SUNFAST_COLOR 12char filetorun[30];main(argc, argv, envp) int argc; char **argv, **envp;{	char	Earg[30], Ename[30], **newargv;	int i;	struct fbtype my_screen;	int FrameBufferFd;	struct	fbinfo FB_info;	struct fbgattr FBattr;/* Kickstart program for the Lisp Development Environment (LDE).	Display Device       emulator	CG3, CG6             lde.multi	BW2, CG2, CG4, CG9   lde.single	         FB-TYPE       REAL-TYPE 	BW2      2             x	CG2      3             3	CG3      8             6	CG4      2             8 	CG6      8             12	CG9(GP1) 4             4    ;gpconfig -f -b	CG9(GP1) 2            13    ;gpconfig gpone0 -f -b cgtwo0 	                            ;We assume This config for GXP model*/#ifdef XWINDOW/* If X-Server exists on the host specified in -display option  or environment variable DISPLAY, ldex is started. Othewise   ldesingle or ldemulti.*/{ char *Display_Name = NULL ;Display *Xdisplay;int i  , option;char *pos;for( i=1; i<argc; i++ ) {#ifdef XV11R1  pos = index( argv[i], ':' );  if(pos != NULL) {    Display_Name = argv[i];    continue;  }#endif XV11R1#ifndef XV11R1  if( (strcmp(argv[i], "-d") == 0 )   || (strcmp(argv[i], "-display") == 0 ) ) {    pos = index( argv[++i], ':' );    if(pos != NULL) {      Display_Name = argv[i];    }    continue;  }#endif XV11R1} /*end for() */if( (Xdisplay = XOpenDisplay( Display_Name )) != NULL ) {  /* success to connect X-server */  XCloseDisplay( Xdisplay );  strcpy(filetorun, LDEX);  argv[0] = filetorun;  execvp(filetorun, argv);  perror(filetorun);  exit(1);} else { /* failed to connect X-server */#define NAME_LEN 100  char host_name[NAME_LEN];  gethostname( host_name, NAME_LEN );  if( Display_Name == NULL ) {    if( (Display_Name = getenv("DISPLAY")) != NULL ) {      if( (strncmp( Display_Name                  , host_name                  , strlen( host_name )) ) == NULL ) {        fprintf( stderr, "ldeboot: can't find X-Server\n" );        exit( -1 );      } /* end if */    } /* end if */  } else {    fprintf( stderr, "ldeboot: can't find X-Server\n" );    exit( -1 );  } /* end if */} /* end if */}#endif XWINDOWif( (FrameBufferFd = open( "/dev/fb", O_RDWR )) < 0){	fprintf( stderr, "ldeboot: can't open FrameBuffer\n");	exit( -1 );}if (ioctl(FrameBufferFd, FBIOGTYPE, &my_screen) <0) {	perror("initdisplay0:");}if( my_screen.fb_type == FBTYPE_SUN4COLOR ){  /*  cg3 or cg6 */  if(ioctl(FrameBufferFd,FBIOGATTR,&FBattr) >= 0){    if( FBattr.real_type == FBTYPE_SUN3COLOR ||     /* cg3 */        FBattr.real_type == FBTYPE_SUNFAST_COLOR ){ /* cg6 */      strcpy(filetorun, LDECOLOR);    }  }else{ /* if( ioctl... */    perror("lde: This Display Model does not supported\n");  }}else if( my_screen.fb_type == FBTYPE_SUN2BW  ){ /* bw2, cg4 or cg9  */    strcpy(filetorun, LDEMONO);}else if( my_screen.fb_type == FBTYPE_SUN2COLOR  ){ /* cg2  */    strcpy(filetorun, LDEMONO);}else{     perror("lde: This Display Model does not supported\n");}; /* endif( my_screen... */ close(FrameBufferFd);/* start ldemono or ldecolor */argv[0] = filetorun;	/* or whatever... *//* then execve the LDE executable */ execvp(filetorun, argv);perror(filetorun);exit(1);}