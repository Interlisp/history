/* @(#) tosretmacro.h Version 2.15 (3/24/89). copyright envos & Fuji Xerox  */#ifdef NATIVETRAN#define RETD6 SaveD6 = 0x100#define RET_CHECK_NATIVE(x) if(x ->native) { RET_TO_NATIVE; }#else#define RETD6#define RET_CHECK_NATIVE(x)#endif#if (defined(SUN3_OS3_OR_OS4_IL) &&  !(defined(NOASMFNCALL)) )#define OPRETURN							\{	opreturn();							\	EXT; if(slowreturn()) goto stackoverflow_help; RET;		\	Irq_Stk_Check = STK_END_COMPUTE(EndSTKP,FuncObj);		\	if (((int)(CSTKPTR) > Irq_Stk_Check) || (Irq_Stk_End <= 0))	\			{ RETD6; goto check_interrupt;	}		\	Irq_Stk_End = (int) EndSTKP;					\	RET_CHECK_NATIVE(BCE_CURRENTFX);				\ }#else#define OPRETURN	{						\ register struct frameex2 *returnFX ;					\ register int alink;							\ alink = ((struct frameex2 *) BCE_CURRENTFX)->alink;			\ if (alink & 1) { EXT; if(slowreturn()) goto stackoverflow_help; RET;	\	Irq_Stk_Check = STK_END_COMPUTE(EndSTKP,FuncObj);		\	if (((int)(CSTKPTR) > Irq_Stk_Check) || (Irq_Stk_End <= 0))	\			{ RETD6; goto check_interrupt;	}		\	Irq_Stk_End = (int) EndSTKP;					\	RET_CHECK_NATIVE(BCE_CURRENTFX);				\	goto retxit;							\	};								\ CSTKPTR = (LispPTR *) IVAR;						\ returnFX = (struct  frameex2 *)					\	((DLword *)							\	    (PVAR = (LispPTR *) Addr68k_from_StkOffset(alink))		\	    - FRAMESIZE);						\ IVAR = (LispPTR *) Addr68k_from_StkOffset(GETWORD((DLword *)returnFX -1));	\	/* Get PC from Retunee's pc slot in FX */			\ PCMACL = returnFX->pc  + (ByteCode *)					\	(FuncObj = (struct fnhead *)					\	Addr68k_from_LADDR(SWAP_WORDS(returnFX->fnheader) & 0x0ffffff)) + 1;\ Irq_Stk_Check = STK_END_COMPUTE(EndSTKP,FuncObj);			\ if (((int)(CSTKPTR) > Irq_Stk_Check) || (Irq_Stk_End <= 0))		\		{ RETD6; goto check_interrupt;	}		\ Irq_Stk_End = (int) EndSTKP;						\ RET_CHECK_NATIVE(returnFX);						\retxit:	 {}								\} /* OPRETURN end */#endif