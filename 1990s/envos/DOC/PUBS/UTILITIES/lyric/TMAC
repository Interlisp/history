(FILECREATED "30-May-86 10:37:54" {ERIS}<SANNELLA>LISP>TMAC.;3 6338         changes to:  (FNS TMAC.WHENSELECTEDFN TMAC.ADD.MENU TMAC TMAC.DELETE.MENU)		   (VARS TMACCOMS)      previous date: "29-May-86 17:58:07" {ERIS}<SANNELLA>LISP>TMAC.;1)(* Copyright (c) 1986 by Xerox Corporation. All rights reserved.)(PRETTYCOMPRINT TMACCOMS)(RPAQQ TMACCOMS ((FNS TMAC TMAC.ADD.MENU TMAC.DELETE.MENU TMAC.WHENSELECTEDFN)))(DEFINEQ(TMAC  [LAMBDA NIL                                                (* mjs "29-May-86 17:57")    (TMAC.ADD.MENU])(TMAC.ADD.MENU  [LAMBDA (INSERTITEMS WINDOW.OR.REGION)                     (* mjs "29-May-86 18:11")    (PROG (NEWINSERTITEMS MENU MENUW)	    (SETQ MENU (create MENU				   ITEMS _(APPEND INSERTITEMS (QUOTE ((">>>add<<<" ADD 								    "Add a new item to this menu")))						    (if INSERTITEMS							then (QUOTE ((">>>del<<<" DELETE 								  "Delete an item from this menu")))						      else NIL))				   WHENSELECTEDFN _(FUNCTION TMAC.WHENSELECTEDFN)				   TITLE _ "TMAC Menu"))	    (PUTMENUPROP MENU (QUOTE TMAC.INSERTITEMS)			   INSERTITEMS)	    (if (WINDOWP WINDOW.OR.REGION)		then (SHOULDNT)		       (ATTACHMENU MENU WINDOW.OR.REGION (QUOTE RIGHT)				     (QUOTE TOP))	      else (ADDMENU MENU NIL (if (REGIONP WINDOW.OR.REGION)					     then (CREATEPOSITION (fetch (REGION LEFT)									 of WINDOW.OR.REGION)								      (fetch (REGION BOTTOM)									 of WINDOW.OR.REGION))					   else (PROMPTPRINT 						   "Please specify the position of the TMAC menu")						  (GETPOSITION])(TMAC.DELETE.MENU  [LAMBDA (MENU)                                           (* mjs "29-May-86 17:11")    (PROG* ((MENUW (WFROMMENU MENU))	    (MENUWMAINW (MAINWINDOW MENUW)))           (if (NEQ MENUW MENUWMAINW)	       then (DETACHWINDOW MENUW))           (CLOSEW MENUW])(TMAC.WHENSELECTEDFN  [LAMBDA (ITEM MENU MOUSEKEY)                               (* mjs "30-May-86 10:35")    (PROG* [(MENUW (WFROMMENU MENU))	    (MENUWMAINW (MAINWINDOW MENUW))	    (MENUINSERTITEMS (GETMENUPROP MENU (QUOTE TMAC.INSERTITEMS]           (SELECTQ (CADR ITEM)		      (CLOSEW (TMAC.DELETE.MENU MENU))		      [ADD (PROG (PRESTR POSTSTR NAMSTR)			           (CLEARW PROMPTWINDOW)			           (SETQ PRESTR (if (PROMPTFORWORD 							    "String to insert before selection: "									 NIL NIL PROMPTWINDOW NIL									 (QUOTE TTY)									 (CHARCODE (EOL)))						    else ""))			           (CLEARW PROMPTWINDOW)			           (SETQ POSTSTR (if (PROMPTFORWORD 							     "String to insert after selection: "									  NIL NIL PROMPTWINDOW NIL									  (QUOTE TTY)									  (CHARCODE (EOL)))						     else ""))			           (CLEARW PROMPTWINDOW)			           (SETQ NAMSTR (if (PROMPTFORWORD "Name in TMAC menu: "									 (if (LESSP (NCHARS											  PRESTR)											15)									     then PRESTR									   else									    (CONCAT (SUBSTRING											PRESTR 1 12)										      "..."))									 NIL PROMPTWINDOW NIL									 (QUOTE TTY)									 (CHARCODE (EOL)))						    else (GENSYM)))			           (push MENUINSERTITEMS					   (LIST NAMSTR (CONS PRESTR POSTSTR)						   (CONCAT "Inserts %"" PRESTR "%" before"							     (if (ZEROP (NCHARS POSTSTR))								 then ""							       else (CONCAT " and %"" POSTSTR 										"%" after"))							     " the current selection")))			           (TMAC.DELETE.MENU MENU)			           (TMAC.ADD.MENU MENUINSERTITEMS (if (NEQ MENUW MENUWMAINW)									then MENUWMAINW								      else (WINDOWPROP									       MENUW									       (QUOTE REGION]		      [DELETE (if MENUINSERTITEMS				  then (PROG (ITEMTODELETE)					         (CLEARW PROMPTWINDOW)					         (PROMPTPRINT "Select the item to be deleted")					         (SETQ ITEMTODELETE						   (MENU (create MENU								     ITEMS _(for X in 										  MENUINSERTITEMS									       collect										(CAR X))								     TITLE _ "Select one")))					         (if ITEMTODELETE						     then (SETQ MENUINSERTITEMS							      (for X in MENUINSERTITEMS								 unless (EQ ITEMTODELETE										(CAR X))								 collect X))							    (TMAC.DELETE.MENU MENU)							    (TMAC.ADD.MENU							      MENUINSERTITEMS							      (if (NEQ MENUW MENUWMAINW)								  then MENUWMAINW								else (WINDOWPROP MENUW										     (QUOTE REGION]		      (PROG ([DESTW (if (NEQ MENUW MENUWMAINW)					  then             (* if menu is attached to a different window, use the 							     main window)						 MENUWMAINW					else               (* if menu is not attached to any window, use the 							     current tty process)					       (PROCESSPROP (TTY.PROCESS)							      (QUOTE WINDOW]			       (BEFORETEXT (CAR (CADR ITEM)))			       (AFTERTEXT (CDR (CADR ITEM)))			       TEXTSTREAM)			      (if (SETQ TEXTSTREAM (WINDOWPROP DESTW (QUOTE TEXTSTREAM)))				  then (PROG [(FIRSTCHAR (fetch (SELECTION CH#)								of (TEDIT.GETSEL TEXTSTREAM)))						  (AFTERLASTCHAR (fetch (SELECTION CHLIM)								    of (TEDIT.GETSEL TEXTSTREAM)))						  (SELPOINT (fetch (SELECTION POINT)							       of (TEDIT.GETSEL TEXTSTREAM)))						  (SELLEN (fetch (SELECTION DCH)							     of (TEDIT.GETSEL TEXTSTREAM]					         (TEDIT.INSERT TEXTSTREAM AFTERTEXT AFTERLASTCHAR)					         (TEDIT.INSERT TEXTSTREAM BEFORETEXT FIRSTCHAR)					         (TEDIT.SETSEL TEXTSTREAM FIRSTCHAR								 (IPLUS SELLEN (NCHARS BEFORETEXT)									  (NCHARS AFTERTEXT))								 SELPOINT))				else (BKSYSBUF (CONCAT BEFORETEXT AFTERTEXT]))(PUTPROPS TMAC COPYRIGHT ("Xerox Corporation" 1986))(DECLARE: DONTCOPY  (FILEMAP (NIL (434 6263 (TMAC 444 . 569) (TMAC.ADD.MENU 571 . 1718) (TMAC.DELETE.MENU 1720 . 2037) (TMAC.WHENSELECTEDFN 2039 . 6261)))))STOP