(DEFINE-FILE-INFO READTABLE "XCL" PACKAGE (DEFPACKAGE "BENCHMARKS"))
(IL:FILECREATED "21-Oct-91 23:41:38" ("compiled on " 
IL:|{DSK}<usr>local>lde>lispcore>gabriel>Benchmarks>IO-BENCHMARKS.;3|) "27-Aug-91 19:40:51" 
IL:|bcompl'd| IL:|in| "Medley 28-Aug-91 ..." IL:|dated| "28-Aug-91 09:16:07")
(IL:FILECREATED "19-Apr-90 18:48:13" 
IL:|{DSK}/usr/local/lde/lispcore/gabriel/Benchmarks/IO-BENCHMARKS.;3| 16088 IL:|changes| IL:|to:| (
IL:VARS IL:IO-BENCHMARKSCOMS) IL:|previous| IL:|date:| "20-Jul-88 19:16:05" 
IL:|{DSK}/usr/local/lde/lispcore/gabriel/Benchmarks/IO-BENCHMARKS.;1|)
(IL:PRETTYCOMPRINT IL:IO-BENCHMARKSCOMS)
(IL:RPAQQ IL:IO-BENCHMARKSCOMS ((IL:* IL:|;;| "Benchmarks for various I/O functions in the system.") (
IL:COMS (IL:* IL:|;;| "Gabriel I/O Benchmarks:") (IL:COMS (IL:* IL:\; "FPRINT") (GABRIEL::TIMERS 
GABRIEL::FPRINT) (IL:FUNCTIONS GABRIEL::FPRINT GABRIEL::FPRINT-INIT GABRIEL::FPRINT-INIT1) (IL:VARIABLES
 GABRIEL::FPRINT-TEST-FILE GABRIEL::TEST-ATOMS GABRIEL::TEST-PATTERN)) (IL:COMS (IL:* IL:\; 
"FREAD (MUST be run after FPRINT)") (GABRIEL::TIMERS GABRIEL::FREAD) (IL:FUNCTIONS GABRIEL::FREAD)) (
IL:COMS (IL:* IL:\; "TPRINT") (GABRIEL::TIMERS GABRIEL::TPRINT) (IL:FUNCTIONS GABRIEL::SETUP-TPRINT 
GABRIEL::TPRINT-INIT GABRIEL::TPRINT-INIT1)) (IL:VARIABLES GABRIEL::TEST-ATOMS-TPRINT 
GABRIEL::*TPRINT-WINDOW* GABRIEL::TEST-PATTERN-TPRINT)) (IL:COMS (IL:* IL:|;;| 
"Lists of benchmark names, for use with RUN-BENCHMARKS:") (IL:VARIABLES GABRIEL::*IO-BENCHMARKS* 
GABRIEL::*MAIKO-IO-BENCHMARKS*) (IL:VARS (IL:*1186-IO-TIMERS* (QUOTE (IL:FLOPPY-FORMATTING 
IL:FLOPPY-WRITE IL:FLOPPY-READ))))) (IL:COMS (IL:* IL:|;;| "Floating-point I/O") (IL:FUNCTIONS 
READ-FLOATS) (GABRIEL::TIMERS IL:READ-FLOAT IL:PRINT-FLOAT)) (IL:COMS (IL:* IL:|;;| 
"Printing to the terminal") (IL:FUNCTIONS PRINT-TO-TERMINAL) (GABRIEL::TIMERS IL:TERMINAL-PRINTING)) (
IL:COMS (IL:* IL:|;;| "Floppy disk performance") (GABRIEL::TIMERS IL:FLOPPY-FORMATTING IL:FLOPPY-WRITE
 IL:FLOPPY-READ)) (IL:COMS (IL:* IL:|;;| "Symbol reading") (IL:FUNCTIONS IL:READ-EXISTING-SYMBOLS) (
GABRIEL::TIMERS IL:READ-EXISTING-SYMBOLS)) (IL:COMS (IL:* IL:|;;| 
"File-system-specific performance bottleneck diagnosis") (IL:FUNCTIONS IL:WRITE-TO-COREFILE 
IL:WRITE-TO-FILE IL:READ-FROM-FILE) (GABRIEL::TIMERS IL:READ-DSK IL:READ-UFS IL:READ-CORE IL:WRITE-DSK
 IL:WRITE-UFS IL:WRITE-CORE)) (IL:COMS (IL:* IL:|;;| "Set up for this series of tests") (IL:P (
IL:COPYFILE "{DSK}<USR>LOCAL>LDE>LISPCORE>GABRIEL>AUX>2000-FLOATS-TO-READ" "{CORE}FLOATS") (IL:COPYFILE
 "{DSK}<USR>LOCAL>LDE>LISPCORE>GABRIEL>AUX>1000-SYMBOLS" "{CORE}1000-SYMBOLS"))) (IL:PROP (
IL:MAKEFILE-ENVIRONMENT IL:FILETYPE) IL:IO-BENCHMARKS)))
(GABRIEL::DEFINE-TIMER GABRIEL::FPRINT "FPrint" (GABRIEL::FPRINT))
(DEFUN GABRIEL::FPRINT NIL (LET ((GABRIEL::F (OPEN GABRIEL::FPRINT-TEST-FILE :DIRECTION :OUTPUT 
:IF-EXISTS :SUPERSEDE))) (PRINT GABRIEL::TEST-PATTERN GABRIEL::F) (CLOSE GABRIEL::F)))
(DEFUN GABRIEL::FPRINT-INIT (GABRIEL::M GABRIEL::N GABRIEL::ATOMS) (LET ((GABRIEL::ATOMS (COPY-TREE 
GABRIEL::ATOMS))) (DO ((GABRIEL::A GABRIEL::ATOMS (CDR GABRIEL::A))) ((NULL (CDR GABRIEL::A)) (RPLACD 
GABRIEL::A GABRIEL::ATOMS))) (GABRIEL::FPRINT-INIT1 GABRIEL::M GABRIEL::N GABRIEL::ATOMS)))
(DEFUN GABRIEL::FPRINT-INIT1 (GABRIEL::M GABRIEL::N GABRIEL::ATOMS) (COND ((= GABRIEL::M 0) (POP 
GABRIEL::ATOMS)) (T (DO ((GABRIEL::I GABRIEL::N (- GABRIEL::I 2)) (GABRIEL::A NIL)) ((< GABRIEL::I 1) 
GABRIEL::A) (PUSH (POP GABRIEL::ATOMS) GABRIEL::A) (PUSH (GABRIEL::FPRINT-INIT1 (1- GABRIEL::M) GABRIEL::N
 GABRIEL::ATOMS) GABRIEL::A)))))
(DEFPARAMETER GABRIEL::FPRINT-TEST-FILE (IL:* IL:|;;| 
"JRB - making this {dsk}fprint.tst rather than {dsk}<lispfiles>fprint.tst so that Maiko will like it")
 "{dsk}fprint.tst")
(DEFVAR GABRIEL::TEST-ATOMS (QUOTE (GABRIEL::ABCDEF12 GABRIEL::CDEFGH23 GABRIEL::EFGHIJ34 GABRIEL::GHIJKL45
 GABRIEL::IJKLMN56 GABRIEL::KLMNOP67 GABRIEL::MNOPQR78 GABRIEL::OPQRST89 GABRIEL::QRSTUV90 GABRIEL::STUVWX01
 GABRIEL::UVWXYZ12 GABRIEL::WXYZAB23 GABRIEL::XYZABC34 GABRIEL::123456AB GABRIEL::234567BC GABRIEL::345678CD
 GABRIEL::456789DE GABRIEL::567890EF GABRIEL::678901FG GABRIEL::789012GH GABRIEL::890123HI)))
(DEFVAR GABRIEL::TEST-PATTERN (GABRIEL::FPRINT-INIT 6 6 GABRIEL::TEST-ATOMS))
(GABRIEL::DEFINE-TIMER GABRIEL::FREAD "FRead" (GABRIEL::FREAD))
(DEFUN GABRIEL::FREAD NIL (LET ((GABRIEL::F (OPEN GABRIEL::FPRINT-TEST-FILE))) (READ GABRIEL::F) (
CLOSE GABRIEL::F)))
(GABRIEL::DEFINE-TIMER (GABRIEL::TPRINT (:SETUP (SETQ GABRIEL::*TPRINT-WINDOW* (GABRIEL::SETUP-TPRINT)
)) (:AFTER-EVERY (IL:DSPRESET GABRIEL::*TPRINT-WINDOW*)) (:AFTER (IL:CLOSEW GABRIEL::*TPRINT-WINDOW*))
) "TPrint" (PRINT GABRIEL::TEST-PATTERN-TPRINT GABRIEL::*TPRINT-WINDOW*))
(DEFUN GABRIEL::SETUP-TPRINT NIL (LET* ((GABRIEL::TTYR (IL:WINDOWPROP (IL:WFROMDS (IL:TTYDISPLAYSTREAM
)) (QUOTE IL:REGION))) (GABRIEL::W (IL:CREATEW (IL:CREATEREGION (IL:|fetch| (IL:REGION IL:PRIGHT) 
IL:|of| GABRIEL::TTYR) (IL:|fetch| (IL:REGION IL:BOTTOM) IL:|of| GABRIEL::TTYR) (- 1024 (IL:|fetch| (
IL:REGION IL:PRIGHT) IL:|of| GABRIEL::TTYR)) (IL:|fetch| (IL:REGION IL:HEIGHT) IL:|of| GABRIEL::TTYR))
))) (IL:DSPSCROLL T GABRIEL::W) (IL:DSPRESET GABRIEL::W) GABRIEL::W))
(DEFUN GABRIEL::TPRINT-INIT (GABRIEL::M GABRIEL::N GABRIEL::ATOMS) (LET ((GABRIEL::ATOMS (COPY-TREE 
GABRIEL::ATOMS))) (DO ((GABRIEL::A GABRIEL::ATOMS (CDR GABRIEL::A))) ((NULL (CDR GABRIEL::A)) (RPLACD 
GABRIEL::A GABRIEL::ATOMS))) (GABRIEL::TPRINT-INIT1 GABRIEL::M GABRIEL::N GABRIEL::ATOMS)))
(DEFUN GABRIEL::TPRINT-INIT1 (GABRIEL::M GABRIEL::N GABRIEL::ATOMS) (COND ((= GABRIEL::M 0) (POP 
GABRIEL::ATOMS)) (T (DO ((GABRIEL::I GABRIEL::N (- GABRIEL::I 2)) (GABRIEL::A NIL)) ((< GABRIEL::I 1) 
GABRIEL::A) (PUSH (POP GABRIEL::ATOMS) GABRIEL::A) (PUSH (GABRIEL::TPRINT-INIT1 (1- GABRIEL::M) GABRIEL::N
 GABRIEL::ATOMS) GABRIEL::A)))))
(DEFVAR GABRIEL::TEST-ATOMS-TPRINT (QUOTE (GABRIEL::ABC1 GABRIEL::CDE2 GABRIEL::EFG3 GABRIEL::GHI4 
GABRIEL::IJK5 GABRIEL::KLM6 GABRIEL::MNO7 GABRIEL::OPQ8 GABRIEL::QRS9 GABRIEL::STU0 GABRIEL::UVW1 
GABRIEL::WXY2 GABRIEL::XYZ3 GABRIEL::123A GABRIEL::234B GABRIEL::345C GABRIEL::|456D| GABRIEL::|567D| 
GABRIEL::|678E| GABRIEL::|789F| GABRIEL::890G)))
(DEFVAR GABRIEL::*TPRINT-WINDOW* NIL)
(DEFVAR GABRIEL::TEST-PATTERN-TPRINT (GABRIEL::TPRINT-INIT 6 6 GABRIEL::TEST-ATOMS-TPRINT))
(DEFPARAMETER GABRIEL::*IO-BENCHMARKS* (QUOTE (GABRIEL::FPRINT GABRIEL::FREAD GABRIEL::TPRINT 
IL:READ-FLOAT IL:PRINT-FLOAT IL:TERMINAL-PRINTING IL:READ-EXISTING-SYMBOLS IL:READ-DSK IL:READ-CORE 
IL:WRITE-DSK IL:WRITE-CORE)))
(DEFPARAMETER GABRIEL::*MAIKO-IO-BENCHMARKS* (QUOTE (GABRIEL::FPRINT GABRIEL::FREAD GABRIEL::TPRINT 
IL:READ-FLOAT IL:PRINT-FLOAT IL:TERMINAL-PRINTING IL:READ-EXISTING-SYMBOLS IL:READ-DSK IL:READ-UFS 
IL:READ-CORE IL:WRITE-DSK IL:WRITE-UFS IL:WRITE-CORE)))
(IL:RPAQQ IL:*1186-IO-TIMERS* (IL:FLOPPY-FORMATTING IL:FLOPPY-WRITE IL:FLOPPY-READ))
(DEFUN READ-FLOATS NIL (WITH-OPEN-STREAM (IL:STR (IL:OPENSTREAM "{CORE}FLOATS" (QUOTE IL:INPUT))) (
IL:READ IL:STR)) NIL)
(GABRIEL::DEFINE-TIMER (IL:READ-FLOAT) "Read 2000 Floats from {CORE}" (READ-FLOATS))
(GABRIEL::DEFINE-TIMER IL:PRINT-FLOAT "Print 2000 Floats to {NULL}" (IL:PRINT *FLOATS-TO-PRINT* (
IL:OPENSTREAM (QUOTE IL:{NULL}) (QUOTE IL:OUTPUT))))
(DEFUN PRINT-TO-TERMINAL (WINDOW) (IL:* IL:|;;| 
"Print 1000 lines of characters to the terminal, with dribbling disabled.") (IL:* IL:|;;| 
"bind *DRIBBLE-OUTPUT* here, to prevent dribbling during the long printing that we really want to time."
) (DECLARE (SPECIAL IL:*DRIBBLE-OUTPUT* IL:\\TERM.OFD)) (LET ((IL:*DRIBBLE-OUTPUT*) (TDS (
IL:TTYDISPLAYSTREAM))) (DECLARE (SPECIAL IL:*DRIBBLE-OUTPUT* IL:\\TERM.OFD)) (UNWIND-PROTECT (PROGN (
IL:TTYDISPLAYSTREAM WINDOW) (IL:|for| IL:I IL:|from| 1 IL:|to| 1000 IL:|do| (IL:PRINTOUT WINDOW 
"LINE " IL:I 
" ASDF ASDF ASDF ASDF ASDF ASDF SADF ASDF ASDF ASDF ASDF ASDF ASDF ASDF ASDF ASDF ASDF SADF ASDF ASDF ASDF ASDF ASDF"
 T))) (IL:TTYDISPLAYSTREAM TDS))))
(GABRIEL::DEFINE-TIMER (IL:TERMINAL-PRINTING (:SETUP (PROGN (IL:SETQ IL:*TIMER-WINDOW-FOR-PRINT-TIMING*
 (IL:CREATEW (QUOTE (0 0 876 30)))) (IL:DSPFONT (QUOTE (IL:GACHA 10)) IL:*TIMER-WINDOW-FOR-PRINT-TIMING*
) (IL:WINDOWPROP IL:*TIMER-WINDOW-FOR-PRINT-TIMING* (QUOTE IL:PAGEFULLFN) (QUOTE IL:NILL)))) (:AFTER (
PROGN (IL:CLOSEW IL:*TIMER-WINDOW-FOR-PRINT-TIMING*) (IL:SETQ IL:*TIMER-WINDOW-FOR-PRINT-TIMING* NIL))
)) "Printing chars to terminal" (PRINT-TO-TERMINAL IL:*TIMER-WINDOW-FOR-PRINT-TIMING*))
(GABRIEL::DEFINE-TIMER IL:FLOPPY-FORMATTING "Formatting a floppy disk" (IL:FLOPPY.FORMAT "TEST" T T))
(GABRIEL::DEFINE-TIMER (IL:FLOPPY-WRITE :AFTER (IL:DELFILE "{FLOPPY}200-PAGES")) 
"Write 200 pages, CORE to floppy" (IL:COPYFILE "{CORE}200-PAGES" "{FLOPPY}200-PAGES"))
(GABRIEL::DEFINE-TIMER (IL:FLOPPY-READ :SETUP (IL:COPYFILE "{CORE}200-PAGES" "{FLOPPY}200-PAGES") 
:AFTER (IL:DELFILE "{FLOPPY}200-PAGES")) "Copy 200 pages, floppy to NULL" (IL:COPYFILE 
"{FLOPPY}200-PAGES" "{NULL}"))
(DEFUN IL:READ-EXISTING-SYMBOLS NIL (WITH-OPEN-STREAM (IL:STR (IL:OPENSTREAM "{CORE}1000-SYMBOLS" (
QUOTE IL:INPUT))) (PROG1 NIL (IL:READ IL:STR))))
(GABRIEL::DEFINE-TIMER (IL:READ-EXISTING-SYMBOLS :SETUP (IL:COPYFILE 
"{ERIS}<LISPCORE>GABRIEL>AUX>1000-SYMBOLS" "{CORE}1000-SYMBOLS") (IL:READ-EXISTING-SYMBOLS)) 
"Read 1000 symbols that exist in the sysout already" (IL:READ-EXISTING-SYMBOLS))
(DEFUN IL:WRITE-TO-COREFILE (IL:BYTES) (WITH-OPEN-STREAM (IL:STR (IL:OPENSTREAM 
"{CORE}SPEED-TEST-FILE" (QUOTE IL:OUTPUT) (QUOTE IL:NEW))) (IL:|for| IL:I IL:|from| 1 IL:|to| IL:BYTES
 IL:|do| (IL:\\BOUT IL:STR 33))) (IL:DELFILE "{CORE}SPEED-TEST-FILE"))
(DEFUN IL:WRITE-TO-FILE (IL:FILE IL:BYTES) (WITH-OPEN-STREAM (IL:STR (IL:OPENSTREAM IL:FILE (QUOTE 
IL:OUTPUT) (QUOTE IL:NEW))) (IL:|for| IL:I IL:|from| 1 IL:|to| IL:BYTES IL:|do| (IL:\\BOUT IL:STR 33))
))
(DEFUN IL:READ-FROM-FILE (IL:FILE IL:BYTES) (WITH-OPEN-STREAM (IL:STR (IL:OPENSTREAM IL:FILE (QUOTE 
IL:INPUT) (QUOTE IL:OLD))) (IL:|for| IL:I IL:|from| 1 IL:|to| IL:BYTES IL:|do| (IL:\\BIN IL:STR))))
(GABRIEL::DEFINE-TIMER (IL:READ-DSK (:SETUP (IL:WRITE-TO-FILE "{DSK}test-file" 50000)) (:AFTER (
IL:DELFILE "{DSK}test-file"))) "Read 50,000 bytes from a file on {DSK}" (IL:READ-FROM-FILE 
"{DSK}test-file" 50000))
(GABRIEL::DEFINE-TIMER (IL:READ-UFS (:SETUP (IL:WRITE-TO-FILE "{UNIX}test-file" 50000)) (:AFTER (
IL:DELFILE "{UNIX}test-file"))) "Read 50,000 bytes from a file on the {UNIX} device" (IL:READ-FROM-FILE
 "{UNIX}test-file" 50000))
(GABRIEL::DEFINE-TIMER (IL:READ-CORE (:SETUP (IL:WRITE-TO-FILE "{CORE}test-file" 50000)) (:AFTER (
IL:DELFILE "{CORE}test-file"))) "Read 50,000 bytes from CORE." (IL:READ-FROM-FILE "{CORE}test-file" 
50000))
(GABRIEL::DEFINE-TIMER (IL:WRITE-DSK (:AFTER (IL:DELFILE "{DSK}test-file"))) 
"Write 50,000 bytes on on {DSK}" (IL:WRITE-TO-FILE "{DSK}test-file" 50000))
(GABRIEL::DEFINE-TIMER (IL:WRITE-UFS (:AFTER (IL:DELFILE "{UNIX}test-file"))) 
"Write 50,000 bytes to a file on {UNIX}" (IL:WRITE-TO-FILE "{UNIX}test-file" 50000))
(GABRIEL::DEFINE-TIMER (IL:WRITE-CORE (:AFTER (IL:DELFILE "{CORE}test-file"))) 
"Write 50,000 bytes to a file on {CORE}" (IL:WRITE-TO-FILE "{CORE}test-file" 50000))
(IL:COPYFILE "{DSK}<USR>LOCAL>LDE>LISPCORE>GABRIEL>AUX>2000-FLOATS-TO-READ" "{CORE}FLOATS")
(IL:COPYFILE "{DSK}<USR>LOCAL>LDE>LISPCORE>GABRIEL>AUX>1000-SYMBOLS" "{CORE}1000-SYMBOLS")
(IL:PUTPROPS IL:IO-BENCHMARKS IL:MAKEFILE-ENVIRONMENT (:READTABLE "XCL" :PACKAGE (XCL:DEFPACKAGE 
"BENCHMARKS")))
(IL:PUTPROPS IL:IO-BENCHMARKS IL:FILETYPE COMPILE-FILE)
(IL:PUTPROPS IL:IO-BENCHMARKS IL:COPYRIGHT ("Xerox Corporation" 1987 1988 1990))
NIL
